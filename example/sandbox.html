<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sandbox</title>

    <link rel="stylesheet" href="./css/sandbox.css">
    <link rel="stylesheet" href="../dist/main.css">

    <script src="../dist/ocharts.js"></script>
</head>

<body>
    <div class="base">
        <div class="chart-container">
            <div id="chart"></div>
        </div>

        <div class="settings">
            <div>
                <label>
                    Chart Type

                    <select id="chart-type" onchange="refresh()">
                        <option value="0">
                            Plot
                        </option>

                        <option value="1">
                            Circular
                        </option>

                        <option value="2">
                            Gauge
                        </option>

                        <option value="3">
                            Tree Map
                        </option>
                    </select>
                </label>

                <label>
                    Values

                    <select id="values-type" onchange="refresh()">
                        <option value="0">
                            Random
                        </option>

                        <option value="1">
                            Ascending
                        </option>

                        <option value="2">
                            Same
                        </option>
                    </select>
                </label>

                <label>
                    Values Count

                    <input type="number" min="0" id="values-count" onchange="refresh()" value="1"/>
                </label>

                <label>
                    Width

                    <input type="range" id="width" value="100" oninput="setWidth()"/>
                </label>

                <label>
                    Height

                    <input type="range" id="height" height="100" oninput="setHeight()"/>
                </label>

                <label>
                    <input type="checkbox" id="tooltip" onchange="refresh()"/>

                    Tooltip
                </label>

                <label>
                    <input type="checkbox" id="custom-tooltip" onchange="refresh()"/>

                    Custom Tooltip
                </label>

                <label>
                    <input type="checkbox" id="legend" onchange="refresh()"/>

                    Legend
                </label>

                <label>
                    <input type="checkbox" id="title" onchange="refresh()"/>

                    Title
                </label>

                <label>
                    <input type="checkbox" id="context-menu" onchange="refresh()"/>

                    Context Menu
                </label>

                <label>
                    <input type="checkbox" id="dark-theme" onchange="refresh()"/>

                    Dark Theme
                </label>

                <label>
                    Base Color

                    <input type="color" id="base-color" onchange="refresh()" value="#32a852"/>
                </label>
            </div>

            <div>
                <label>
                    Plot Type

                    <select id="plot-type" onchange="refresh()">
                        <option value="0">
                            Line
                        </option>

                        <option value="1">
                            Attention Line
                        </option>

                        <option value="2">
                            Column
                        </option>

                        <option value="3">
                            Bar
                        </option>

                        <option value="4">
                            Stacking Column
                        </option>
                    </select>
                </label>

                <label>
                    <input type="checkbox" id="x-axis-label" onchange="refresh()"/>

                    X-axis Label
                </label>

                <label>
                    <input type="checkbox" id="y-axis-label" onchange="refresh()"/>

                    Y-axis Label
                </label>

                <label>
                    Points count

                    <input type="number" min="0" id="points-count" onchange="refresh()" value="40"/>
                </label>

                <label>
                    Series Width

                    <input type="number" id="series-width" onchange="refresh()" value="4"/>
                </label>
            </div>

            <div>
                <label>
                    Inner Radius

                    <input type="range" id="inner-radius" oninput="refresh()"/>
                </label>

                <label>
                    <input type="checkbox" id="other" onchange="refresh()"/>

                    Other
                </label>
            </div>


            <div>
                <label>
                    Min

                    <input type="number" id="gauge-min" onchange="refresh()" value="0"/>
                </label>

                <label>
                    Max

                    <input type="number" id="gauge-max" onchange="refresh()" value="100"/>
                </label>
            </div>

            <div>
                <label>
                    Padding

                    <input type="range" id="tree-padding" oninput="refresh()"/>
                </label>
            </div>

            <div>
                <label>
                    Seed

                    <input type="number" id="seed" onchange="saveState(); location.reload()"/>
                </label>
            </div>
        </div>
    </div>
</body>

<template id="custom-tooltip-template">
    <div style="display: flex; flex-direction: column; gap: 8px; padding: 8px; border: 1px solid black; border-radius: 4px; background-color: #ffffff">
        <img src="https://placecats.com/${ Id }/${ Id }" alt="cat"/>

        <span>
            ${ Id }, ${ Name }
        </span>

        <b>
            ${ Value }
        </b>
    </div>
</template>

<script>
    function RNG() {
        const seed = +document.getElementById('seed').value

        this.m = 0x80000000
        this.a = 1103515245
        this.c = 12345

        this.state = seed ? seed : Math.floor(Math.random() * (this.m - 1))
    }
    RNG.prototype.nextInt = function() {
        this.state = (this.a * this.state + this.c) % this.m
        return this.state
    }
    RNG.prototype.nextFloat = function() {
        return this.nextInt() / (this.m - 1)
    }

    function setCookie(name,value,days) {
        let expires = ''
        if (days) {
            let date = new Date()
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000))
            expires = '; expires=' + date.toUTCString()
        }
        document.cookie = name + '=' + (value || '')  + expires + '; path=/'
    }
    function getCookie(name) {
        let nameEQ = name + '=',
            ca = document.cookie.split(';')
        for(let i = 0; i < ca.length; i++) {
            let c = ca[i]
            while (c.charAt(0) === ' ')
                c = c.substring(1, c.length)
            if (c.indexOf(nameEQ) === 0)
                return c.substring(nameEQ.length, c.length)
        }

        return null
    }

    function saveState() {
        let object = { }

        const inputs = document.querySelectorAll('input, select')

        for (const input of inputs) {
            const id = input.id

            if (id !== null)
                object[id] = input.type === 'checkbox' ? input.checked : input.value
        }

        setCookie('state', JSON.stringify(object), 365)
    }

    function restoreState() {
        const object = JSON.parse(getCookie('state'))

        if (object === null)
            return

        for (const [key, value] of Object.entries(object)) {
            const element = document.getElementById(key)

            if (element) {
                if (element.type === 'checkbox')
                    element.checked = value
                else
                    element.value = value
            }
        }

        rng = new RNG()
    }

    let rng

    function getValues(type, count, valuesType, pointsCount, plotType) {
        let values = [],
            sameValue = 0

        const seriesWidth = +document.getElementById('series-width').value

        function getData() {
            return {
                Id: 50,
                Name: 'First Second',
                Value: 16
            }
        }

        switch (type) {
            case 0:
                for (let i = 0; i < count; i++) {
                    let points = []

                    sameValue = rng.nextFloat() * 1000

                    for (let j = 0; j < pointsCount; j++) {
                        let x = 0,
                            y = 0

                        if (plotType === 1) {
                            points.push({
                                x: j,
                                y: sameValue
                            })

                            continue
                        }

                        switch (valuesType) {
                            case 0:
                                x = j
                                y = rng.nextFloat() * 1000

                                break

                            case 1:
                                x = j
                                y = j

                                break

                            case 2:
                                x = j
                                y = sameValue

                                break

                            default:
                                break
                        }

                        points.push({
                            x: x,
                            y: y
                        })
                    }

                    values.push({
                        type: plotType,
                        values: points,
                        width: seriesWidth,
                        label: `Series ${i}`,
                        data: getData(),
                        lineType: rng.nextInt() % 3
                    })
                }

                break

            case 1:
                sameValue = rng.nextFloat() * 1000

                for (let i = 0; i < count; i++) {
                    let value = 0

                    switch (valuesType) {
                        case 0:
                            value = rng.nextFloat() * 1000

                            break

                        case 1:
                            value = i

                            break

                        case 2:
                            value = sameValue

                            break

                        default:
                            break
                    }


                    values.push({
                        value: value,
                        label: `Sector ${i}`,
                        data: getData()
                    })
                }

                break

            case 2:
                let value = 0

                sameValue = rng.nextFloat() * 1000

                switch (valuesType) {
                    case 0:
                        value = rng.nextFloat() * 1000

                        break

                    case 1:
                        value = 50

                        break

                    case 2:
                        value = sameValue

                        break

                    default:
                        break
                }

                values.push({
                    value: value,
                    label: `Label`,
                    data: getData()
                })

                break

            case 3:
                sameValue = rng.nextFloat() * 1000

                for (let i = 0; i < count; i++) {
                    let value = 0

                    switch (valuesType) {
                        case 0:
                            value = rng.nextFloat() * 1000

                            break

                        case 1:
                            value = i

                            break

                        case 2:
                            value = sameValue

                            break

                        default:
                            break
                    }


                    values.push({
                        value: value,
                        label: `Cell ${i}`,
                        data: getData()
                    })
                }

                break

            default:
                break
        }

        return values
    }

    function refresh() {
        const titleEnabled = document.getElementById('title').checked,
            customTooltipEnabled = document.getElementById('custom-tooltip').checked,
            tooltipEnabled = document.getElementById('tooltip').checked || customTooltipEnabled,
            darkThemeEnabled = document.getElementById('dark-theme').checked,
            legendEnabled = document.getElementById('legend').checked,
            xAxisTitleEnabled = document.getElementById('x-axis-label').checked,
            yAxisTitleEnabled = document.getElementById('y-axis-label').checked,
            contextMenuEnabled = document.getElementById('context-menu').checked,
            otherEnabled = document.getElementById('other').checked


        const title = titleEnabled ? 'Title' : null,
            type = +document.getElementById('chart-type').value,
            valuesCount = +document.getElementById('values-count').value,
            xAxisTitle = xAxisTitleEnabled ? 'X-axis title' : null,
            yAxisTitle = yAxisTitleEnabled ? 'Y-axis title' : null,
            valuesType = +document.getElementById('values-type').value,
            pointsCount = +document.getElementById('points-count').value,
            plotType = +document.getElementById('plot-type').value,
            baseColor = document.getElementById('base-color').value,
            gaugeMin = +document.getElementById('gauge-min').value,
            gaugeMax = +document.getElementById('gauge-max').value,
            padding = +document.getElementById('tree-padding').value,
            customTooltip = customTooltipEnabled ? 'custom-tooltip-template' : null,
            innerRadius = +document.getElementById('inner-radius').value,
            contextMenu = !contextMenuEnabled
                ? null
                : [
                    {
                        text: 'Button 1',
                        action: data => {
                            console.log('Button 1 action', data)
                        }
                    },
                    {
                        text: 'Button 2',
                        action: () => {
                            console.log('Another action')
                        }
                    }
                ]

        let values = getValues(type, valuesCount, valuesType, pointsCount, plotType)

        const exist = document.getElementById('chart').childElementCount !== 0

        if (exist) {
            delete exist.chart
            document.getElementById('chart').innerHTML = ''
        }

        let chart = OCharts.chart(document.getElementById('chart'), {
            title: title,
            enableTooltip: tooltipEnabled,
            enableLegend: legendEnabled,
            enableOther: otherEnabled,
            data: {
                values: values,
                xTitle: xAxisTitle,
                yTitle: yAxisTitle,
                min: gaugeMin,
                max: gaugeMax,
                padding: padding,
                innerRadius: innerRadius
            },
            type: type,
            baseColor: baseColor,
            templateId: customTooltip,
            contextMenu: contextMenu,
            isDarkThemeFunction: () => darkThemeEnabled
        })

        chart.render()

        saveState()
    }

    function setWidth() {
        const width = document.getElementById('width').value

        document.getElementById('chart').style.width = width + '%'

        saveState()
    }

    function setHeight() {
        const height = document.getElementById('height').value

        document.getElementById('chart').style.height = height + '%'

        saveState()
    }

    restoreState()

    refresh()
</script>
</html>