(()=>{"use strict";var t={172:()=>{},832:function(){class t{toggle(t){0==t&&(this.disabled=!this.disabled)}checkCondition(){return!1}reset(){this.disabled=!1}}class i{constructor(t){this.state=mi.Init,this.node=t.node,this.settings=t.settings,this.animations=new yi,this.canvas=document.createElement(gi.Canvas),this.canvas.style.imageRendering=pi.ImageRendering.Pixelated,this.node.append(this.canvas),this.tooltip=new Ei(this.canvas,this.settings),this.initAnimations()}render(){Li.getContext(this.canvas).clearRect(0,0,this.canvas.width,this.canvas.height)}refresh(){this.tooltip.refresh(),this.state=this.settings.disableInitAnimation?mi.Idle:mi.Init}resetMouse(){this.onMouseMoveEvent=new MouseEvent(di.MouseMove),this.onClickEvent=new MouseEvent(di.Click),this.onContextMenuEvent=void 0}initAnimations(){this.canvasPosition=this.canvas.getBoundingClientRect(),this.canvasPosition.x+=scrollX,this.canvasPosition.y+=scrollY,this.state!=mi.Init||this.settings.disableInteractions||(this.canvas.onmousemove=t=>this.onMouseMoveEvent=t,this.canvas.onclick=t=>this.onClickEvent=t,this.canvas.oncontextmenu=t=>{t.preventDefault(),this.contextMenu=void 0,this.onContextMenuEvent?this.onContextMenuEvent=void 0:this.onContextMenuEvent=t},this.canvas.onmouseleave=()=>{this.onMouseMoveEvent=new MouseEvent(di.MouseMove),this.onClickEvent=void 0})}}var e,s,n=this&&this.__classPrivateFieldGet||function(t,i,e,s){if("a"===e&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!s:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?s:"a"===e?s.call(t):s?s.value:i.get(t)};class h extends i{constructor(t){super(t),e.add(this),this.isDestroy=!1,this.data=this.settings.data,this.highlightItems=[],this.state=this.settings.disableInitAnimation?mi.Idle:mi.Init}render(){super.render();const t=Li.getContext(this.canvas);this.settings.title&&(Oi.title(t),t.fillText(this.settings.title,this.canvas.width/2,xi.Values.titleOffset))}destroy(){this.isDestroy=!0,this.canvas.remove()}renderDropdown(){this.onClickEvent=this.dropdown?.render(this.onMouseMoveEvent,this.onClickEvent)}resize(){n(this,e,"m",s).call(this),this.tooltip.refresh(),this.dropdown?.resize()}prepareSettings(){const t=this.node.parentElement.getBoundingClientRect();this.settings.minWidth=isNaN(+this.settings.width)?0:+this.settings.width,this.settings.minHeight=isNaN(+this.settings.height)?0:+this.settings.height,this.settings.width=0!=this.settings.minWidth&&t.width<this.settings.minWidth?this.settings.minWidth:t.width,this.settings.height=0!=this.settings.minHeight&&t.height<this.settings.minHeight?this.settings.minHeight:t.height,this.canvas.width=this.settings.width,this.canvas.height=this.settings.height;const i=this.settings.baseColor??Ii.randomColor();let e=Math.round(100/this.settings.data.values.length),s=-50;e<=1&&(e=1);for(let t of this.settings.data.values)t.id=Ii.guid(),t.color??=Ii.adjustColor(i,s+=e),t.label??=zi.NoLabel;for(let t of this.settings.contextMenu??[])null!=t.id&&(t.action=i=>this.node.dispatchEvent(new CustomEvent(t.id??"",{detail:i})))}initDropdown(){}renderContextMenu(t){if(this.dropdown?.isActive)return this.onContextMenuEvent=void 0,!1;if(null!=this.onContextMenuEvent&&0!=this.settings.contextMenu?.length){if(null==this.contextMenu&&null!=this.settings.contextMenu){let i=[];for(const e of this.settings.contextMenu)e.condition&&!e.condition(t)||i.push({id:e.id,text:e.text,isDivider:e.isDivider,action:()=>{e.action(t),this.onContextMenuEvent=void 0,this.contextMenu=void 0}});this.contextMenu=new Ci(this.canvas,{x:this.onContextMenuEvent.x-this.canvasPosition.x,y:this.onContextMenuEvent.y-this.canvasPosition.y,items:i,data:t}),this.contextMenu.resize(),this.onClickEvent=void 0}const i=null!=this.onClickEvent;if(this.onClickEvent=this.contextMenu?.render(this.onMouseMoveEvent,this.onClickEvent),null==this.onClickEvent&&i)return this.contextMenu=void 0,this.onContextMenuEvent=void 0,!0}return!1}highlight(t){this.highlightItems=t?[t.id]:[]}getMousePosition(t){return{x:t.clientX-this.canvasPosition.x+scrollX,y:t.clientY-this.canvasPosition.y+scrollY}}}e=new WeakSet,s=function(){let t=this.node.getBoundingClientRect();this.settings.width=this.settings.minWidth&&t.width<this.settings.minWidth?this.settings.minWidth:t.width,this.settings.height=this.settings.minHeight&&t.height<this.settings.minHeight?this.settings.minHeight:t.height,this.canvas.width=this.settings.width,this.canvas.height=this.settings.height,this.settings.enableLegend&&(null!=this.settings.legendPlace&&this.settings.legendPlace!=fi.Top&&this.settings.legendPlace!=fi.Bottom||(this.canvas.height-=Ti.getLegendHeight(this.settings.data.values,this.canvas.width)),this.settings.legendPlace!=fi.Left&&this.settings.legendPlace!=fi.Right||(this.canvas.width-=500))};var a,o,l,r,d,f,c,u,v,g,m,p,x,w,y,M,b,k,C,S,I,T,D,A,P,W,E,L,R,B,O,N,$,H,F,z,V,j,q,Y,X,G,J,U,_,K,Q,Z,tt,it,et,st,nt,ht,at,ot,lt,rt,dt,ft,ct,ut,vt,gt,mt,pt,xt,wt,yt,Mt,bt,kt,Ct,St,It,Tt,Dt,At,Pt,Wt,Et,Lt,Rt,Bt,Ot,Nt,$t,Ht,Ft,zt,Vt,jt,qt,Yt,Xt,Gt,Jt,Ut,_t,Kt,Qt,Zt,ti,ii,ei,si,ni,hi,ai,oi,li,ri,di,fi,ci,ui,vi,gi,mi,pi,xi,wi=this&&this.__classPrivateFieldSet||function(t,i,e,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof i?t!==i||!n:!i.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(t,e):n?n.value=e:i.set(t,e),e};class yi{constructor(){a.add(this),l.set(this,void 0),wi(this,l,new Map,"f")}add(t,i,e){const s=n(this,a,"m",d).call(this,t,i);n(this,l,"f").has(s)||n(this,l,"f").set(s,e),n(this,a,"m",r).call(this,s)}contains(t,i){return n(this,l,"f").has(n(this,a,"m",d).call(this,t,i))}reload(t,i){this.contains(t,i)&&(n(this,l,"f").get(n(this,a,"m",d).call(this,t,i)).timer=new Date)}clear(){n(this,l,"f").forEach((t,i)=>!n(this,a,"m",f).call(this,i,ai.Init)&&n(this,l,"f").delete(i))}static initializeTransitions(){for(let t=0;t<3e4;t++){const i=(t+1)/3e4;let e=0*Math.pow(1-i,3)+3*Math.pow(1-i,2)*.77*i+3*(1-i)*Math.pow(i,2)*.23+1*Math.pow(i,3),s=0*Math.pow(1-i,3)+3*Math.pow(1-i,2)*.23*i+3*(1-i)*Math.pow(i,2)*.77+1*Math.pow(i,3);o.transitionCurve.set(+e.toFixed(4),s)}o.transitionCurve.set(0,0)}static getTransition(t){return o.transitionCurve.get(+t.toFixed(4))??0}}o=yi,l=new WeakMap,a=new WeakSet,r=function(t){const i=n(this,l,"f").get(t),e=new Date,s=e.getTime()-(i.timer??e).getTime(),h=o.getTransition(s>i.duration?1:s/i.duration),a=!i.before||i.before();!i.timer&&a&&(i.timer=e),a&&i.body(i.backward?1-h:h),1!=h||a&&!i.continuous||n(this,l,"f").delete(t)},d=function(t,i){return t+"_"+i},f=function(t,i){return t.endsWith("_"+i)},yi.transitionCurve=new Map;class Mi{constructor(t,i){c.add(this),u.set(this,void 0),v.set(this,void 0),g.set(this,void 0),m.set(this,void 0),p.set(this,void 0),wi(this,u,t,"f"),wi(this,v,i,"f"),this.animations=new yi,n(this,c,"m",x).call(this);const e=Ii.stringWidth(n(this,v,"f").text)+20;wi(this,p,{x:n(this,v,"f").x+e>n(this,u,"f").width?n(this,u,"f").width-e:n(this,v,"f").x<0?n(this,u,"f").width+n(this,v,"f").x-e:n(this,v,"f").x,y:n(this,v,"f").y+24>n(this,u,"f").height?n(this,u,"f").height-24:n(this,v,"f").y<0?n(this,u,"f").height+n(this,v,"f").y-24:n(this,v,"f").y,width:e,height:24},"f")}render(t,i){n(this,m,"f")||n(this,c,"m",x).call(this);const e=Li.getContext(n(this,u,"f"));e.beginPath();const s=(t,i)=>{this.animations.reload("animation-button",i),e.fillStyle=Ii.adjustColor(Wi.background,-Math.round(40*t))};return n(this,c,"m",w).call(this,t)?(n(this,u,"f").style.cursor=pi.Cursor.Pointer,i&&n(this,c,"m",w).call(this,i)&&(n(this,v,"f").action(),i=void 0),this.animations.add("animation-button",ai.MouseOver,{duration:300,body:t=>{s(t,ai.MouseLeave)}})):this.animations.add("animation-button",ai.MouseLeave,{timer:xi.Dates.minDate,duration:300,backward:!0,body:t=>{s(t,ai.MouseOver)}}),e.strokeStyle=Wi.background,e.roundRect(n(this,p,"f").x,n(this,p,"f").y,n(this,p,"f").width,n(this,p,"f").height,4),e.fill(),Oi.regular(e),e.fillText(n(this,v,"f").text,n(this,p,"f").x+n(this,p,"f").width/2,n(this,p,"f").y+n(this,p,"f").height/2),wi(this,m,!0,"f"),i}resize(){n(this,c,"m",x).call(this)}}u=new WeakMap,v=new WeakMap,g=new WeakMap,m=new WeakMap,p=new WeakMap,c=new WeakSet,x=function(){wi(this,g,n(this,u,"f").getBoundingClientRect(),"f"),n(this,g,"f").x+=scrollX,n(this,g,"f").y+=scrollY},w=function(t){if(!t)return!1;let i=t.clientX-n(this,g,"f").x+scrollX,e=t.clientY-n(this,g,"f").y+scrollY;return i>=n(this,p,"f").x&&i<=n(this,p,"f").x+n(this,p,"f").width&&e>=n(this,p,"f").y&&e<=n(this,p,"f").y+n(this,p,"f").height};class bi{constructor(t,i){y.add(this),M.set(this,void 0),b.set(this,void 0),k.set(this,void 0),n(this,y,"m",T).call(this,i),this.node=t,this.settings=i,n(this,y,"m",D).call(this),n(this,y,"m",C).call(this),i.enableLegend&&wi(this,b,new Ti(this),"f"),document.addEventListener(di.VisibilityChanged,()=>n(this,M,"f").resetMouse()),window.addEventListener(di.Blur,()=>n(this,M,"f").resetMouse())}render(){n(this,M,"f").render(),n(this,b,"f")?.render(),wi(this,k,new ResizeObserver(()=>{n(this,M,"f").canvas?n(this,y,"m",I).call(this):this.destroy()}),"f"),n(this,k,"f").observe(this.node),n(this,y,"m",S).call(this)}destroy(){n(this,M,"f").destroy(),n(this,b,"f")?.destroy(),n(this,k,"f").disconnect()}highlight(t){n(this,M,"f").highlight(t)}reset(){Wi.reset(),n(this,y,"m",T).call(this,this.settings)}}M=new WeakMap,b=new WeakMap,k=new WeakMap,y=new WeakSet,C=function(){switch(this.settings.enableTooltip=!this.settings.disableInteractions&&this.settings.enableTooltip,this.settings.type){case li.Plot:wi(this,M,new Hi(this),"f");break;case li.Circular:wi(this,M,new Ni(this),"f");break;case li.Gauge:wi(this,M,new $i(this),"f");break;case li.TreeMap:wi(this,M,new Fi(this),"f")}n(this,M,"f").prepareSettings(),this.settings.disableInteractions||(n(this,M,"f").initDropdown(),n(this,M,"f").initAnimations()),n(this,M,"f").resize()},S=function(){n(this,M,"f").refresh(),n(this,b,"f")?.refresh()},I=function(){n(this,M,"f").resize(),n(this,b,"f")?.resize()},T=function(t){Wi.initialize(()=>n(this,y,"m",I).call(this),t.isDarkThemeFunction),yi.initializeTransitions()},D=function(){this.node.style.display=pi.Display.Flex,this.node.style.flexDirection=pi.FlexDirection.Column,this.node.style.alignItems=pi.AlignItems.Center,this.node.style.justifyContent=pi.JustifyContent.Center,this.node.style.height="100%"};class ki{static toTable(t){let i=document.createElement(gi.Table);i.classList.add("o-table");let e=new Map,s="",n="",h=new Map;for(const i of t.values){let e=new Map;for(const i of t.headers)e.set(i.value,0);for(const[t,s]of i.values)e.set(t,s);h.set(i.name,e)}for(const i of t.headers)n+=`\n                <th>\n                    ${i.display}\n                </th>\n            `;for(const[t,i]of h){let n="";for(const[t,s]of i)if(n+=`\n                    <td>\n                        ${null==s?"":Bi.number(s)}\n                    </td>\n                `,e.has(t)){let i=+(e.get(t)??0);e.set(t,i+ +s)}else e.set(t,s);s+=`\n                <tr>\n                    <td class="o-table-label">\n                        ${t}\n                    </td>\n                    \n                    ${n} \n                </tr>\n            `}let a="";for(const[,t]of e)a+=`\n                <td>\n                    ${null==t?"":Bi.number(t)}\n                </td>\n            `;return i.innerHTML=`\n            <thead>\n                <tr>\n                    <th></th>\n                \n                    ${n}\n                </tr>\n            </thead>\n        \n            <tbody>\n                ${s}\n            </tbody>\n            \n            <tfoot>\n                <tr>\n                    <td></td>\n                \n                    ${a}\n                </tr>\n            </tfoot>\n        `,i}static toChart(t,i){let e=document.createElement(gi.Div),s=document.createElement(gi.Div),n=document.createElement(gi.Script),h=Ii.guid();e.style.display=pi.Display.Flex,e.style.height="100%",s.id=h,s.style.flexGrow="1";let a=JSON.parse(JSON.stringify(t));return a.title&&(a.title=a.title+" (Other)"),a.data.values=i,a.minWidth=void 0,a.minHeight=void 0,n.innerHTML=`\n            new OCharts.chart(document.getElementById('${h}'), ${JSON.stringify(a)})\n                .render()\n        `,e.append(s,n),e}}class Ci{constructor(t,i){A.add(this),P.set(this,void 0),W.set(this,void 0),E.set(this,void 0),this.isActive=!1,L.set(this,void 0),R.set(this,void 0),B.set(this,void 0),wi(this,P,t,"f"),wi(this,W,i,"f"),wi(this,B,null==n(this,W,"f").text,"f"),this.animations=new yi}render(t,i){n(this,L,"f")||n(this,A,"m",O).call(this),n(this,B,"f")&&(this.isActive=!0);const e=Li.getContext(n(this,P,"f"));let s=n(this,R,"f").x,h=n(this,R,"f").y,a=n(this,R,"f").width,o=n(this,R,"f").height;if(e.beginPath(),!n(this,B,"f")){const l=(t,i)=>{this.animations.reload("animation-dropdown",i),e.fillStyle=Ii.adjustColor(Wi.background,-Math.round(40*t))};n(this,A,"m",N).call(this,t,s,h,a,o)?(n(this,P,"f").style.cursor=pi.Cursor.Pointer,i&&t.x==i.x&&t.y==i.y&&(this.isActive=!this.isActive,i=void 0),this.isActive?e.fillStyle=Ii.adjustColor(Wi.background,-40):this.animations.add("animation-dropdown",ai.MouseOver,{duration:300,body:t=>{l(t,ai.MouseLeave)}})):(n(this,P,"f").style.cursor=pi.Cursor.Default,this.isActive?e.fillStyle=Ii.adjustColor(Wi.background,-40):this.animations.add("animation-dropdown",ai.MouseLeave,{timer:xi.Dates.minDate,duration:300,backward:!0,body:t=>{l(t,ai.MouseOver)}})),e.strokeStyle=Wi.background,e.roundRect(s,h,a,o,4),e.fill(),Oi.regular(e),e.fillText(n(this,W,"f").text??"",s+a/2,h+o/2)}if(this.isActive){const a=6,l=6;h+=o;const r=n(this,W,"f").items.filter(t=>t.text),d=n(this,W,"f").items.filter(t=>!t.text);let f=Math.max(...r.map(t=>Ii.stringWidth(t.text)))+4*a;s+f>n(this,P,"f").width-4&&(s-=s+f-n(this,P,"f").width+4);const c="bb",u=127,v=Wi.dropdownItemHoverColor,g=Wi.dropdownBorder;e.beginPath();const m={x:s,y:h,width:f,height:26*r.length+4*d.length+(1==r.length?a:0)+(2==r.length&&1==d.length?a:0)};e.roundRect(m.x,m.y,m.width,m.height,l),e.fillStyle=Wi.background+c,e.setLineDash([]),e.lineWidth=1,e.strokeStyle=g+c,e.fill(),e.stroke(),e.beginPath(),h+=6;for(const o of n(this,W,"f").items){if(e.beginPath(),1==o.isDivider){h+=2,e.moveTo(s+a,h),e.lineTo(s+f-a,h),e.lineWidth=.5,e.stroke(),h+=4;continue}e.fillStyle="transparent";const r="animation-dropdown"+o.text,d=(t,i,s)=>{if(this.animations.reload(r,i),s&&1==t)return;let n=Math.round(u*t).toString(16);1==n.length&&(n="0"+n),e.fillStyle=v+n};n(this,A,"m",N).call(this,t,s,h,f,20)?(this.animations.add(r,ai.MouseOver,{duration:300,body:t=>{d(t,ai.MouseLeave)}}),n(this,P,"f").style.cursor=pi.Cursor.Pointer,i&&(o.action(),i=void 0,this.isActive=!1)):this.animations.add(r,ai.MouseLeave,{timer:xi.Dates.minDate,duration:300,backward:!0,body:t=>{d(t,ai.MouseOver,!0)}}),e.roundRect(s+a,h,f-2*a,20,l),e.fill(),e.fillStyle=Wi.text,e.textAlign="left",e.textBaseline="hanging",e.fillText(o.text,s+2*a,h+5),h+=22}}return e.lineWidth=1,!n(this,B,"f")&&null!=i&&this.isActive&&(this.isActive=!1,i=void 0),wi(this,L,!0,"f"),n(this,B,"f")&&i&&t.x==i.x&&t.y==i.y&&(this.isActive=!this.isActive,i=void 0),i}refresh(){wi(this,L,!1,"f")}resize(){n(this,A,"m",O).call(this),n(this,A,"m",$).call(this)}}P=new WeakMap,W=new WeakMap,E=new WeakMap,L=new WeakMap,R=new WeakMap,B=new WeakMap,A=new WeakSet,O=function(){wi(this,E,n(this,P,"f").getBoundingClientRect(),"f"),n(this,E,"f").x+=scrollX,n(this,E,"f").y+=scrollY},N=function(t,i,e,s,h){if(!t)return!1;let a=t.clientX-n(this,E,"f").x+scrollX,o=t.clientY-n(this,E,"f").y+scrollY;return a>=i&&a<=i+s&&o>=e&&o<=e+h},$=function(){const t=n(this,B,"f")?0:Ii.stringWidth(n(this,W,"f").text??"")+20,i=n(this,B,"f")?0:24;wi(this,R,{x:n(this,W,"f").x+t>n(this,P,"f").width?n(this,P,"f").width-t:n(this,W,"f").x<0?n(this,P,"f").width+n(this,W,"f").x-t:n(this,W,"f").x,y:n(this,W,"f").y+i>n(this,P,"f").height?n(this,P,"f").height-i:n(this,W,"f").y<0?n(this,P,"f").height+n(this,W,"f").y-i:n(this,W,"f").y,width:t,height:i},"f")};class Si{static asPng(t,i){requestAnimationFrame(()=>{const e=Li.getContext(t);let s=Ii.stringWidth(zi.exportPNG)+16;s<50&&(s=50),e.clearRect(t.width-s,0,s,64);let n=0,h=0;const a=new Uint32Array(e.getImageData(0,0,t.width,t.height).data.buffer);let o=!1;for(let i=0;i<t.width;i++){for(let e=0;e<t.height;e++)if(Li.isPixelBusy(a[i+e*t.width])){o=!0;break}if(o)break;n++}o=!1;for(let i=t.width;i>=0;i--){for(let e=0;e<t.height;e++)if(Li.isPixelBusy(a[i+e*t.width])){o=!0;break}if(o)break;h++}n>4&&(n-=4),h>4&&(h-=4),n>h&&(n=h),h>n&&(h=n);let l=document.createElement(gi.Canvas);l.width=t.width-n-h,l.height=t.height;const r=Li.getContext(l);r.fillStyle=Wi.background,r.fillRect(0,0,t.width,t.height),r.drawImage(t,-n,0),Si.saveAs((i??"chart")+".png",l.toDataURL("image/png"))})}static asCsv(t,i){let e=t.querySelectorAll("tr"),s=[];for(let t=0;t<e.length;t++){let i=[],n=e[t].querySelectorAll("td, th");for(let t=0;t<n.length;t++){let e=n[t].innerHTML.replace(/(\r\n|\n|\r)/gm,"").replace(/(\s\s)/gm," ");e=e.replace(/"/g,'""'),i.push('"'+e+'"')}s.push(i.join(","))}Si.saveAs((i??"table")+".csv",s.join("\n"),"data:text/csv;charset=utf-8,"+encodeURIComponent(s.join("\n")),!0)}static saveAs(t,i,e,s){if(null!=window.showSaveFilePicker){const n={suggestedName:t,types:[{accept:s?{"text/csv":".csv"}:{"image/*":".png"}}],excludeAcceptAllOption:!0};function h(t){const i=atob(t.split(",")[1]),e=t.split(",")[0].split(":")[1].split(";")[0],s=new ArrayBuffer(i.length),n=new Uint8Array(s);for(let t=0;t<i.length;t++)n[t]=i.charCodeAt(t);return new Blob([s],{type:e})}window.showSaveFilePicker(n).then(t=>{t.createWritable().then(t=>{t.write(s?i:h(i)).then(()=>t.close())})})}else{let a=document.createElement(gi.A);a.href=e??i,a.download=t,a.click()}}}class Ii{static adjustColor(t,i){return"#"+t.replace(/^#/,"").replace(/../g,t=>("0"+Math.min(255,Math.max(0,parseInt(t,16)+i)).toString(16)).slice(-2))}static grayScale(t){return"#"+Array(4).join(Math.round([.3,.59,.11].reduce((i,e,s)=>i+e*parseInt(t[2*s+1]+t[2*s+2],16),0)/3).toString(16).padStart(2,"0"))}static randomColor(){let t="#";for(let i=0;i<6;i++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}static stringWidth(t,i){const e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2796875,.2765625,.3546875,.5546875,.5546875,.8890625,.665625,.190625,.3328125,.3328125,.3890625,.5828125,.2765625,.3328125,.2765625,.3015625,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.2765625,.2765625,.584375,.5828125,.584375,.5546875,1.0140625,.665625,.665625,.721875,.721875,.665625,.609375,.7765625,.721875,.2765625,.5,.665625,.5546875,.8328125,.721875,.7765625,.665625,.7765625,.721875,.665625,.609375,.721875,.665625,.94375,.665625,.665625,.609375,.2765625,.3546875,.2765625,.4765625,.5546875,.3328125,.5546875,.5546875,.5,.5546875,.5546875,.2765625,.5546875,.5546875,.221875,.240625,.5,.221875,.8328125,.5546875,.5546875,.5546875,.5546875,.3328125,.5,.2765625,.5546875,.5,.721875,.5,.5,.5,.3546875,.259375,.353125,.5890625];return Array.from(t).reduce((t,i)=>t+(e[i.charCodeAt(0)]??.5279276315789471),0)*(i||14)}static guid(){const t=()=>(65536*(1+Math.random())|0).toString(16).substring(1);return(t()+t()+"-"+t()+"-4"+t().slice(0,3)+"-"+t()+"-"+t()+t()+t()).toLowerCase()}static hexToRgb(t){if(t.length>4){const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(i)return{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}}else{const i=/^#?([a-f\d])([a-f\d])([a-f\d])$/i.exec(t);if(i)return{r:parseInt(i[1]+i[1],16),g:parseInt(i[2]+i[2],16),b:parseInt(i[3]+i[3],16)}}return new Vi}static isColorVisible(t,i){const e=Ii.hexToRgb(t),s=Ii.hexToRgb(i);return(e.r+e.g+e.b)/(s.r+s.g+s.b)<.77}static isISOString(t){return/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+/.test(t)}}class Ti extends i{constructor(t){super(t),H.add(this),F.set(this,void 0),z.set(this,void 0),V.set(this,void 0),j.set(this,void 0),this.isDestroy=!1,wi(this,V,t,"f"),this.calculateSizes(),this.settings.disableInteractions||wi(this,F,new Mi(this.canvas,{x:-10,y:10,text:zi.reset,action:()=>{for(let t of this.settings.data.values)t.reset()}}),"f"),wi(this,z,{x:Ti.getOffsetToCenter(this.settings.data.values,this.canvas.width),y:(this.canvas.height-Ti.getLegendHeight(this.settings.data.values,this.canvas.width))/2},"f")}render(){super.render();const t=Li.getContext(this.canvas);let i={x:20,y:21};this.canvas.style.cursor=pi.Cursor.Default,Oi.regular(t),t.textAlign="start",t.textBaseline="alphabetic",t.translate(n(this,z,"f").x,n(this,z,"f").y),wi(this,j,0,"f");for(const t of this.settings.data.values.filter(t=>!t.hideInLegend))i=n(this,H,"m",q).call(this,t,i.x,i.y);t.translate(-n(this,z,"f").x,-n(this,z,"f").y),this.isDestroy||requestAnimationFrame(this.render.bind(this)),this.onClickEvent=n(this,F,"f")?.render(this.onMouseMoveEvent,this.onClickEvent),this.state=mi.Idle}destroy(){this.isDestroy=!0,this.canvas.remove()}refresh(){this.state=mi.Init}resize(){this.calculateSizes(),n(this,F,"f")?.resize(),this.initAnimations()}calculateSizes(){switch(this.settings.legendPlace){case fi.Bottom:default:this.canvas.width=this.settings.width,this.canvas.height=Ti.getLegendHeight(this.settings.data.values,this.canvas.width),this.node.style.flexDirection=pi.FlexDirection.Column;break;case fi.Top:this.canvas.width=this.settings.width,this.canvas.height=Ti.getLegendHeight(this.settings.data.values,this.canvas.width),this.node.style.flexDirection=pi.FlexDirection.ColumnReverse;break;case fi.Left:this.canvas.width=500,this.canvas.height=this.settings.height,this.node.style.flexDirection=pi.FlexDirection.Row;break;case fi.Right:this.canvas.width=500,this.canvas.height=this.settings.height,this.node.style.flexDirection=pi.FlexDirection.RowReverse}}static getOffsetToCenter(t,i){let e=20;for(const s of t.filter(t=>!t.hideInLegend)){const t=Ii.stringWidth(s.label);if(e+t+47>=i-100)break;e+=t+47}return i/2-e/2}static getLegendHeight(t,i){let e=1,s=20,n=Ti.getOffsetToCenter(t,i);for(const h of t.filter(t=>!t.hideInLegend)){const t=Ii.stringWidth(h.label);s+t+48>=i-32-n&&(s=20,e++),s+=t+48}return 24+20*e+6*(e-1)}}F=new WeakMap,z=new WeakMap,V=new WeakMap,j=new WeakMap,H=new WeakSet,q=function(t,i,e){var s;const h=Li.getContext(this.canvas),a=Ii.stringWidth(t.label);i+48+a>=this.canvas.width-40-n(this,z,"f").x&&(i=20,e+=26);let o=i-6-6,l=e-3-6,r=12+a+18;const d=t=>{if(!t)return!1;const i=t.clientX-this.canvasPosition.x+scrollX-n(this,z,"f").x,e=t.clientY-this.canvasPosition.y+scrollY-n(this,z,"f").y;return i>=o&&i<=o+r&&e>=l&&e<=l+20},f=(i,e)=>{this.animations.reload(t.id,e),h.beginPath(),h.roundRect(o,l,r,20,6),h.fillStyle=Ii.adjustColor(Wi.canvasBackground,Math.round(-25*i)),h.fill()};return this.animations.add(t.id,ai.Click,{duration:xi.Animations.legend,continuous:!0,before:()=>null!=this.onClickEvent&&(d(this.onClickEvent)||t instanceof qi&&0!==t.current&&t.value!==t.current)&&t.checkCondition(),body:i=>{t.toggle(i),1==i&&(this.onClickEvent=new PointerEvent(di.Click))}}),d(this.onMouseMoveEvent)?(this.animations.add(t.id,ai.MouseOver,{duration:xi.Animations.button,body:t=>{f(t,ai.MouseLeave)}}),t.disabled||(wi(this,j,(s=n(this,j,"f"),++s),"f"),n(this,V,"f").highlight(t)),this.canvas.style.cursor=pi.Cursor.Pointer):(this.animations.add(t.id,ai.MouseLeave,{timer:xi.Dates.minDate,duration:xi.Animations.button,backward:!0,body:t=>{f(t,ai.MouseOver)}}),0==n(this,j,"f")&&n(this,V,"f").highlight()),h.beginPath(),h.arc(i-1,e+1,3,0,2*Math.PI),h.fillStyle=t.disabled?Ii.grayScale(t.color):t.color,h.fill(),h.fillStyle=Wi.text,h.fillText(t.label,i+9+1,e+6),i+=20,t.disabled&&(h.moveTo(i-10,e+2),h.lineTo(i+a-10,e+2),h.strokeStyle=Wi.text,h.stroke()),{x:i+=a+22,y:e}};class Di{constructor(t,i){Y.add(this),X.set(this,void 0),this.modal=document.createElement(gi.Dialog),this.modal.classList.add("o-modal"),i&&(this.modal.style.width=`${i.width}px`,this.modal.style.height=`${i.height}px`),this.modal.oncancel=()=>this.close(),document.body.appendChild(this.modal),n(this,Y,"m",G).call(this),n(this,Y,"m",J).call(this,t)}open(){Ri.throwIsUndefined(this.modal,ri.ElementNotExist),this.modal.showModal()}close(){Ri.throwIsUndefined(this.modal,ri.ElementNotExist),this.modal.close(),this.modal.remove(),this.modal=void 0}}function Ai(){}X=new WeakMap,Y=new WeakSet,G=function(){Ri.throwIsUndefined(this.modal,ri.ElementNotExist);let t=document.createElement("button");t.classList.add("o-modal-close"),t.innerHTML="x",this.modal.appendChild(t),t.onclick=()=>this.close()},J=function(t){null==n(this,X,"f")&&(wi(this,X,document.createElement(gi.Div),"f"),n(this,X,"f").classList.add("o-modal-content"),this.modal?.appendChild(n(this,X,"f"))),null!=t&&n(this,X,"f").appendChild(t)},Ai.chart=function(t,i){return new bi(t,i)},window.OCharts=Ai,Number.prototype.isAnyEquals=function(...t){return t.includes(this)},Date.prototype.addDays=function(t){let i=new Date(this);return i.setDate(i.getDate()+t),i},Date.prototype.addMilliseconds=function(t){let i=new Date(this);return i.setMilliseconds(i.getMilliseconds()+t),i},Map.prototype.trySet=function(t,i){this.has(t)||this.set(t,i)};class Pi{}Pi.colors=["#000000","#ffffff"],Pi.backgrounds=["#f7f7f7","#222222"],Pi.lines=["#000000","#eeeeee"],Pi.lineAxes=["#dedede","#212121"],Pi.lineActives=["#898989","#898989"],Pi.dropdownBorders=["#bcbcbc","#7e7e7e"],Pi.canvasBackgrounds=["#ffffff","#222222"];class Wi{static initialize(t,i){!Wi.function&&i&&(Wi.function=i),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(!Wi.function||Wi.function())?Wi.setTheme(1):Wi.setTheme(0),window.matchMedia("(prefers-color-scheme: dark)").addEventListener(di.Change,i=>{Wi.setTheme(!i.matches||Wi.function&&!Wi.function()?0:1),t()})}static setTheme(t){Wi.currentTheme=t,Wi.text=Pi.colors[t],Wi.background=Pi.backgrounds[t],Wi.line=Pi.lines[t],Wi.lineAxis=Pi.lineAxes[t],Wi.lineActive=Pi.lineActives[t],Wi.dropdownItemHoverColor=Ii.adjustColor(Wi.background,0==t?-50:50),Wi.dropdownBorder=Pi.dropdownBorders[t],Wi.canvasBackground=Pi.canvasBackgrounds[t]}static reset(){this.function=void 0}}Wi.currentTheme=0;class Ei{constructor(t,i){U.add(this),_.set(this,void 0),K.set(this,void 0),Q.set(this,void 0),Z.set(this,void 0),tt.set(this,void 0),it.set(this,void 0),et.set(this,void 0),st.set(this,void 0),this.canvas=t,this.data=i.data,wi(this,_,i.enableTooltip,"f"),wi(this,K,!!i.templateId,"f"),n(this,K,"f")&&wi(this,Z,document.getElementById(i.templateId),"f"),this.refresh()}render(t,i,e,s){if(n(this,U,"m",at).call(this),n(this,_,"f")&&i)if(t||n(this,tt,"f")||n(this,it,"f")){t&&wi(this,st,e,"f"),n(this,et,"f")||wi(this,et,new Date,"f"),n(this,it,"f")?n(this,tt,"f")&&wi(this,et,new Date,"f"):wi(this,tt,!0,"f"),n(this,K,"f")?n(this,U,"m",ht).call(this,i,s):n(this,U,"m",nt).call(this,i);const h=n(this,U,"m",ot).call(this);n(this,it,"f")&&h>=1&&(wi(this,tt,!1,"f"),wi(this,it,!1,"f")),n(this,it,"f")&&h<=0&&(wi(this,tt,!1,"f"),wi(this,it,!1,"f"),wi(this,et,void 0,"f")),t||null==n(this,et,"f")||wi(this,it,!0,"f")}else wi(this,et,void 0,"f")}refresh(){wi(this,Q,this.canvas.getBoundingClientRect(),"f"),n(this,Q,"f").x+=scrollX,n(this,Q,"f").y+=scrollY}}_=new WeakMap,K=new WeakMap,Q=new WeakMap,Z=new WeakMap,tt=new WeakMap,it=new WeakMap,et=new WeakMap,st=new WeakMap,U=new WeakSet,nt=function(t){const i=Li.getContext(this.canvas),e=Math.max(...n(this,st,"f").map(t=>Ii.stringWidth(t.text??"")+(t.color?8:0)));let s=t.clientX-n(this,Q,"f").x+10,h=t.clientY-n(this,Q,"f").y+scrollY+10;s+e+25>n(this,Q,"f").width&&(s=n(this,Q,"f").width-(e+25)),h+4+18*n(this,st,"f").length>n(this,Q,"f").height&&(h=n(this,Q,"f").height-4-18*n(this,st,"f").length),i.beginPath(),i.roundRect(s,h,e+24,16+16*n(this,st,"f").length,6);let a=Math.round(255*n(this,U,"m",ot).call(this)).toString(16),o=Math.round(207*n(this,U,"m",ot).call(this)).toString(16);1==a.length&&(a="0"+a),1==o.length&&(o="0"+o),i.strokeStyle=Wi.dropdownBorder+o,i.lineWidth=1,i.fillStyle=Wi.background+o,i.stroke(),i.fill();for(let t of n(this,st,"f")){let e=0;t.color&&(e=12,i.beginPath(),i.fillStyle=t.color+a,i.arc(s+16,h+17,5,0,2*Math.PI),i.fill()),Oi.tooltip(i),i.fillStyle=Wi.text+a,i.fillText(t.text??"",s+e+12,h+21),h+=16}},ht=function(t,i){if(null==i)return;const e=n(this,Z,"f").id+i.id;let s=document.getElementById(e);const h=()=>{n(this,U,"m",at).call(this),s.style.visibility=pi.Visibility.Visible};if(!s){const t=/\${[^}]*}/gm;let a=n(this,Z,"f").cloneNode(!0);s=document.createElement(gi.Div),s.innerHTML=a.innerHTML,s.id=e,s.style.position=pi.Position.Absolute,s.style.pointerEvents=pi.PointerEvents.None,s.style.visibility=pi.Visibility.Visible,s.setAttribute(oi.Name,n(this,Z,"f").id);const o=[...s.innerHTML.matchAll(t)];let l=s.innerHTML;for(const t of o){const e=t[0].replace("${","").replace("}","").replaceAll(" ","");l=l.replaceAll(t[0],i.data[e])}s.innerHTML=l,document.body.appendChild(s),s.position=s.getBoundingClientRect(),h()}s.style.visibility==pi.Visibility.Hidden&&h(),0==s.position.height&&(s.position=s.getBoundingClientRect());const a=10;let o="1",l=t.clientX,r=t.clientY+scrollY;l+s.position.width-n(this,Q,"f").x>n(this,Q,"f").width-a&&(l=n(this,Q,"f").width-s.position.width+n(this,Q,"f").x-a,o=".67"),r+s.position.height-n(this,Q,"f").y>n(this,Q,"f").height-a&&(r=n(this,Q,"f").height-s.position.height+n(this,Q,"f").y-a,o=".67"),s.style.left=l+a+"px",s.style.top=r+a+"px",s.style.opacity=o},at=function(){if(!n(this,K,"f"))return;const t=document.querySelectorAll(`[name="${n(this,Z,"f").id}"]`);for(let i of t)i.style.visibility=pi.Visibility.Hidden},ot=function(){if(!n(this,et,"f"))return 0;let t=n(this,it,"f")?1-((new Date).getTime()-n(this,et,"f").getTime())/xi.Animations.tooltip:((new Date).getTime()-n(this,et,"f").getTime())/xi.Animations.tooltip;return t>1&&(t=1),t<0&&(t=0),t};class Li{static getContext(t){return t.getContext("2d",{willReadFrequently:!0})??Ri.throw(ri.NullContext)}static isPixelBusy(t){return 4278190080&t}}class Ri{static throw(t){throw new Error(t)}static throwIsUndefined(t,i){null==t&&Ri.throw(i)}}class Bi{}Bi.number=t=>t?.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})??"",Bi.date=t=>t.toLocaleDateString();class Oi{static title(t){t.fillStyle=Wi.text,t.textAlign="center",t.textBaseline="middle",t.font="20px sans-serif"}static regular(t){t.fillStyle=Wi.text,t.textAlign="center",t.textBaseline="middle",t.font="14px sans-serif"}static large(t){t.fillStyle=Wi.text,t.textAlign="center",t.textBaseline="middle",t.font="16px sans-serif"}static tooltip(t){t.font="14px sans-serif",t.textAlign="start",t.textBaseline="alphabetic"}static circularLabel(t,i){t.textAlign=i?"start":"end",t.textBaseline="alphabetic",t.font="14px sans-serif"}}class Ni extends h{constructor(t){super(t),lt.add(this),rt.set(this,void 0),dt.set(this,void 0),ft.set(this,void 0),ct.set(this,void 0),ut.set(this,void 0),vt.set(this,void 0),gt.set(this,void 0),mt.set(this,void 0),pt.set(this,void 0),xt.set(this,void 0),wt.set(this,void 0),yt.set(this,void 0),Mt.set(this,void 0),bt.set(this,void 0),kt.set(this,void 0),this.data.values=this.data.values.map(t=>new qi(t)),this.settings.enableOther&&(this.settings.contextMenu?this.settings.contextMenu.push({isDivider:!0}):this.settings.contextMenu=[],this.settings.contextMenu.push({text:zi.Show,condition:t=>t?._other,action:()=>{new Di(ki.toChart(this.settings,n(this,Mt,"f")),{width:.8*window.innerWidth,height:.8*window.innerHeight}).open()}})),wi(this,kt,Math.random()%(2*Math.PI),"f"),wi(this,pt,[],"f"),this.onMouseMoveEvent=new MouseEvent(di.MouseMove)}render(){super.render(),wi(this,ut,n(this,kt,"f"),"f"),wi(this,gt,0,"f"),0==this.data.values.filter(t=>!t.disabled).length?n(this,lt,"m",Dt).call(this):n(this,lt,"m",Ct).call(this),0==n(this,gt,"f")&&wi(this,mt,void 0,"f"),this.state=mi.Idle,super.renderDropdown(),n(this,mt,"f")||this.contextMenu?this.renderContextMenu(this.data.values.find(t=>t.id==n(this,mt,"f"))?.data??{}):this.onContextMenuEvent=void 0,n(this,mt,"f")&&(this.canvas.style.cursor=pi.Cursor.Pointer)}refresh(){super.refresh(),this.dropdown?.refresh()}resize(){super.resize(),this.initAnimations(),n(this,lt,"m",Pt).call(this),this.dropdown?.resize()}prepareSettings(){super.prepareSettings(),wi(this,dt,0!=(this.data.innerRadius??0),"f");for(let t of this.data.values)t.disabled=!t.value,t.value??=0,t.current=t.value,t.innerRadius??=this.data.innerRadius??0,t.value<0&&console.warn(`"${t.label}" has negative value (${t.value}) and will not be render`);if(this.data.values=this.data.values.filter(t=>t.value>=0),this.settings.enableOther&&this.data.values.length>20){wi(this,Mt,this.data.values.splice(20),"f");const t=n(this,Mt,"f").reduce((t,i)=>t+i.current,0);this.data.values=this.data.values.slice(0,20),this.data.values.push(new qi({value:t,current:t,label:zi.other,id:Ii.guid(),color:n(this,Mt,"f")[n(this,Mt,"f").length-1].color,innerRadius:this.data.innerRadius,data:{_other:!0}}))}}initDropdown(){super.initDropdown(),this.dropdown=new Ci(this.canvas,{x:-10,y:10,text:zi.menu,items:[{text:zi.exportPNG,action:()=>{Si.asPng(this.canvas,this.settings.title)}},{text:zi.exportCSV,action:()=>{Si.asCsv(ki.toTable(Xi.getRows(this.data)),this.settings.title)}},{isDivider:!0},{text:zi.decomposeToTable,action:()=>{new Di(ki.toTable(Xi.getRows(this.data))).open()}}]})}}rt=new WeakMap,dt=new WeakMap,ft=new WeakMap,ct=new WeakMap,ut=new WeakMap,vt=new WeakMap,gt=new WeakMap,mt=new WeakMap,pt=new WeakMap,xt=new WeakMap,wt=new WeakMap,yt=new WeakMap,Mt=new WeakMap,bt=new WeakMap,kt=new WeakMap,lt=new WeakSet,Ct=function(){if(this.onMouseMoveEvent||this.state==mi.Init){wi(this,ct,this.data.values.reduce((t,i)=>t+i.current,0),"f");let t=n(this,kt,"f");wi(this,yt,this.data.values.flatMap(i=>{const e=i.current/n(this,ct,"f")*2*Math.PI;return{id:i.id,value:e,sum:(t+=e)-e}}).reverse(),"f"),wi(this,wt,n(this,lt,"m",It).call(this,n(this,ft,"f"),0),"f");for(const t of this.data.values)n(this,lt,"m",St).call(this,t);const i=this.data.values.find(t=>t.id==n(this,mt,"f"));this.tooltip.render(!!i&&!this.dropdown?.isActive,this.onMouseMoveEvent,[new Yi(`${i?.label}: ${Bi.number(i?.current)}`)],i),n(this,lt,"m",At).call(this)}this.isDestroy||requestAnimationFrame(this.render.bind(this))},St=function(t){var i;const e=Li.getContext(this.canvas);e.fillStyle=t.color,e.strokeStyle=t.color;const s=t.current/n(this,ct,"f"),h=2*(isNaN(s)?1:s)*Math.PI,a=1==this.data.values.filter(t=>!t.disabled).length;if(!this.onClickEvent&&!n(this,pt,"f").includes(t.id)||this.animations.contains(t.id,ai.Init)||a||this.animations.add(t.id,ai.Click,{duration:xi.Animations.circular,before:()=>(this.onClickEvent&&n(this,lt,"m",Tt).call(this,this.onClickEvent,t)&&(n(this,pt,"f").includes(t.id)?wi(this,pt,n(this,pt,"f").filter(i=>i!=t.id),"f"):n(this,pt,"f").push(t.id),this.onClickEvent=new PointerEvent(di.Click)),!0),body:()=>{if(!n(this,pt,"f").includes(t.id))return;const i=t.current/n(this,ct,"f"),s=2*(isNaN(i)?1:i)*Math.PI,h=n(this,ut,"f")+s/2,a={x:n(this,vt,"f")*Math.cos(h),y:n(this,vt,"f")*Math.sin(h)};e.translate(a.x,a.y),e.lineWidth=8,e.lineJoin="round",e.lineCap="round",e.fillStyle=t.color}}),this.onMouseMoveEvent&&n(this,lt,"m",Tt).call(this,this.onMouseMoveEvent,t)&&(wi(this,mt,t.id,"f"),wi(this,gt,(i=n(this,gt,"f"),++i),"f")),this.state==mi.Init||this.animations.contains(t.id,ai.Init))this.animations.add(t.id,ai.Init,{duration:xi.Animations.circular+(this.data.values.indexOf(t)+1)/this.data.values.length*xi.Animations.circular,continuous:!0,body:i=>{const s=n(this,xt,"f").x+n(this,ft,"f")/2*Math.cos(n(this,ut,"f")+h/2),a=n(this,xt,"f").y+n(this,ft,"f")/2*Math.sin(n(this,ut,"f")+h/2),o=.7,l=1-o;e.translate(s-s*(o+i*l),a-a*(o+i*l)),e.scale(o+i*l,o+i*l);let r=Math.round(255*i).toString(16);r.length<2&&(r=0+r),e.fillStyle=t.color+r,e.strokeStyle=t.color+r}});else if(this.onMouseMoveEvent&&!this.animations.contains(t.id,ai.Init)&&!n(this,pt,"f").includes(t.id)&&!a){const i=(i,s,h)=>{if(this.animations.reload(t.id,s),e.lineWidth=1,e.lineJoin="miter",e.lineCap="butt",0==i)return;h&&(i=t.transition);const a=t.current/n(this,ct,"f"),o=2*(isNaN(a)?1:a)*Math.PI,l=n(this,ut,"f")+o/2,r={x:n(this,vt,"f")*Math.cos(l)*i,y:n(this,vt,"f")*Math.sin(l)*i};e.translate(r.x,r.y),e.lineWidth=8*i,e.lineJoin="round",e.lineCap="round",t.translate=r,t.transition=i};n(this,lt,"m",Tt).call(this,this.onMouseMoveEvent,t)&&this.animations.contains(t.id,ai.MouseLeave)?this.animations.add(t.id,ai.MouseOver,{duration:xi.Animations.circular,body:e=>{i(e,ai.MouseLeave,t.transition>e)}}):this.animations.add(t.id,ai.MouseLeave,{timer:xi.Dates.minDate,duration:xi.Animations.circular,backward:!0,body:e=>{i(e,ai.MouseOver,t.transition<e)}})}let o=n(this,lt,"m",It).call(this,n(this,ft,"f"),h);if(h>0){if(e.save(),t.current>0){let i=n(this,lt,"m",It).call(this,n(this,ft,"f")+10,h/2),s=n(this,lt,"m",It).call(this,n(this,ft,"f")+20,h/2);const a=i.x>n(this,xt,"f").x?1:-1;let o={x:s.x+10*a,y:s.y},l=!1;const r=Ii.stringWidth(t.label),d=1==a?o.x+12:o.x-r-12,f=new Uint32Array(e.getImageData(d,o.y-12,r+12,28).data.buffer);if((d<0||d+r>this.canvas.width||o.y-12<0||o.y+12>this.canvas.height)&&(l=!0),!l)for(let t=0;t<f.length;t++)if(Li.isPixelBusy(f[t])){l=!0;break}if(!l){e.beginPath(),e.moveTo(i.x,i.y),e.quadraticCurveTo(s.x,s.y,o.x,o.y);let n=Math.round(t.current/t.value*255).toString(16);n.length<2&&(n=0+n),e.strokeStyle=Wi.text+n,e.lineCap="butt",e.lineJoin="miter",e.lineWidth=1,e.stroke(),e.fillStyle=Wi.text+n,Oi.circularLabel(e,1==a),e.fillText(t.label,o.x+8*a,o.y+4)}}e.restore(),e.beginPath(),n(this,dt,"f")||e.moveTo(n(this,xt,"f").x,n(this,xt,"f").y),e.lineTo(n(this,wt,"f").x,n(this,wt,"f").y);let i=0,s=h;for(;s>0;){let t=s-Math.PI/6>0?Math.PI/6:s;o=n(this,lt,"m",It).call(this,n(this,ft,"f"),i+t);const h=Math.PI-t,a=n(this,ft,"f")/Math.sin(h/2),l=n(this,lt,"m",It).call(this,a,i+t/2);e.quadraticCurveTo(l.x,l.y,o.x,o.y),i+=t,s-=Math.PI/6}if(n(this,dt,"f")||0!=t.innerRadius){const a=n(this,ft,"f")*(t.innerRadius/100),l={x:o.x-(n(this,ft,"f")-a)*(o.x-n(this,xt,"f").x)/n(this,ft,"f"),y:o.y-(n(this,ft,"f")-a)*(o.y-n(this,xt,"f").y)/n(this,ft,"f")};for(e.lineTo(l.x,l.y),s=0,i=h;s<h;){let t=s+Math.PI/6<h?Math.PI/6:h-s;o=n(this,lt,"m",It).call(this,a,i-t);const l=Math.PI-t,r=a/Math.sin(l/2),d=n(this,lt,"m",It).call(this,r,i-t/2);e.quadraticCurveTo(d.x,d.y,o.x,o.y),i-=t,s+=Math.PI/6}o=n(this,lt,"m",It).call(this,n(this,ft,"f"),h)}if(!this.animations.contains(t.id,ai.Init)){const i=(i,s)=>{if(this.animations.reload(t.id,s),0==i)return;let n=Math.round(255-95*i).toString(16);n.length<2&&(n=0+n),e.fillStyle=t.color+n,e.strokeStyle=t.color+n},s=0!=this.highlightItems.length;n(this,mt,"f")&&n(this,mt,"f")!=t.id||s&&!this.highlightItems.includes(t.id)?this.animations.add(t.id,ai.AnotherItemOver,{duration:xi.Animations.circular,body:t=>{i(t,ai.AnotherItemLeave)}}):null!=n(this,mt,"f")&&s||this.animations.add(t.id,ai.AnotherItemLeave,{timer:xi.Dates.minDate,duration:xi.Animations.circular,backward:!0,body:t=>{i(t,ai.AnotherItemOver)}})}e.closePath(),e.fill(),e.stroke(),wi(this,ut,n(this,ut,"f")+h,"f")}e.resetTransform(),wi(this,wt,o,"f")},It=function(t,i){return{x:n(this,xt,"f").x+t*Math.cos(n(this,ut,"f")+i),y:n(this,xt,"f").y+t*Math.sin(n(this,ut,"f")+i)}},Tt=function(t,i){const e=t=>t.x*t.x+t.y*t.y<=n(this,ft,"f")*n(this,ft,"f")&&(!n(this,dt,"f")||t.x*t.x+t.y*t.y>=n(this,ft,"f")*(i.innerRadius/100)*n(this,ft,"f")*(i.innerRadius/100)),s=this.getMousePosition(t),h={x:s.x-n(this,xt,"f").x,y:s.y-n(this,xt,"f").y},a={x:s.x-n(this,xt,"f").x-i.translate?.x,y:s.y-n(this,xt,"f").y-i.translate?.y};return(t=>{let e=Math.atan2(t.y-n(this,xt,"f").y,t.x-n(this,xt,"f").x);e<0&&(e+=2*Math.PI),e<n(this,kt,"f")&&(e=2*Math.PI-Math.abs(n(this,kt,"f")-e)+n(this,kt,"f"));let s=n(this,yt,"f").findIndex(t=>t.id==i.id),h=n(this,yt,"f")[s].sum;return!this.dropdown?.isActive&&h<=e&&h+n(this,yt,"f")[s].value-e>=0})(s)&&(e(h)||e(a))},Dt=function(){const t=Li.getContext(this.canvas);t.beginPath(),t.arc(n(this,xt,"f").x,n(this,xt,"f").y,n(this,ft,"f"),0,2*Math.PI),t.strokeStyle=Wi.text,t.stroke(),Oi.regular(t),t.fillText(zi.allDataIsHidden,n(this,xt,"f").x,n(this,xt,"f").y),requestAnimationFrame(this.render.bind(this))},At=function(){if(n(this,rt,"f")){const t=Li.getContext(this.canvas);n(this,bt,"f").call(this,t),t.fillText(this.data.innerTitle,n(this,xt,"f").x,n(this,xt,"f").y)}},Pt=function(){const t=this.settings.title?xi.Values.titleOffset:0,i=this.canvas.width>this.canvas.height-2*t?this.canvas.height-2*t:this.canvas.width;wi(this,xt,{x:this.canvas.width/2,y:t+this.canvas.height/2},"f"),wi(this,ft,i/3,"f"),null!=this.data.innerTitle&&""!=this.data.innerTitle&&(wi(this,bt,Oi.large,"f"),wi(this,rt,Ii.stringWidth(this.data.innerTitle,16)<this.data.innerRadius/100*n(this,ft,"f")*2,"f"),n(this,rt,"f")||(wi(this,bt,Oi.regular,"f"),wi(this,rt,Ii.stringWidth(this.data.innerTitle,14)<this.data.innerRadius/100*n(this,ft,"f")*2,"f")),n(this,rt,"f")||console.warn("Inner title is declared, but can't be rendered")),wi(this,vt,.1*n(this,ft,"f"),"f")};class $i extends h{constructor(t){super(t),Wt.add(this),Et.set(this,void 0),Lt.set(this,void 0),this.settings.enableLegend=!1}render(){super.render(),n(this,Wt,"m",Rt).call(this);const t=this.data.values[0];this.tooltip.render(n(this,Wt,"m",Bt).call(this,this.onMouseMoveEvent,t)&&!this.dropdown?.isActive,this.onMouseMoveEvent,[new Yi(`${t?.label}: ${Bi.number(t?.current)}`)],t),this.isDestroy||requestAnimationFrame(this.render.bind(this)),this.state=mi.Idle,super.renderDropdown()}refresh(){super.refresh()}resize(){super.resize(),this.initAnimations(),n(this,Wt,"m",Ot).call(this)}prepareSettings(){super.prepareSettings();for(let t of this.data.values)t.disabled=!t.value,t.value??=0;this.data.values.length>0&&this.data.values[0].value>this.data.max&&(this.data.values[0].value=this.data.max)}initDropdown(){super.initDropdown(),this.dropdown=new Ci(this.canvas,{x:-10,y:10,text:zi.menu,items:[{text:zi.exportPNG,action:()=>{Si.asPng(this.canvas,this.settings.title)}}]})}}Et=new WeakMap,Lt=new WeakMap,Wt=new WeakSet,Rt=function(){const t=Li.getContext(this.canvas),i=this.data.values[0]??{id:Ii.guid()};(this.state==mi.Init||this.animations.contains(i.id,ai.Init))&&this.animations.add(i.id,ai.Init,{duration:450,continuous:!0,body:t=>{i.current=i.value*t}}),t.beginPath(),t.strokeStyle=i.color,t.lineCap="round",t.lineWidth=40;const e=i.current/this.data.max,s=(isNaN(e)?1:e)*Math.PI;i.value&&(t.arc(n(this,Lt,"f").x,n(this,Lt,"f").y,n(this,Et,"f"),Math.PI,s-Math.PI),t.stroke()),t.beginPath(),t.lineWidth=1,t.lineCap="square";let h=0,a=Math.PI;for(;a>=0;){let i=a-Math.PI/10>0?Math.PI/10:a;const e=t=>({x:n(this,Lt,"f").x+(n(this,Et,"f")+t)*Math.cos(Math.PI+h),y:n(this,Lt,"f").y+(n(this,Et,"f")+t)*Math.sin(Math.PI+h)});let o=e(50),l=e(90),r=e(115);const d=Math.PI-a>s?"66":"ff";t.moveTo(o.x,o.y),t.lineTo(l.x,l.y),t.strokeStyle=Wi.text+d,t.stroke(),Oi.regular(t),t.fillStyle=Wi.text+d,t.fillText((this.data.max-a/Math.PI*this.data.max).toString(),r.x,r.y),h+=i,a-=Math.PI/10}},Bt=function(t,i){if(!t)return!1;const e=this.getMousePosition(t),s={x:e.x-n(this,Lt,"f").x,y:e.y-n(this,Lt,"f").y};return!this.dropdown?.isActive&&(t=>{let e=Math.atan2(t.y-n(this,Lt,"f").y,t.x-n(this,Lt,"f").x);e<0&&(e+=2*Math.PI);const s=i.current/this.data.max,h=(isNaN(s)?1:s)*Math.PI;return e>Math.PI&&Math.PI+h>=e})(e)&&(t=>{const i=n(this,Et,"f")+20,e=n(this,Et,"f")-20;return t.x*t.x+t.y*t.y<=i*i&&t.x*t.x+t.y*t.y>=e*e})(s)},Ot=function(){const t=this.canvas.width<this.canvas.height?this.canvas.height-250:this.canvas.width;wi(this,Et,t/3,"f"),wi(this,Lt,{x:this.canvas.width/2,y:this.canvas.height-n(this,Et,"f")/5},"f")};class Hi extends h{constructor(t){if(super(t),Nt.add(this),$t.set(this,void 0),Ht.set(this,void 0),Ft.set(this,void 0),zt.set(this,void 0),Vt.set(this,void 0),jt.set(this,void 0),qt.set(this,void 0),Yt.set(this,void 0),Xt.set(this,void 0),Gt.set(this,void 0),Jt.set(this,void 0),Ut.set(this,void 0),_t.set(this,void 0),Kt.set(this,void 0),this.data.values=this.data.values.map(t=>new ji(t)),this.data.values.filter(t=>t.type==vi.Bar).length>0)for(let t of this.data.values){for(let i of t.values){const t=i.x;i.x=i.y,i.y=t}t.values.sort((t,i)=>i.x>t.x?1:-1)}wi(this,Ft,{top:30,right:40,bottom:50,left:80},"f"),this.settings.title&&(n(this,Ft,"f").top+=xi.Values.titleOffset),this.tooltip=new Ei(this.canvas,this.settings),wi(this,jt,new Map,"f"),wi(this,qt,new Map,"f")}render(){super.render();let t=[new Yi(n(this,jt,"f").get(Math.round(n(this,zt,"f")))??n(this,qt,"f").get(Math.round(n(this,Vt,"f"))))];const i=Li.getContext(this.canvas);Oi.regular(i),i.lineJoin="round";const e=Wi.lineActive;n(this,Nt,"m",ii).call(this),n(this,Nt,"m",ti).call(this,!0);let s=0,h=0,a=0,o=0,l=0,r=0,d=this.data.values.filter(t=>t.type==vi.Column).length,f=0,c=this.data.values.filter(t=>t.type==vi.Bar).length,u=n(this,Ht,"f").step/(2*c),v=[];for(let t=0;t<n(this,Xt,"f").length;t++)v.push(0);for(const c of this.data.values.filter(t=>!t.disabled)){i.beginPath(),i.strokeStyle=c.color,i.fillStyle=c.color,i.lineWidth=c.width,i.lineCap="round";const g=0!=this.highlightItems.length;if(!this.animations.contains(c.id,ai.Init)){const t=(t,e)=>{if(this.animations.reload(c.id,e),0==t)return;let s=Math.round(255-95*t).toString(16);s.length<2&&(s=0+s),i.fillStyle=c.color+s,i.strokeStyle=c.color+s};g&&!this.highlightItems.includes(c.id)?this.animations.add(c.id,ai.AnotherItemOver,{duration:xi.Animations.circular,body:i=>{t(i,ai.AnotherItemLeave)}}):g||this.animations.add(c.id,ai.AnotherItemLeave,{timer:xi.Dates.minDate,duration:xi.Animations.circular,backward:!0,body:i=>{t(i,ai.AnotherItemOver)}})}switch(c.lineType){case ci.Dash:i.setLineDash([3*c.width,2*c.width]);break;case ci.Dotted:i.setLineDash([c.width,c.width]);case ci.Solid:}for(const e of c.values){let m=c.values.indexOf(e),p=n(this,Yt,"f").indexOf(this.data.xType==ui.Date?e.x.toString():e.x),x=n(this,Xt,"f").indexOf(e.y);const w=()=>({x:e.x?this.data.xType==ui.Date?n(this,Yt,"f")[p]:Bi.number(n(this,Yt,"f")[p]):"0",y:e.y?Bi.number(n(this,Xt,"f")[x]):"0"});switch(s=n(this,Ft,"f").left,c.type!=vi.Bar&&(s+=p*n(this,$t,"f").step),c.type==vi.Line&&(s-=n(this,$t,"f").step/2-n(this,$t,"f").step),c.type){case vi.Line:h=n(this,Ft,"f").top+n(this,_t,"f").height-e.y/n(this,Ht,"f").unit*n(this,Ht,"f").step-Math.abs(n(this,Ht,"f").min/n(this,Ht,"f").unit*n(this,Ht,"f").step);const y=1500/c.values.length*1.2;this.state==mi.Init||this.animations.contains(e.id,ai.Init)?this.animations.add(e.id,ai.Init,{timer:new Date(Date.now()).addMilliseconds(y*(m-1)),duration:y,continuous:!0,body:t=>{if(0==m)return;s=n(this,Ft,"f").left+p*n(this,$t,"f").step-n(this,$t,"f").step/2,h=n(this,Ft,"f").top+n(this,_t,"f").height-e.y/n(this,Ht,"f").unit*n(this,Ht,"f").step-Math.abs(n(this,Ht,"f").min/n(this,Ht,"f").unit*n(this,Ht,"f").step);const a=c.values[m-1];let o={x:n(this,Ft,"f").left+p*n(this,$t,"f").step-n(this,$t,"f").step/2,y:n(this,Ft,"f").top+n(this,_t,"f").height-a.y/n(this,Ht,"f").unit*n(this,Ht,"f").step-Math.abs(n(this,Ht,"f").min/n(this,Ht,"f").unit*n(this,Ht,"f").step)};const l=o.x+(n(this,$t,"f").step+(s-o.x))*t,r=o.y+(h-o.y)*t;o.x!=l&&o.y!=r&&(i.moveTo(o.x,o.y),i.lineTo(l,r))}}):(i.lineTo(s,h),n(this,Nt,"m",Qt).call(this,s)&&(wi(this,Kt,{x:s,y:h,index:m,data:e.data,series:c},"f"),t.push(new Yi(`${c.label}: ${w().y}`,c.color)),wi(this,zt,s-n(this,$t,"f").step/2,"f")));break;case vi.AttentionLine:a=this.canvas.height-n(this,Ft,"f").bottom-e.y/n(this,Ht,"f").unit*n(this,Ht,"f").step,i.moveTo(n(this,Ft,"f").left,a),this.state==mi.Init||this.animations.contains(e.id,ai.Init)?this.animations.add(e.id,ai.Init,{duration:1500,continuous:!0,body:t=>{i.lineTo(n(this,Ft,"f").left+(this.canvas.width-n(this,Ft,"f").left-n(this,Ft,"f").right)*t,this.canvas.height-n(this,Ft,"f").bottom-e.y/n(this,Ht,"f").unit*n(this,Ht,"f").step)}}):i.lineTo(this.canvas.width-n(this,Ft,"f").right,a);break;case vi.Column:a=e.y>this.data.yMax?this.data.yMax:e.y,h=n(this,_t,"f").height*a/n(this,Ht,"f").max,h<n(this,Ht,"f").minStep&&(h=n(this,Ht,"f").minStep),l=n(this,$t,"f").step*(c.width?c.width/100:.5)/d,this.state==mi.Init||this.animations.contains(e.id+r,ai.Init)?this.animations.add(e.id+r,ai.Init,{duration:800,continuous:!0,body:t=>{a=e.y>this.data.yMax?this.data.yMax:e.y,s=n(this,Ft,"f").left+p*n(this,$t,"f").step,h=n(this,_t,"f").height*a/n(this,Ht,"f").max*t,h<n(this,Ht,"f").minStep&&(h=n(this,Ht,"f").minStep*t),r=this.data.values.filter(t=>t.type==vi.Column).indexOf(c),i.fillRect(s+r*l+(n(this,$t,"f").step-d*l)/2,this.canvas.height-n(this,Ft,"f").bottom-h,l,h)}}):(g||(!n(this,Nt,"m",Zt).call(this,s+r*l+(n(this,$t,"f").step-d*l)/2,this.canvas.height-n(this,Ft,"f").bottom-h,l,h)||null!=this.contextMenu?.isActive&&0!=this.contextMenu?.isActive?i.fillStyle=c.color:(wi(this,Kt,{x:s,y:h,index:m,data:e.data,series:c},"f"),t.push(new Yi(`${c.label}: ${w().y}`,c.color)),wi(this,zt,s,"f"),i.fillStyle+="88")),i.fillRect(s+r*l+(n(this,$t,"f").step-d*l)/2,this.canvas.height-n(this,Ft,"f").bottom-h,l,h));break;case vi.Bar:h=n(this,Ft,"f").top+x*n(this,Ht,"f").step+n(this,Ht,"f").step/2;const M=c.width??u;this.state==mi.Init||this.animations.contains(e.id+f,ai.Init)?this.animations.add(e.id+f,ai.Init,{duration:800,continuous:!0,body:t=>{h=n(this,Ft,"f").top+x*n(this,Ht,"f").step+n(this,Ht,"f").step/2,f=this.data.values.filter(t=>t.type==vi.Bar).indexOf(c),i.fillRect(s,h-n(this,Ht,"f").step/4+f*M,e.x/n(this,$t,"f").unit*n(this,$t,"f").step*t,M)}}):(g||(n(this,Nt,"m",Zt).call(this,s,h-n(this,Ht,"f").step/4+f*M,e.x/n(this,$t,"f").unit*n(this,$t,"f").step,M)?(wi(this,Kt,{x:s,y:h,index:m,data:e.data,series:c},"f"),i.fillStyle+="88",t.push(new Yi(`${c.label}: ${w().x}`,c.color)),wi(this,Vt,h-n(this,Ht,"f").step/2,"f")):i.fillStyle=c.color),i.fillRect(s,h-n(this,Ht,"f").step/4+f*M,e.x/n(this,$t,"f").unit*n(this,$t,"f").step,M));break;case vi.StackingColumn:if(h=this.canvas.height-n(this,Ft,"f").bottom-e.y/n(this,Ht,"f").unit*n(this,Ht,"f").step,l=n(this,$t,"f").step*(c.width?c.width/100:.5),this.state==mi.Init||this.animations.contains(e.id+m,ai.Init))this.animations.add(e.id+m,ai.Init,{duration:800,continuous:!0,body:t=>{r=this.data.values.filter(t=>t.type==vi.StackingColumn&&t.values.filter(t=>t.x==e.x).length>0).indexOf(c),s=n(this,Ft,"f").left+p*n(this,$t,"f").step,h=this.canvas.height-n(this,Ft,"f").bottom-e.y/n(this,Ht,"f").unit*n(this,Ht,"f").step,0==r&&(v[p]=0);let d=null!=v[p]?v[p]:0;a=this.canvas.height-n(this,Ft,"f").bottom+d,o=(h-this.canvas.height+n(this,Ft,"f").bottom)*t,a>n(this,Ft,"f").top&&(a+o<n(this,Ft,"f").top&&(o-=a+o-n(this,Ft,"f").top),i.fillRect(s+(n(this,$t,"f").step-l)/2,a,l,o)),v[p]+=(h-this.canvas.height+n(this,Ft,"f").bottom)*t}});else{0==r&&(v[p]=0);let d=null!=v[p]?v[p]:0;a=this.canvas.height-n(this,Ft,"f").bottom+d,o=h-this.canvas.height+n(this,Ft,"f").bottom,a>n(this,Ft,"f").top&&(a+o<n(this,Ft,"f").top&&(o-=a+o-n(this,Ft,"f").top),g||(n(this,Nt,"m",Zt).call(this,s+(n(this,$t,"f").step-l)/2,a+o,l,Math.abs(o))?(wi(this,Kt,{x:s,y:h,index:p,data:e.data,series:c},"f"),t.push(new Yi(`${c.label}: ${w().y}`,c.color)),wi(this,zt,s,"f"),i.fillStyle+="88"):i.fillStyle=c.color),i.fillRect(s+(n(this,$t,"f").step-l)/2,a,l,o)),v[p]+=h-this.canvas.height+n(this,Ft,"f").bottom}}}switch(i.setLineDash([]),c.type){case vi.Line:if(i.stroke(),n(this,Kt,"f")&&n(this,Kt,"f").series==c){const t=this.getMousePosition(this.onMouseMoveEvent);Math.abs(t.x-n(this,Kt,"f").x)<25&&Math.abs(t.y-n(this,Kt,"f").y)<25&&(i.beginPath(),i.lineWidth=1,i.strokeStyle=e,i.moveTo(n(this,Ft,"f").left,n(this,Kt,"f").y),i.lineTo(this.canvas.width-n(this,Ft,"f").right,n(this,Kt,"f").y),i.stroke());let s=Math.round(1.1*c.width);s<5&&(s=5),i.beginPath(),i.arc(n(this,Kt,"f").x,n(this,Kt,"f").y,s,0,2*Math.PI),i.fill(),i.lineWidth=Math.ceil(s/2),i.strokeStyle=Ii.adjustColor(c.color,50),i.stroke()}break;case vi.AttentionLine:i.stroke(),Oi.regular(i),i.fillText(c.label,n(this,Ft,"f").left+(this.canvas.width-n(this,Ft,"f").left-n(this,Ft,"f").right)/2,this.canvas.height-n(this,Ft,"f").bottom-c.values[0].y/n(this,Ht,"f").unit*n(this,Ht,"f").step+16);break;case vi.Column:case vi.StackingColumn:if(n(this,Kt,"f")){let t=null!=v[n(this,Kt,"f").index]?v[n(this,Kt,"f").index]:0;this.canvas.height-n(this,Ft,"f").bottom+t>n(this,Ft,"f").top&&(i.lineWidth=1,i.strokeStyle=e,i.moveTo(n(this,zt,"f")+n(this,$t,"f").step/2,n(this,Ft,"f").top),i.lineTo(n(this,zt,"f")+n(this,$t,"f").step/2,this.canvas.height-n(this,Ft,"f").bottom+t),i.stroke())}r++;break;case vi.Bar:n(this,Kt,"f")&&(i.lineWidth=1,i.strokeStyle=e,i.moveTo(n(this,Ft,"f").left,n(this,Vt,"f")+n(this,Ht,"f").step/2),i.lineTo(this.canvas.width-n(this,Ft,"f").right,n(this,Vt,"f")+n(this,Ht,"f").step/2),i.stroke()),f++}}n(this,Nt,"m",ti).call(this),this.tooltip.render(t.length>1&&!this.dropdown?.isActive,this.onMouseMoveEvent,t,n(this,Kt,"f")?n(this,Kt,"f").series.values[n(this,Kt,"f").index]:void 0),this.isDestroy||requestAnimationFrame(this.render.bind(this)),this.state=mi.Idle,super.renderDropdown(),this.onContextMenuEvent&&!n(this,Kt,"f")&&(this.onContextMenuEvent=void 0),!n(this,Kt,"f")||!this.renderContextMenu(n(this,Kt,"f").data)&&this.onContextMenuEvent||wi(this,Kt,void 0,"f")}refresh(){super.refresh()}resize(){super.resize(),wi(this,Gt,void 0,"f"),n(this,Nt,"m",ei).call(this)}prepareSettings(){super.prepareSettings();for(let t of this.data.values){t.disabled=!t.values,t.type??=vi.Line;for(let i of t.values)i.id=Ii.guid(),this.data.xType==ui.Date&&(Ii.isISOString(i.x)?i.x=new Date(i.x):console.warn(`${i.x} is not a date in ISO format.`))}}initDropdown(){super.initDropdown(),this.dropdown=new Ci(this.canvas,{x:-10,y:10,text:zi.menu,items:[{text:zi.exportPNG,action:()=>{Si.asPng(this.canvas,this.settings.title)}},{text:zi.exportCSV,action:()=>{Si.asCsv(ki.toTable(Gi.getRows(this.data)),this.settings.title)}},{isDivider:!0},{text:zi.decomposeToTable,action:()=>{new Di(ki.toTable(Gi.getRows(this.data))).open()}}]})}}$t=new WeakMap,Ht=new WeakMap,Ft=new WeakMap,zt=new WeakMap,Vt=new WeakMap,jt=new WeakMap,qt=new WeakMap,Yt=new WeakMap,Xt=new WeakMap,Gt=new WeakMap,Jt=new WeakMap,Ut=new WeakMap,_t=new WeakMap,Kt=new WeakMap,Nt=new WeakSet,Qt=function(t){if(!this.onMouseMoveEvent)return!1;const i=this.getMousePosition(this.onMouseMoveEvent);return!this.dropdown?.isActive&&t-n(this,$t,"f").step/2<=i.x&&i.x<t+n(this,$t,"f").step/2&&n(this,Ft,"f").top<=i.y&&i.y<=this.canvas.height-n(this,Ft,"f").bottom&&n(this,Ft,"f").left<i.x},Zt=function(t,i,e,s){if(!this.onMouseMoveEvent)return!1;const n=this.getMousePosition(this.onMouseMoveEvent);return!this.dropdown?.isActive&&n.x>=t&&n.x<=t+e&&n.y>=i&&n.y<=i+s},ti=function(t=!1){if(n(this,Gt,"f")&&t)return;if(this.data.simple)return;const i=Li.getContext(this.canvas);if(t&&i.clearRect(0,0,this.canvas.width,this.canvas.height),n(this,Gt,"f"))return void i.drawImage(n(this,Gt,"f"),0,0);if(!t)return;i.fillStyle=Wi.canvasBackground,i.fillRect(0,0,n(this,Ft,"f").left,this.canvas.height),i.fillRect(0,0,this.canvas.width,n(this,Ft,"f").top),i.fillRect(this.canvas.width-n(this,Ft,"f").right,0,this.canvas.width,this.canvas.height),i.fillRect(0,this.canvas.height-n(this,Ft,"f").bottom,this.canvas.width,this.canvas.height);const e=this.data.values.filter(t=>t.type==vi.Bar).length>0;(this.data.xTitle||this.data.yTitle)&&(i.textAlign="center",i.textBaseline="bottom",i.fillStyle=Wi.text,this.data.xTitle&&i.fillText(this.data.xTitle,n(this,Ft,"f").left+(this.canvas.width-n(this,Ft,"f").left-n(this,Ft,"f").right)/2,this.canvas.height-4),this.data.yTitle&&(i.rotate(-Math.PI/2),i.textBaseline="top",i.fillText(this.data.yTitle,-(n(this,Ft,"f").top+(this.canvas.height-n(this,Ft,"f").top-n(this,Ft,"f").bottom)/2),8),i.resetTransform())),i.textAlign="center",i.textBaseline="top";const s=n(this,$t,"f").step,h=this.canvas.height-n(this,Ft,"f").bottom;let a=0,o=n(this,Ft,"f").left+s/2;for(let t=0;t<n(this,Yt,"f").length+1;t++)n(this,jt,"f").trySet(Math.round(n(this,Ft,"f").left+t*n(this,$t,"f").step),this.data.xType==ui.Date?Bi.date(new Date(n(this,Yt,"f")[t-1])):isNaN(+n(this,$t,"f").min)||!isFinite(+n(this,$t,"f").min)?n(this,Yt,"f")[t-1]:Bi.number(n(this,$t,"f").min+t*(n(this,$t,"f").max-n(this,$t,"f").min)/(n(this,$t,"f").count-1)));const l=Math.max(...[...n(this,jt,"f").values()].map(t=>Math.ceil(Ii.stringWidth(t))))+10,r=Math.floor((this.canvas.width-n(this,Ft,"f").left-n(this,Ft,"f").right)/l),d=Math.ceil(1/(r/n(this,Yt,"f").length));for(;o<this.canvas.width-n(this,Ft,"f").right;)a%d==0&&(i.fillStyle=Wi.text+"b7",i.fillText(n(this,jt,"f").get(Math.round(o-n(this,$t,"f").step/2))??"",o,h+6)),o+=s,a++;i.textAlign="right",i.textBaseline="middle";const f=n(this,Ht,"f").count>10?10:n(this,Ht,"f").count;let c=e?1:0,u=n(this,Xt,"f").length/f;for(let t=e?1:0;t<n(this,Xt,"f").length+1;t++){const s=this.canvas.height-c*u*n(this,Ht,"f").step-n(this,Ft,"f").bottom,h=Math.round(this.canvas.height-t*n(this,Ht,"f").step-n(this,Ft,"f").bottom);if(n(this,qt,"f").get(h)||n(this,qt,"f").set(h,Bi.number(n(this,Ht,"f").min+(t+(e?-1:0))*(n(this,Ht,"f").max-n(this,Ht,"f").min)/n(this,Ht,"f").count)),t>=c*u){const t={x:n(this,Ft,"f").left,y:s,label:n(this,Ut,"f")>=1?Math.round((n(this,Ht,"f").min+(c*u+(e?-1:0))*(n(this,Ht,"f").max-n(this,Ht,"f").min)/n(this,Ht,"f").count)/n(this,Ut,"f"))*n(this,Ut,"f"):Math.round(n(this,Ht,"f").min+(c*u+(e?-1:0))*(n(this,Ht,"f").max-n(this,Ht,"f").min)/n(this,Ht,"f").count/n(this,Ut,"f"))*n(this,Ut,"f")};let h="";if(this.data.shortLabels){const i=Math.floor(t.label.toString().length/4);i>0&&(t.label/=Math.pow(1e3,i),h=[zi.ThousandShort,zi.MillionShort,zi.BillionShort][i-1])}i.fillText(Bi.number(t.label)+h,t.x-12,t.y+(e?n(this,Ht,"f").step/2:0)),c++}}i.beginPath(),i.strokeStyle=Wi.line,i.lineWidth=1;const v=.5,g=this.data.values.filter(t=>t.type==vi.Bar).length>0;i.moveTo(n(this,Ft,"f").left-v,this.canvas.height-n(this,Ft,"f").bottom+(g?-.5:v)),g?i.lineTo(n(this,Ft,"f").left-v,n(this,Ft,"f").top):i.lineTo(this.canvas.width-n(this,Ft,"f").right,this.canvas.height-n(this,Ft,"f").bottom+v),i.stroke(),this.canvas.width>0&&this.canvas.height>0&&createImageBitmap(i.getImageData(0,0,this.canvas.width,this.canvas.height)).then(t=>wi(this,Gt,t,"f"))},ii=function(){if(this.data.simple)return;const t=Li.getContext(this.canvas);if(n(this,Jt,"f"))return void t.putImageData(n(this,Jt,"f"),0,0);t.clearRect(0,0,this.canvas.width,this.canvas.height);const i=Wi.lineAxis,e=this.data.values.filter(t=>t.type==vi.Bar).length>0;if(e){const e=n(this,$t,"f").step,s=this.canvas.height-n(this,Ft,"f").bottom;let h=0,a=n(this,Ft,"f").left+e/2;for(let t=0;t<n(this,Yt,"f").length+1;t++)n(this,jt,"f").trySet(Math.round(n(this,Ft,"f").left+t*n(this,$t,"f").step),this.data.xType==ui.Date?Bi.date(new Date(n(this,Yt,"f")[t-1])):isNaN(+n(this,$t,"f").min)||!isFinite(+n(this,$t,"f").min)?n(this,Yt,"f")[t-1]:Bi.number(n(this,$t,"f").min+t*(n(this,$t,"f").max-n(this,$t,"f").min)/(n(this,$t,"f").count-1)));const o=Math.max(...[...n(this,jt,"f").values()].map(t=>Math.ceil(Ii.stringWidth(t))))+10,l=Math.floor((this.canvas.width-n(this,Ft,"f").left-n(this,Ft,"f").right)/o),r=Math.ceil(1/(l/n(this,Yt,"f").length));for(;a<this.canvas.width-n(this,Ft,"f").right;)h%r==0&&(t.beginPath(),t.moveTo(a,s),t.lineTo(a,n(this,Ft,"f").top),t.lineWidth=1,t.strokeStyle=i,t.stroke()),a+=e,h++}t.textAlign="right",t.textBaseline="middle";const s=n(this,Ht,"f").count>10?10:n(this,Ht,"f").count;let h=e?1:0,a=n(this,Xt,"f").length/s;for(let s=e?1:0;s<n(this,Xt,"f").length+1;s++){const e=this.canvas.height-h*a*n(this,Ht,"f").step-n(this,Ft,"f").bottom;if(s>=h*a){const s={x:n(this,Ft,"f").left,y:e};this.data.values.filter(t=>t.type.isAnyEquals(vi.Column,vi.StackingColumn,vi.Line)).length>0&&(t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(this.canvas.width-n(this,Ft,"f").right,s.y),t.lineWidth=1,t.strokeStyle=i,t.stroke()),h++}}this.canvas.width>0&&this.canvas.height>0&&wi(this,Jt,t.getImageData(0,0,this.canvas.width,this.canvas.height),"f")},ei=function(){let t=this.data.values.flatMap(t=>t.values.map(t=>t.x)),i=this.data.values.flatMap(t=>t.values.map(t=>t.y));const e=this.data.xType==ui.Date;if(e){let i=new Date(Math.min(...t));for(;i.getTime()<Math.max(...t);)t.includes(i.getTime())||t.push(new Date(i.getTime())),i=i.addDays(1);t.sort((t,i)=>t<i?-1:1)}i.sort((t,i)=>i>t?-1:1),wi(this,Yt,[...new Set(t.filter(t=>null!=t).map(t=>e?t.toString():t))],"f"),wi(this,Xt,[...new Set(i.filter(t=>null!=t))],"f"),wi(this,$t,{min:Math.min(...t),max:Math.max(...t),unit:(Math.abs(Math.min(...t))+Math.abs(Math.max(...t)))/(n(this,Yt,"f").length-1),step:(this.canvas.width-n(this,Ft,"f").left-n(this,Ft,"f").right)/n(this,Yt,"f").length,minStep:0,count:n(this,Yt,"f").length},"f");let s=Math.min(...i);s>0&&(s=0),wi(this,Ht,{min:s,max:this.data.yMax??Math.max(...i),unit:(Math.abs(s)+Math.abs(this.data.yMax??Math.max(...i)))/(n(this,Xt,"f").length-1),step:(this.canvas.height-n(this,Ft,"f").top-n(this,Ft,"f").bottom)/n(this,Xt,"f").length,minStep:0,count:n(this,Xt,"f").length},"f");let h,a=this.data.values.filter(t=>t.type==vi.StackingColumn);if(a.length>0){let t=a.map(t=>t.values.flatMap(t=>+t.y));h=n(this,Ht,"f").max;for(let i=0;i<t[0].length;i++){let e=0;for(const s of t)e+=s[i];e>h&&(h=e)}n(this,Ht,"f").max=h>this.data.yMax?this.data.yMax:h,n(this,Ht,"f").unit=(Math.abs(n(this,Ht,"f").min)+Math.abs(n(this,Ht,"f").max))/(n(this,Xt,"f").length-1)}const o=Ii.stringWidth(Bi.number(n(this,Ht,"f").max));o>n(this,Ft,"f").left-40&&(n(this,Ft,"f").left+=o-n(this,Ft,"f").left+40,n(this,$t,"f").step=(this.canvas.width-n(this,Ft,"f").left-n(this,Ft,"f").right)/n(this,Yt,"f").length),wi(this,Ut,Math.abs(n(this,Ht,"f").min)+Math.abs(n(this,Ht,"f").max),"f"),.5<=n(this,Ut,"f")&&n(this,Ut,"f")<1?wi(this,Ut,.05,"f"):1<=n(this,Ut,"f")&&n(this,Ut,"f")<10?wi(this,Ut,.1,"f"):10<=n(this,Ut,"f")&&n(this,Ut,"f")<100?wi(this,Ut,2,"f"):100<=n(this,Ut,"f")&&n(this,Ut,"f")<1e3?wi(this,Ut,20,"f"):1e3<=n(this,Ut,"f")&&n(this,Ut,"f")<1e4?wi(this,Ut,50,"f"):1e4<=n(this,Ut,"f")&&n(this,Ut,"f")<1e5?wi(this,Ut,1e3,"f"):1e5<=n(this,Ut,"f")&&n(this,Ut,"f")<1e6?wi(this,Ut,1e4,"f"):1e6<=n(this,Ut,"f")&&n(this,Ut,"f")<1e7?wi(this,Ut,5e4,"f"):wi(this,Ut,1,"f"),1!=n(this,Ut,"f")&&(h=i.length>10?10*(n(this,Ht,"f").max/10+n(this,Ut,"f")-n(this,Ht,"f").max/10%n(this,Ut,"f")):Math.ceil(n(this,Ht,"f").max/n(this,Ut,"f"))*n(this,Ut,"f"),n(this,Ht,"f").max=h>this.data.yMax?this.data.yMax:h,n(this,Ht,"f").unit=(Math.abs(n(this,Ht,"f").min)+Math.abs(n(this,Ht,"f").max))/n(this,Xt,"f").length),wi(this,_t,{width:this.canvas.width-n(this,Ft,"f").left-n(this,Ft,"f").right,height:this.canvas.height-n(this,Ft,"f").top-n(this,Ft,"f").bottom},"f"),n(this,$t,"f").minStep=.002*n(this,_t,"f").width,n(this,Ht,"f").minStep=.002*n(this,_t,"f").height};class Fi extends h{constructor(t){super(t),si.add(this),this.settings.enableLegend=!1,this.data.values=this.data.values.map(t=>new qi(t)),this.data.values.sort((t,i)=>i.value>t.value?1:-1);const i=this.settings.baseColor??Ii.randomColor();let e=Math.round(100/this.data.values.length),s=-50;e<=1&&(e=1);for(let t of this.data.values)t.color=Ii.adjustColor(i,s+=e)}render(){if(super.render(),0==this.data.values.filter(t=>t.value>0).length)return void n(this,si,"m",hi).call(this);let t,i,e=this.settings.title?xi.Values.titleOffset:0,s=this.canvas.width-2*this.data.padding,h=this.canvas.height-2*this.data.padding-e,a=this.data.values.reduce((t,i)=>t+i.value,0),o=s*h,l=this.data.padding,r=this.data.padding+e,d=this.data.padding,f=this.data.padding+e;const c=Li.getContext(this.canvas);let u=!0;for(let v=0;v<this.data.values.length;v++){const g=this.data.values[v],m=s-d-this.data.padding,p=h-f+e-this.data.padding;let x=[{color:g.color,label:g.label,s:g.value/a*o,value:g.value,id:g.id,x:l,y:r,w:0,h:0}];if(v+1<=this.data.values.length-1){const t=this.data.values[v+1];x.push({color:t.color,label:t.label,s:t.value/a*o,value:t.value,id:t.id,x:l,y:r,w:0,h:0}),v++}const w=1==x.length,y=v==this.data.values.length-1;if(u)for(let t=1;t<=m+v*v;t++){const i=m-t,e=x[0].s/i;if(e+(w?0:x[1].s/i)>=p){x[0].w=Math.floor(i),x[0].h=Math.floor(e),w||(x[1].w=Math.floor(i),x[1].h=p-x[0].h,x[1].y+=x[0].h);break}}else for(let t=1;t<=p+v*v;t++){const i=p-t,e=x[0].s/i;if(e+(w?0:x[1].s/i)>=m){x[0].h=Math.floor(i),x[0].w=Math.floor(e),w||(x[1].h=Math.floor(i),x[1].w=m-x[0].w,x[1].x+=x[0].w);break}}for(const e of x){y&&(u?(e.w=m,w&&(e.h=p)):(e.h=p,w&&(e.w=m))),c.beginPath(),c.fillStyle=e.color;const s=this.state!=mi.Init&&!this.animations.contains(e.id,ai.Init),h=v+x.indexOf(e)+(y&&w?1:0),d=260,f=()=>{let t=0;for(let i=0;i<h;i++)t+=d-d*(i/this.data.values.length)/Math.E;return t},g=d-d*h/(this.data.values.length+1);if(s){const s=(t,i)=>{const s=e.x+e.w/2,n=e.y+e.h/2,h=e.w>e.h?1-12/e.w:1-12/e.h,a=1-h;c.translate(s-s*(h+t*a),n-n*(h+t*a)),c.scale(h+t*a,h+t*a),this.animations.reload(e.id,i)};n(this,si,"m",ni).call(this,e)&&!t?(t=e,i=e.data,this.animations.add(e.id,ai.MouseOver,{duration:xi.Animations.tree,backward:!0,body:t=>{s(t,ai.MouseLeave)}})):this.animations.add(e.id,ai.MouseLeave,{timer:xi.Dates.minDate,duration:xi.Animations.tree,body:t=>{s(t,ai.MouseOver)}})}else this.animations.add(e.id,ai.Init,{duration:f(),continuous:!0,body:t=>{if(t*f()-f()+g<0)return c.fillStyle+="00";t=(t*f()-f()+g)/g;const i=e.x+e.w/2,s=e.y+e.h/2,n=.7,h=1-n;c.translate(i-i*(n+t*h),s-s*(n+t*h)),c.scale(n+t*h,n+t*h);let a=Math.round(255*t).toString(16);a.length<2&&(a=0+a),c.fillStyle=e.color+a}});const M=4;c.roundRect(l+M,r+M,e.w-M,e.h-M,2*M),c.fill(),e.label&&Ii.stringWidth(e.label)<e.w-M&&e.h-M>16&&!this.animations.contains(e.id,ai.Init)&&(c.beginPath(),Oi.large(c),c.fillStyle=Ii.isColorVisible(e.color,"#ffffff")?"#ffffff":"#000000",c.fillText(e.label,l+2+e.w/2,r+2+e.h/2)),c.resetTransform(),u?r+=e.h:l+=e.w,o-=e.w*e.h,a-=e.value}u?(l+=x[0].w,r=f):(r+=x[0].h,l=d),d=l,f=r,u=!u}this.tooltip.render(!!t&&!this.dropdown?.isActive,this.onMouseMoveEvent,[new Yi(`${t?.label}: ${Bi.number(t?.value)}`)],this.data.values.find(i=>i.id==t?.id)),this.isDestroy||requestAnimationFrame(this.render.bind(this)),this.state=mi.Idle,super.renderDropdown(),t||this.contextMenu?this.renderContextMenu(i):this.onContextMenuEvent=void 0}refresh(){super.refresh()}resize(){super.resize(),this.initAnimations(),this.animations.clear()}prepareSettings(){this.data.values=this.data.values.filter(t=>t.value>0),this.data.values.sort((t,i)=>(i.value??0)-(t.value??0)),super.prepareSettings();for(let t of this.data.values)t.disabled=!t.value,t.value??=0}initDropdown(){super.initDropdown(),this.dropdown=new Ci(this.canvas,{x:-10,y:10,text:zi.menu,items:[{text:zi.exportCSV,action:()=>{Si.asCsv(ki.toTable(Ji.getRows(this.data)),this.settings.title)}},{isDivider:!0},{text:zi.decomposeToTable,action:()=>{new Di(ki.toTable(Ji.getRows(this.data))).open()}}]})}}si=new WeakSet,ni=function(t){if(!this.onMouseMoveEvent||!t)return!1;const i=this.getMousePosition(this.onMouseMoveEvent);return!this.dropdown?.isActive&&t.x<=i.x&&i.x<=t.x+t.w&&t.y<=i.y&&i.y<=t.y+t.h},hi=function(){const t=Li.getContext(this.canvas);Oi.regular(t),t.fillText(zi.incorrectValues,this.canvas.width/2,this.canvas.height/2)},function(t){t[t.MouseOver=0]="MouseOver",t[t.MouseLeave=1]="MouseLeave",t[t.Init=2]="Init",t[t.Click=3]="Click",t[t.AnotherItemOver=4]="AnotherItemOver",t[t.AnotherItemLeave=5]="AnotherItemLeave"}(ai||(ai={})),function(t){t.Name="name"}(oi||(oi={})),function(t){t[t.Plot=0]="Plot",t[t.Circular=1]="Circular",t[t.Gauge=2]="Gauge",t[t.TreeMap=3]="TreeMap"}(li||(li={})),function(t){t.NullContext="Can't find context",t.ElementNotExist="Element does not exist"}(ri||(ri={})),function(t){t.VisibilityChanged="visibilitychange",t.Blur="blur",t.MouseMove="mousemove",t.Click="click",t.Change="change",t.ContextMenu="contextmenu"}(di||(di={})),function(t){t[t.Bottom=0]="Bottom",t[t.Left=1]="Left",t[t.Top=2]="Top",t[t.Right=3]="Right"}(fi||(fi={})),function(t){t[t.Solid=0]="Solid",t[t.Dash=1]="Dash",t[t.Dotted=2]="Dotted"}(ci||(ci={})),function(t){t[t.Date=1]="Date"}(ui||(ui={})),function(t){t[t.Line=0]="Line",t[t.AttentionLine=1]="AttentionLine",t[t.Column=2]="Column",t[t.Bar=3]="Bar",t[t.StackingColumn=4]="StackingColumn"}(vi||(vi={})),function(t){t.Canvas="canvas",t.A="a",t.Div="div",t.Dialog="dialog",t.Table="table",t.Script="script"}(gi||(gi={})),function(t){t[t.Idle=0]="Idle",t[t.Init=1]="Init"}(mi||(mi={}));class zi{}zi.exportPNG="Save as image...",zi.decomposeToTable="Show as table...",zi.reset="Reset",zi.exportCSV="Save as table...",zi.menu="Menu",zi.allDataIsHidden="All data is hidden",zi.other="Other",zi.incorrectValues="Incorrect values",zi.ThousandShort="K",zi.MillionShort="M",zi.BillionShort="B",zi.Show="Show...",zi.NoLabel="No Label",function(t){class i{}i.circular=335,i.legend=500,i.tree=250,i.tooltip=120,i.button=200,t.Animations=i}(xi||(xi={})),function(t){class i{}i.minDate=new Date(2e3,1,1),t.Dates=i}(xi||(xi={})),function(t){class i{}i.Default="default",i.Pointer="pointer",t.Cursor=i;class e{}e.Flex="flex",t.Display=e;class s{}s.Column="column",s.ColumnReverse="column-reverse",s.Row="row",s.RowReverse="row-reverse",t.FlexDirection=s;class n{}n.Center="center",t.AlignItems=n;class h{}h.Visible="visible",h.Hidden="hidden",t.Visibility=h;class a{}a.Absolute="absolute",t.Position=a;class o{}o.None="none",t.PointerEvents=o;class l{}l.Center="center",t.JustifyContent=l;class r{}r.Pixelated="pixelated",t.ImageRendering=r}(pi||(pi={})),function(t){class i{}i.titleOffset=30,t.Values=i}(xi||(xi={}));class Vi{}class ji extends t{constructor(t){super(),this.lineType=ci.Solid,Object.assign(this,t)}toggle(t){super.toggle(t)}checkCondition(){return super.checkCondition(),!0}reset(){super.reset()}}class qi extends t{constructor(t){super(),Object.assign(this,t)}toggle(t){super.toggle(t),this.disabled?this.current=this.value*(1-t):this.current=this.value*t}checkCondition(){return super.checkCondition(),0==this.current&&!this.disabled||0!=this.value}reset(){super.reset(),this.current=this.value}}class Yi{constructor(t,i){this.text=t,this.color=i}}class Xi{static getRows(t){const i="Value";let e=[];for(const s of t.values)e.push({name:s.label,values:new Map([[i,s.value]])});return{headers:[{value:i,display:i}],values:e}}}class Gi{static getRows(t){let i=[],e=[];for(const s of t.values){let n=new Map;for(const e of s.values)n.set(e.x.toString(),e.y),i.push({value:e.x.toString(),display:t.xType==ui.Date?Bi.date(new Date(e.x)):e.x.toString()});e.push({name:s.label,values:n})}const s=new Set,n=i.filter(t=>!s.has(t.display)&&s.add(t.display));return t.xType==ui.Date&&n.sort((t,i)=>new Date(t.value).getTime()-new Date(i.value).getTime()),{headers:n,values:e}}}class Ji{static getRows(t){const i="Value";let e=[];for(const s of t.values)e.push({name:s.label,values:new Map([[i,s.value]])});return{headers:[{value:i,display:i}],values:e}}}}};t[832](),t[172]()})();
//# sourceMappingURL=ocharts.min.js.map