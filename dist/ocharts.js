(()=>{"use strict";var t={172:()=>{},832:function(){class t{toggle(t){0==t&&(this.disabled=!this.disabled)}checkCondition(){return!1}reset(){this.disabled=!1}}class i{constructor(t,i){this.isInit=!1,this.node=t,this.settings=i,this.animations=new ni,this.canvas=document.createElement(ct.Canvas),this.node.append(this.canvas),this.tooltip=new xi(this.canvas,i),this.initAnimations()}render(){ut.Canvas.getContext(this.canvas).clearRect(0,0,this.canvas.width,this.canvas.height)}refresh(){this.tooltip.refresh(),this.isInit=!1}resetMouse(){this.onMouseMoveEvent=new MouseEvent(lt.MouseMove),this.onClickEvent=new MouseEvent(lt.Click)}initAnimations(){this.canvasPosition=this.canvas.getBoundingClientRect(),this.canvasPosition.x+=scrollX,this.canvasPosition.y+=scrollY,this.isInit||(this.canvas.onmousemove=t=>this.onMouseMoveEvent=t,this.canvas.onclick=t=>this.onClickEvent=t)}}var e,s,a=this&&this.__classPrivateFieldGet||function(t,i,e,s){if("a"===e&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!s:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===e?s:"a"===e?s.call(t):s?s.value:i.get(t)};class n extends i{constructor(t,i){super(t,i),e.add(this),this.data=i.data,a(this,e,"m",s).call(this)}render(){super.render();const t=ut.Canvas.getContext(this.canvas);this.settings.title&&(ut.TextStyles.title(t),t.fillText(this.settings.title,this.canvas.width/2,40))}renderDropdown(){this.onClickEvent=this.dropdown?.render(this.onMouseMoveEvent,this.onClickEvent)}resize(){this.tooltip.refresh(),a(this,e,"m",s).call(this)}prepareSettings(){const t=this.node.parentElement.getBoundingClientRect();this.settings.maxWidth=this.settings.width??t.width,this.settings.maxHeight=this.settings.height??t.height,0==+this.settings.width&&(this.settings.width=t.width>this.settings.maxWidth&&0!=+this.settings.maxWidth?this.settings.maxWidth:t.width),0==+this.settings.height&&(this.settings.height=t.height>this.settings.maxHeight&&0!=+this.settings.maxHeight?this.settings.maxHeight:t.height);const i=this.settings.baseColor??di.randomColor();let e=Math.round(100/this.settings.data.values.length),s=-50;e<=1&&(e=1);for(let t of this.settings.data.values)t.id=di.guid(),t.color??=di.adjustColor(i,s+=e)}}e=new WeakSet,s=function(){let t=this.node.getBoundingClientRect();this.canvas.width=this.settings.maxWidth??t.width,this.canvas.height=this.settings.maxHeight??t.height,this.settings.enableLegend&&(this.settings.legendPlace!=rt.Top&&this.settings.legendPlace!=rt.Bottom||(this.canvas.height-=ci.getLegendHeight(this.settings.data.values,this.canvas.width)),this.settings.legendPlace!=rt.Left&&this.settings.legendPlace!=rt.Right||(this.canvas.width-=500))};var h,o,l,r,f,d,c,u,v,g,m,x,p,y,w,M,b,k,C,S,T,P,I,D,E,W,L,A,R,F,B,O,$,N,Y,j,X,H,z,q,V,G,_,U,J,K,Q,Z,tt,it,et,st,at,nt,ht,ot,lt,rt,ft,dt,ct,ut,vt,gt,mt,xt,pt,yt,wt,Mt,bt,kt,Ct,St,Tt,Pt,It,Dt,Et,Wt,Lt,At,Rt,Ft,Bt,Ot,$t,Nt,Yt,jt,Xt,Ht,zt,qt,Vt,Gt,_t,Ut,Jt,Kt,Qt,Zt,ti,ii,ei,si,ai=this&&this.__classPrivateFieldSet||function(t,i,e,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof i?t!==i||!a:!i.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(t,e):a?a.value=e:i.set(t,e),e};class ni{constructor(){h.add(this),l.set(this,void 0),ai(this,l,new Map,"f")}add(t,i,e){const s=a(this,h,"m",f).call(this,t,i);a(this,l,"f").has(s)||a(this,l,"f").set(s,e),a(this,h,"m",r).call(this,s)}contains(t,i){return a(this,l,"f").has(a(this,h,"m",f).call(this,t,i))}reload(t,i){this.contains(t,i)&&(a(this,l,"f").get(a(this,h,"m",f).call(this,t,i)).timer=new Date)}clear(){a(this,l,"f").forEach((t,i)=>!a(this,h,"m",d).call(this,i,at.Init)&&a(this,l,"f").delete(i))}static initializeTransitions(){for(let t=0;t<3e4;t++){const i=(t+1)/3e4;let e=0*Math.pow(1-i,3)+3*Math.pow(1-i,2)*.77*i+3*(1-i)*Math.pow(i,2)*.23+1*Math.pow(i,3),s=0*Math.pow(1-i,3)+3*Math.pow(1-i,2)*.23*i+3*(1-i)*Math.pow(i,2)*.77+1*Math.pow(i,3);o.transitionCurve.set(+e.toFixed(4),s)}o.transitionCurve.set(0,0)}static getTransition(t){return o.transitionCurve.get(+t.toFixed(4))??0}}o=ni,l=new WeakMap,h=new WeakSet,r=function(t){const i=a(this,l,"f").get(t),e=new Date,s=e.getTime()-(i.timer??e).getTime(),n=o.getTransition(s>i.duration?1:s/i.duration),h=!i.before||i.before();!i.timer&&h&&(i.timer=e),h&&i.body(n),1!=n||h&&!i.continuous||a(this,l,"f").delete(t)},f=function(t,i){return t+"_"+i},d=function(t,i){return t.endsWith("_"+i)},ni.transitionCurve=new Map;class hi{constructor(t,i){c.add(this),u.set(this,void 0),v.set(this,void 0),g.set(this,void 0),m.set(this,void 0),x.set(this,void 0),ai(this,u,t,"f"),ai(this,v,i,"f"),this.animations=new ni,a(this,c,"m",p).call(this);const e=di.stringWidth(a(this,v,"f").text)+20;ai(this,x,{x:a(this,v,"f").x+e>a(this,u,"f").width?a(this,u,"f").width-e:a(this,v,"f").x<0?a(this,u,"f").width+a(this,v,"f").x-e:a(this,v,"f").x,y:a(this,v,"f").y+24>a(this,u,"f").height?a(this,u,"f").height-24:a(this,v,"f").y<0?a(this,u,"f").height+a(this,v,"f").y-24:a(this,v,"f").y,width:e,height:24},"f")}render(t,i){a(this,m,"f")||a(this,c,"m",p).call(this);const e=ut.Canvas.getContext(a(this,u,"f"));return e.beginPath(),a(this,c,"m",y).call(this,t)?(a(this,u,"f").style.cursor="pointer",i&&a(this,c,"m",y).call(this,i)&&(a(this,v,"f").action(),i=void 0),this.animations.add("animation-button",at.MouseOver,{duration:300,before:()=>null==i,body:t=>{this.animations.reload("animation-button-leave",at.MouseLeave),e.fillStyle=di.adjustColor(mi.background,-Math.round(40*t))}})):this.animations.add("animation-button-leave",at.MouseLeave,{duration:300,body:t=>{this.animations.reload("animation-button",at.MouseOver),e.fillStyle=di.adjustColor(mi.background,-Math.round(40*(1-t)))}}),e.strokeStyle=mi.background,e.roundRect(a(this,x,"f").x,a(this,x,"f").y,a(this,x,"f").width,a(this,x,"f").height,4),e.fill(),ut.TextStyles.regular(e),e.fillText(a(this,v,"f").text,a(this,x,"f").x+a(this,x,"f").width/2,a(this,x,"f").y+a(this,x,"f").height/2),ai(this,m,!0,"f"),i}}u=new WeakMap,v=new WeakMap,g=new WeakMap,m=new WeakMap,x=new WeakMap,c=new WeakSet,p=function(){ai(this,g,a(this,u,"f").getBoundingClientRect(),"f"),a(this,g,"f").x+=scrollX,a(this,g,"f").y+=scrollY},y=function(t){if(!t)return!1;let i=t.clientX-a(this,g,"f").x+scrollX,e=t.clientY-a(this,g,"f").y+scrollY;return i>=a(this,x,"f").x&&i<=a(this,x,"f").x+a(this,x,"f").width&&e>=a(this,x,"f").y&&e<=a(this,x,"f").y+a(this,x,"f").height};class oi{constructor(t,i){w.add(this),M.set(this,void 0),b.set(this,void 0),k.set(this,void 0),a(this,w,"m",P).call(this),t.chart=this,this.node=t,this.node.style.display="flex",this.node.style.flexDirection="column",this.node.style.alignItems="center",this.settings=i,a(this,w,"m",C).call(this),i.enableLegend&&(ai(this,b,new ci(t,i),"f"),null!=i.legendPlace&&i.legendPlace!=rt.Bottom&&i.legendPlace!=rt.Top||(i.maxHeight-=a(this,b,"f").canvas.height)),document.addEventListener(lt.VisibilityChanged,()=>a(this,M,"f").resetMouse()),window.addEventListener(lt.Blur,()=>a(this,M,"f").resetMouse())}render(){a(this,M,"f").render(),a(this,b,"f")?.render(),ai(this,k,new ResizeObserver(()=>a(this,w,"m",T).call(this)),"f"),a(this,k,"f").observe(this.node),a(this,w,"m",S).call(this)}}M=new WeakMap,b=new WeakMap,k=new WeakMap,w=new WeakSet,C=function(){switch(this.settings.type){case nt.Plot:ai(this,M,new wi(this.node,this.settings),"f");break;case nt.Circular:ai(this,M,new pi(this.node,this.settings),"f");break;case nt.Gauge:ai(this,M,new yi(this.node,this.settings),"f");break;case nt.TreeMap:ai(this,M,new Mi(this.node,this.settings),"f")}a(this,M,"f").prepareSettings()},S=function(){a(this,M,"f").refresh(),a(this,b,"f")?.refresh()},T=function(){a(this,M,"f").resize(),a(this,b,"f")?.resize()},P=function(){mi.initialize(()=>a(this,w,"m",T).call(this)),ni.initializeTransitions()};class li{static toTable(t){let i=document.createElement(ct.Table);i.classList.add("o-table");let e=new Map,s="",a="",n=new Map;for(const i of t.values){let e=new Map;for(const i of t.headers)e.set(i.value,0);for(const[t,s]of i.values)e.set(t,s);n.set(i.name,e)}for(const i of t.headers)a+=`\n                <th>\n                    ${i.display}\n                </th>\n            `;for(const[t,i]of n){let a="";for(const[t,s]of i)if(a+=`\n                    <td>\n                        ${null==s?"":s.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}\n                    </td>\n                `,e.has(t)){let i=e.get(t);e.set(t,(i??0)+ +s)}else e.set(t,s);s+=`\n                <tr>\n                    <td class="o-table-label">\n                        ${t}\n                    </td>\n                    \n                    ${a} \n                </tr>\n            `}let h="";for(const[,t]of e)h+=`\n                <td>\n                    ${null==t?"":t.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}\n                </td>\n            `;return i.innerHTML=`\n            <thead>\n                <tr>\n                    <th></th>\n                \n                    ${a}\n                </tr>\n            </thead>\n        \n            <tbody>\n                ${s}\n            </tbody>\n            \n            <tfoot>\n                <tr>\n                    <td></td>\n                \n                    ${h}\n                </tr>\n            </tfoot>\n        `,i}}class ri{constructor(t,i){I.add(this),D.set(this,void 0),E.set(this,void 0),W.set(this,void 0),this.isActive=!1,L.set(this,void 0),A.set(this,void 0),ai(this,D,t,"f"),ai(this,E,i,"f"),this.animations=new ni,a(this,I,"m",R).call(this);const e=di.stringWidth(a(this,E,"f").text)+20;ai(this,A,{x:a(this,E,"f").x+e>a(this,D,"f").width?a(this,D,"f").width-e:a(this,E,"f").x<0?a(this,D,"f").width+a(this,E,"f").x-e:a(this,E,"f").x,y:a(this,E,"f").y+24>a(this,D,"f").height?a(this,D,"f").height-24:a(this,E,"f").y<0?a(this,D,"f").height+a(this,E,"f").y-24:a(this,E,"f").y,width:e,height:24},"f")}render(t,i){a(this,L,"f")||a(this,I,"m",R).call(this);const e=ut.Canvas.getContext(a(this,D,"f"));e.beginPath();let s=a(this,A,"f").x,n=a(this,A,"f").y,h=a(this,A,"f").width,o=a(this,A,"f").height;if(a(this,I,"m",F).call(this,t,s,n,h,o)?(a(this,D,"f").style.cursor="pointer",i&&t.x==i.x&&t.y==i.y&&(this.isActive=!this.isActive,i=void 0),this.isActive?e.fillStyle=di.adjustColor(mi.background,-40):this.animations.add("animation-dropdown",at.MouseOver,{duration:300,body:t=>{this.animations.reload("animation-dropdown",at.MouseLeave),e.fillStyle=di.adjustColor(mi.background,-Math.round(40*t))}})):(a(this,D,"f").style.cursor="default",this.isActive?e.fillStyle=di.adjustColor(mi.background,-40):this.animations.add("animation-dropdown",at.MouseLeave,{duration:300,body:t=>{this.animations.reload("animation-dropdown",at.MouseOver),e.fillStyle=di.adjustColor(mi.background,-Math.round(40*(1-t)))}})),e.strokeStyle=mi.background,e.roundRect(s,n,h,o,4),e.fill(),ut.TextStyles.regular(e),e.fillText(a(this,E,"f").text,s+h/2,n+o/2),this.isActive){n+=o;let h=Math.max(...a(this,E,"f").items.map(t=>di.stringWidth(t.text)))+8;h<50&&(h=50),s+h>a(this,D,"f").width-4&&(s-=s+h-a(this,D,"f").width+4),e.beginPath(),e.roundRect(s,n,h,20*a(this,E,"f").items.length+8,4),e.fillStyle=mi.background,e.strokeStyle="#353535",e.fill(),e.stroke(),e.beginPath(),n+=4;for(const o of a(this,E,"f").items)e.beginPath(),a(this,I,"m",F).call(this,t,s,n,h,20)?(this.animations.add("animation-dropdown"+o.text,at.MouseOver,{duration:300,before:()=>null==i,body:t=>{this.animations.reload("animation-dropdown"+o.text,at.MouseLeave),e.fillStyle=di.adjustColor(mi.background,60-Math.round(100*t))}}),a(this,D,"f").style.cursor="pointer",i&&(o.action(),i=void 0,this.isActive=!1)):this.animations.add("animation-dropdown"+o.text,at.MouseLeave,{duration:300,body:t=>{this.animations.reload("animation-dropdown",at.MouseOver),e.fillStyle=di.adjustColor(mi.background,60-Math.round(100*(1-t)))}}),e.rect(s,n,h,20),e.fill(),e.fillStyle=mi.text,e.textAlign="center",e.textBaseline="hanging",e.fillText(o.text,s+h/2,n+4),n+=20}return null!=i&&this.isActive&&(this.isActive=!1,i=void 0),ai(this,L,!0,"f"),i}refresh(){ai(this,L,!1,"f")}resize(){a(this,I,"m",R).call(this)}}D=new WeakMap,E=new WeakMap,W=new WeakMap,L=new WeakMap,A=new WeakMap,I=new WeakSet,R=function(){ai(this,W,a(this,D,"f").getBoundingClientRect(),"f"),a(this,W,"f").x+=scrollX,a(this,W,"f").y+=scrollY},F=function(t,i,e,s,n){if(!t)return!1;let h=t.clientX-a(this,W,"f").x+scrollX,o=t.clientY-a(this,W,"f").y+scrollY;return h>=i&&h<=i+s&&o>=e&&o<=e+n};class fi{static asPng(t,i){const e=ut.Canvas.getContext(t);let s=di.stringWidth(bi.exportPNG)+16;s<50&&(s=50),e.clearRect(t.width-s,0,s,64);let a=0,n=0;const h=new Uint32Array(e.getImageData(0,0,t.width,t.height).data.buffer);let o=!1;for(let i=0;i<t.width;i++){for(let e=0;e<t.height;e++)if(ut.Canvas.isPixelBusy(h[i+e*t.width])){o=!0;break}if(o)break;a++}o=!1;for(let i=t.width;i>=0;i--){for(let e=0;e<t.height;e++)if(ut.Canvas.isPixelBusy(h[i+e*t.width])){o=!0;break}if(o)break;n++}a>4&&(a-=4),n>4&&(n-=4),a>n&&(a=n),n>a&&(n=a);let l=document.createElement(ct.Canvas);l.width=t.width-a-n,l.height=t.height;const r=ut.Canvas.getContext(l);r.fillStyle="#FFFFFF",r.fillRect(0,0,t.width,t.height),r.drawImage(t,-a,0);let f=document.createElement(ct.A);f.href=l.toDataURL("image/png"),f.download=(i??"chart")+".png",f.click()}static asCsv(t,i){let e=t.querySelectorAll("tr"),s=[];for(let t=0;t<e.length;t++){let i=[],a=e[t].querySelectorAll("td, th");for(let t=0;t<a.length;t++){let e=a[t].innerHTML.replace(/(\r\n|\n|\r)/gm,"").replace(/(\s\s)/gm," ");e=e.replace(/"/g,'""'),i.push('"'+e+'"')}s.push(i.join(","))}let a=document.createElement("a");a.href="data:text/csv;charset=utf-8,"+encodeURIComponent(s.join("\n")),a.download=(i??"table")+".csv",a.click()}}class di{static adjustColor(t,i){return"#"+t.replace(/^#/,"").replace(/../g,t=>("0"+Math.min(255,Math.max(0,parseInt(t,16)+i)).toString(16)).slice(-2))}static grayScale(t){return"#"+Array(4).join(Math.round([.3,.59,.11].reduce((i,e,s)=>i+e*parseInt(t[2*s+1]+t[2*s+2],16),0)/3).toString(16).padStart(2,"0"))}static randomColor(){let t="#";for(let i=0;i<6;i++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}static stringWidth(t,i){const e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2796875,.2765625,.3546875,.5546875,.5546875,.8890625,.665625,.190625,.3328125,.3328125,.3890625,.5828125,.2765625,.3328125,.2765625,.3015625,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.2765625,.2765625,.584375,.5828125,.584375,.5546875,1.0140625,.665625,.665625,.721875,.721875,.665625,.609375,.7765625,.721875,.2765625,.5,.665625,.5546875,.8328125,.721875,.7765625,.665625,.7765625,.721875,.665625,.609375,.721875,.665625,.94375,.665625,.665625,.609375,.2765625,.3546875,.2765625,.4765625,.5546875,.3328125,.5546875,.5546875,.5,.5546875,.5546875,.2765625,.5546875,.5546875,.221875,.240625,.5,.221875,.8328125,.5546875,.5546875,.5546875,.5546875,.3328125,.5,.2765625,.5546875,.5,.721875,.5,.5,.5,.3546875,.259375,.353125,.5890625];return Array.from(t).reduce((t,i)=>t+(e[i.charCodeAt(0)]??.5279276315789471),0)*(i||14)}static guid(){const t=()=>(65536*(1+Math.random())|0).toString(16).substring(1);return(t()+t()+"-"+t()+"-4"+t().slice(0,3)+"-"+t()+"-"+t()+t()+t()).toLowerCase()}static hexToRgb(t){if(t.length>4){const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(i)return{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}}else{const i=/^#?([a-f\d])([a-f\d])([a-f\d])$/i.exec(t);if(i)return{r:parseInt(i[1]+i[1],16),g:parseInt(i[2]+i[2],16),b:parseInt(i[3]+i[3],16)}}return new ki}static isColorVisible(t,i){const e=di.hexToRgb(t),s=di.hexToRgb(i);return(e.r+e.g+e.b)/(s.r+s.g+s.b)<.77}static isISOString(t){return/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+/.test(t)}}class ci extends i{constructor(t,i){switch(super(t,i),B.add(this),O.set(this,void 0),$.set(this,void 0),i.legendPlace){case rt.Bottom:default:this.canvas.width=i.width??i.maxWidth,this.canvas.height=ci.getLegendHeight(i.data.values,this.canvas.width),t.style.flexDirection="column";break;case rt.Top:this.canvas.width=i.width??i.maxWidth,this.canvas.height=ci.getLegendHeight(i.data.values,this.canvas.width),t.style.flexDirection="column-reverse";break;case rt.Left:this.canvas.width=500,this.canvas.height=i.height??i.maxHeight,t.style.flexDirection="row";break;case rt.Right:this.canvas.width=500,this.canvas.height=i.height??i.maxHeight,t.style.flexDirection="row-reverse"}ai(this,O,new hi(this.canvas,{x:-10,y:10,text:bi.reset,action:()=>{for(let t of i.data.values)t.reset()}}),"f"),ai(this,$,{x:ci.getOffsetToCenter(this.settings.data.values,this.canvas.width),y:(this.canvas.height-ci.getLegendHeight(this.settings.data.values,this.canvas.width))/2},"f")}render(){super.render();const t=ut.Canvas.getContext(this.canvas);let i={x:20,y:20};this.canvas.style.cursor="default",ut.TextStyles.regular(t),t.textAlign="start",t.textBaseline="alphabetic",t.translate(a(this,$,"f").x,a(this,$,"f").y);for(const t of this.settings.data.values.filter(t=>!t.hideInLegend))i=a(this,B,"m",N).call(this,t,i.x,i.y);t.translate(-a(this,$,"f").x,-a(this,$,"f").y),requestAnimationFrame(this.render.bind(this)),this.onClickEvent=a(this,O,"f").render(this.onMouseMoveEvent,this.onClickEvent),this.isInit=!0}refresh(){this.isInit=!1}resize(){this.initAnimations()}static getOffsetToCenter(t,i){let e=20;for(const s of t.filter(t=>!t.hideInLegend)){const t=di.stringWidth(s.label);if(e+t+47>=i-100)break;e+=t+47}return i/2-e/2}static getLegendHeight(t,i){let e=1,s=20,a=ci.getOffsetToCenter(t,i);for(const n of t.filter(t=>!t.hideInLegend)){const t=di.stringWidth(n.label);s+t+57>=i-100-a&&(s=20,e++),s+=t+57}return 40*e}}O=new WeakMap,$=new WeakMap,B=new WeakSet,N=function(t,i,e){const s=ut.Canvas.getContext(this.canvas),n=di.stringWidth(t.label),h=10;i+50+n>=this.canvas.width-100-a(this,$,"f").x&&(i=20,e+=38);let o=i-h-h,l=e-5-h,r=52+n;const f=t=>{if(!t)return!1;const i=t.clientX-this.canvasPosition.x+scrollX-a(this,$,"f").x,e=t.clientY-this.canvasPosition.y+scrollY-a(this,$,"f").y;return i>=o&&i<=o+r&&e>=l&&e<=l+30};return this.onClickEvent&&this.animations.add(t.id,at.Click,{duration:220,continuous:!0,before:()=>f(this.onClickEvent)&&t.checkCondition(),body:i=>{t.toggle(i),1==i&&(this.onClickEvent=new PointerEvent(lt.Click))}}),this.onMouseMoveEvent&&(f(this.onMouseMoveEvent)&&(this.canvas.style.cursor="pointer"),this.animations.add(t.id,at.MouseLeave,{duration:100,before:()=>!f(this.onMouseMoveEvent)&&!this.isInit,body:t=>{s.roundRect(o,l,r,30,h),s.fillStyle=di.adjustColor(mi.background,Math.round(-50*(1-t))),s.fill()}}),this.animations.add(t.id,at.MouseOver,{duration:100,before:()=>f(this.onMouseMoveEvent),body:t=>{s.beginPath(),s.roundRect(o,l,r,30,h),s.fillStyle=di.adjustColor(mi.background,Math.round(-50*t)),s.fill()}})),s.beginPath(),s.arc(i,e,h,0,2*Math.PI),s.fillStyle=t.disabled?di.grayScale(t.color):t.color,s.fill(),s.fillStyle=mi.text,s.fillText(t.label,i+20,e+4),i+=20,t.disabled&&(s.moveTo(i-5,e),s.lineTo(i+n,e),s.strokeStyle=mi.text,s.stroke()),{x:i+=n+45,y:e}};class ui{constructor(t){Y.add(this),j.set(this,void 0),this.modal=document.createElement(ct.Dialog),this.modal.classList.add("o-modal"),this.modal.oncancel=()=>this.close(),document.body.appendChild(this.modal),a(this,Y,"m",X).call(this),a(this,Y,"m",H).call(this,t)}open(){null==this.modal&&ut.Errors.throw(ot.ElementNotExist),this.modal.showModal()}close(){null==this.modal&&ut.Errors.throw(ot.ElementNotExist),this.modal.close(),this.modal.remove(),this.modal=void 0}}function vi(){}j=new WeakMap,Y=new WeakSet,X=function(){null==this.modal&&ut.Errors.throw(ot.ElementNotExist);let t=document.createElement("button");t.classList.add("o-modal-close"),t.innerHTML="x",this.modal.appendChild(t),t.onclick=()=>this.close()},H=function(t){null==a(this,j,"f")&&(ai(this,j,document.createElement(ct.Div),"f"),a(this,j,"f").classList.add("o-modal-content"),this.modal?.appendChild(a(this,j,"f"))),null!=t&&a(this,j,"f").appendChild(t)},vi.chart=function(t,i){return new oi(t,i)},window.OCharts=vi;class gi{}gi.colors=["#000000","#ffffff"],gi.backgrounds=["#eeeeee","#222222"],gi.lines=["#000000","#eeeeee"],gi.lineAxises=["#dedede","#212121"],gi.lineActives=["#767676","#898989"];class mi{static initialize(t){window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&mi.setTheme(1),window.matchMedia("(prefers-color-scheme: dark)").addEventListener(lt.Change,i=>{mi.setTheme(i.matches?1:0),t()})}static setTheme(t){mi.text=gi.colors[t],mi.background=gi.backgrounds[t],mi.line=gi.lines[t],mi.lineAxis=gi.lineAxises[t],mi.lineActive=gi.lineActives[t]}}mi.text=gi.colors[0],mi.background=gi.backgrounds[0],mi.line=gi.lines[0],mi.lineAxis=gi.lineAxises[0],mi.lineActive=gi.lineActives[0];class xi{constructor(t,i){z.add(this),q.set(this,void 0),V.set(this,void 0),G.set(this,void 0),_.set(this,void 0),U.set(this,void 0),J.set(this,void 0),K.set(this,void 0),Q.set(this,120),Z.set(this,void 0),this.canvas=t,this.data=i.data,ai(this,q,i.enableTooltip,"f"),ai(this,V,!!i.templateId,"f"),a(this,V,"f")&&ai(this,_,document.getElementById(i.templateId),"f"),this.refresh()}render(t,i,e,s){if(a(this,z,"m",et).call(this),a(this,q,"f")&&i)if(t||a(this,U,"f")||a(this,J,"f")){t&&ai(this,Z,e,"f"),a(this,K,"f")||ai(this,K,new Date,"f"),a(this,J,"f")?a(this,U,"f")&&ai(this,K,new Date,"f"):ai(this,U,!0,"f"),a(this,V,"f")?a(this,z,"m",it).call(this,i,s):a(this,z,"m",tt).call(this,i);const n=a(this,z,"m",st).call(this);a(this,J,"f")&&n>=1&&(ai(this,U,!1,"f"),ai(this,J,!1,"f")),a(this,J,"f")&&n<=0&&(ai(this,U,!1,"f"),ai(this,J,!1,"f"),ai(this,K,void 0,"f")),t||null==a(this,K,"f")||ai(this,J,!0,"f")}else ai(this,K,void 0,"f")}refresh(){ai(this,G,this.canvas.getBoundingClientRect(),"f"),a(this,G,"f").x+=scrollX,a(this,G,"f").y+=scrollY}}q=new WeakMap,V=new WeakMap,G=new WeakMap,_=new WeakMap,U=new WeakMap,J=new WeakMap,K=new WeakMap,Q=new WeakMap,Z=new WeakMap,z=new WeakSet,tt=function(t){const i=ut.Canvas.getContext(this.canvas),e=Math.max(...a(this,Z,"f").map(t=>di.stringWidth(t.text??"")+(t.color?8:0)));let s=t.clientX-a(this,G,"f").x+10,n=t.clientY-a(this,G,"f").y+scrollY+10;s+e+16>a(this,G,"f").width&&(s=a(this,G,"f").width-(e+16)),n+10+18*a(this,Z,"f").length>a(this,G,"f").height&&(n=a(this,G,"f").height-10-18*a(this,Z,"f").length),i.beginPath(),i.roundRect(s,n,e+16,16+16*a(this,Z,"f").length,20);let h=Math.round(77*a(this,z,"m",st).call(this)).toString(16);1==h.length&&(h="0"+h),i.fillStyle="#000000"+h,i.fill();for(let t of a(this,Z,"f")){let e=0;t.color&&(e=12,i.beginPath(),i.fillStyle=t.color,i.arc(s+16,n+17,5,0,2*Math.PI),i.fill()),i.fillStyle="#ffffff",i.font="14px serif",i.textAlign="start",i.textBaseline="alphabetic",i.fillText(t.text??"",s+e+12,n+22),n+=16}},it=function(t,i){if(null==i)return;const e=a(this,_,"f").id+i.id;let s=document.getElementById(e);const n=()=>{a(this,z,"m",et).call(this),s.style.visibility="visible"};if(!s){const t=/\${[^}]*}/gm;let h=a(this,_,"f").cloneNode(!0);s=document.createElement(ct.Div),s.innerHTML=h.innerHTML,s.id=e,s.style.position="absolute",s.style.pointerEvents="none",s.style.visibility="visible",s.setAttribute("name",a(this,_,"f").id);const o=[...s.innerHTML.matchAll(t)];let l=s.innerHTML;for(const t of o){const e=t[0].replace("${","").replace("}","").replaceAll(" ","");l=l.replaceAll(t[0],i.data[e])}s.innerHTML=l,document.body.appendChild(s),s.position=s.getBoundingClientRect(),n()}"hidden"==s.style.visibility&&n(),0==s.position.height&&(s.position=s.getBoundingClientRect());const h=10;let o=t.clientX,l=t.clientY+scrollY;o+s.position.width-a(this,G,"f").x>a(this,G,"f").width-h&&(o=a(this,G,"f").width-s.position.width+a(this,G,"f").x-h),l+s.position.height-a(this,G,"f").y>a(this,G,"f").height-h&&(l=a(this,G,"f").height-s.position.height+a(this,G,"f").y-h),s.style.left=o+h+"px",s.style.top=l+h+"px"},et=function(){if(!a(this,V,"f"))return;const t=document.querySelectorAll(`[name="${a(this,_,"f").id}"]`);for(let i of t)i.style.visibility="hidden"},st=function(){if(!a(this,K,"f"))return 0;let t=a(this,J,"f")?1-((new Date).getTime()-a(this,K,"f").getTime())/a(this,Q,"f"):((new Date).getTime()-a(this,K,"f").getTime())/a(this,Q,"f");return t>1&&(t=1),t<0&&(t=0),t},function(t){t[t.MouseOver=0]="MouseOver",t[t.MouseLeave=1]="MouseLeave",t[t.Init=2]="Init",t[t.Click=3]="Click"}(at||(at={})),function(t){t[t.Plot=0]="Plot",t[t.Circular=1]="Circular",t[t.Gauge=2]="Gauge",t[t.TreeMap=3]="TreeMap"}(nt||(nt={})),function(t){t[t.Pie=0]="Pie",t[t.Donut=1]="Donut"}(ht||(ht={})),function(t){t.NullContext="Can't find context",t.ElementNotExist="Element does not exist"}(ot||(ot={})),function(t){t.VisibilityChanged="visibilitychange",t.Blur="blur",t.MouseMove="mousemove",t.Click="click",t.Change="change"}(lt||(lt={})),function(t){t[t.Bottom=0]="Bottom",t[t.Left=1]="Left",t[t.Top=2]="Top",t[t.Right=3]="Right"}(rt||(rt={})),function(t){t[t.Date=1]="Date"}(ft||(ft={})),function(t){t[t.Line=0]="Line",t[t.AttentionLine=1]="AttentionLine",t[t.Column=2]="Column",t[t.Bar=3]="Bar",t[t.StackingColumn=4]="StackingColumn"}(dt||(dt={})),function(t){t.Canvas="canvas",t.A="a",t.Div="div",t.Dialog="dialog",t.Table="table"}(ct||(ct={})),function(t){t.Canvas=class{static getContext(i){return i.getContext("2d",{willReadFrequently:!0})??t.Errors.throw(ot.NullContext)}static isPixelBusy(t){return 4278190080&t}}}(ut||(ut={})),function(t){t.Errors=class{static throw(t){throw new Error(t)}}}(ut||(ut={})),function(t){t.TextStyles=class{static title(t){t.fillStyle=mi.text,t.textAlign="center",t.textBaseline="middle",t.font="20px serif"}static regular(t){t.fillStyle=mi.text,t.textAlign="center",t.textBaseline="middle",t.font="14px serif"}static large(t){t.fillStyle=mi.text,t.textAlign="center",t.textBaseline="middle",t.font="16px serif"}}}(ut||(ut={}));class pi extends n{constructor(t,i){super(t,i),vt.add(this),gt.set(this,void 0),mt.set(this,void 0),xt.set(this,void 0),pt.set(this,void 0),yt.set(this,void 0),wt.set(this,void 0),Mt.set(this,void 0),bt.set(this,void 0),kt.set(this,void 0),this.data.values=this.data.values.map(t=>new Si(t)),this.dropdown=new ri(this.canvas,{x:-10,y:10,text:bi.menu,items:[{text:bi.exportPNG,action:()=>{fi.asPng(this.canvas,this.settings.title)}},{text:bi.exportCSV,action:()=>{fi.asCsv(li.toTable(Ii.getRows(this.data)),this.settings.title)}},{text:bi.decomposeToTable,action:()=>{new ui(li.toTable(Ii.getRows(this.data))).open()}}]}),a(this,vt,"m",Et).call(this),ai(this,kt,Math.random()%(2*Math.PI),"f"),ai(this,yt,[],"f"),this.initAnimations(),this.canvas.dispatchEvent(new MouseEvent(lt.MouseMove))}render(){super.render(),ai(this,xt,a(this,kt,"f"),"f"),ai(this,pt,void 0,"f"),0==this.data.values.filter(t=>!t.disabled).length?a(this,vt,"m",It).call(this):a(this,vt,"m",Ct).call(this),this.isInit=!0,super.renderDropdown()}refresh(){super.refresh(),this.dropdown.refresh()}resize(){super.resize(),this.initAnimations(),a(this,vt,"m",Et).call(this),this.dropdown.resize()}prepareSettings(){super.prepareSettings();for(let t of this.data.values)t.disabled=!t.value,t.value??=0,t.current=t.value,t.innerRadius??=this.data.type==ht.Donut?this.data.innerRadius??50:0,t.value<0&&console.warn(`"${t.label}" has negative value (${t.value}) and will not be render`);if(this.data.values=this.data.values.filter(t=>t.value>=0),this.settings.enableOther&&this.data.values.length>20){const t=this.data.values.splice(20).reduce((t,i)=>t+i.current,0);this.data.values=this.data.values.slice(0,20),this.data.values.push(new Si({value:t,current:t,label:bi.other,id:di.guid(),color:"#a3a3a3",innerRadius:this.data.innerRadius}))}}}gt=new WeakMap,mt=new WeakMap,xt=new WeakMap,pt=new WeakMap,yt=new WeakMap,wt=new WeakMap,Mt=new WeakMap,bt=new WeakMap,kt=new WeakMap,vt=new WeakSet,Ct=function(){if(this.onMouseMoveEvent||!this.isInit){ai(this,mt,this.data.values.reduce((t,i)=>t+i.current,0),"f");let t=a(this,kt,"f");ai(this,bt,this.data.values.flatMap(i=>{const e=i.current/a(this,mt,"f")*2*Math.PI;return{id:i.id,value:e,sum:(t+=e)-e}}).reverse(),"f"),ai(this,Mt,a(this,vt,"m",Tt).call(this,a(this,gt,"f"),0),"f");for(const t of this.data.values)a(this,vt,"m",St).call(this,t);const i=this.data.values.find(t=>t.id==a(this,pt,"f"));this.tooltip.render(!!i,this.onMouseMoveEvent,[new Ti(`${i?.label}: ${i?.current.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`)]),a(this,vt,"m",Dt).call(this)}requestAnimationFrame(this.render.bind(this))},St=function(t){const i=ut.Canvas.getContext(this.canvas);i.fillStyle=t.color,i.strokeStyle=t.color;const e=t.current/a(this,mt,"f"),s=2*(isNaN(e)?1:e)*Math.PI,n=1==this.data.values.filter(t=>!t.disabled).length;!this.onClickEvent&&!a(this,yt,"f").includes(t.id)||this.animations.contains(t.id,at.Init)||n||this.animations.add(t.id,at.Click,{duration:100,before:()=>(this.onClickEvent&&a(this,vt,"m",Pt).call(this,this.onClickEvent,t)&&(a(this,yt,"f").includes(t.id)?ai(this,yt,a(this,yt,"f").filter(i=>i!=t.id),"f"):a(this,yt,"f").push(t.id),this.onClickEvent=new PointerEvent(lt.Click)),!0),body:()=>{if(!a(this,yt,"f").includes(t.id))return;let e=a(this,xt,"f")+s/2;const n={x:20*Math.cos(e),y:20*Math.sin(e)};i.translate(n.x,n.y),i.fillStyle=t.color}}),this.onMouseMoveEvent&&a(this,vt,"m",Pt).call(this,this.onMouseMoveEvent,t)&&ai(this,pt,t.id,"f"),!this.isInit||this.animations.contains(t.id,at.Init)?this.animations.add(t.id,at.Init,{timer:new Date,duration:125+(this.data.values.indexOf(t)+1)/this.data.values.length*175,continuous:!0,body:e=>{const n=a(this,wt,"f").x+a(this,gt,"f")/2*Math.cos(a(this,xt,"f")+s/2),h=a(this,wt,"f").y+a(this,gt,"f")/2*Math.sin(a(this,xt,"f")+s/2),o=.7,l=1-o;i.translate(n-n*(o+e*l),h-h*(o+e*l)),i.scale(o+e*l,o+e*l);let r=Math.round(255*e).toString(16);r.length<2&&(r=0+r),i.fillStyle=t.color+r,i.strokeStyle=t.color+r}}):!this.onMouseMoveEvent||this.animations.contains(t.id,at.Init)||a(this,yt,"f").includes(t.id)||n||(a(this,vt,"m",Pt).call(this,this.onMouseMoveEvent,t)?this.animations.add(t.id,at.MouseOver,{duration:100,body:e=>{const s=t.current/a(this,mt,"f"),n=2*(isNaN(s)?1:s)*Math.PI;this.canvas.style.cursor="pointer";let h=a(this,xt,"f")+n/2;const o={x:20*Math.cos(h)*e,y:20*Math.sin(h)*e};i.translate(o.x,o.y),t.transition=o,i.fillStyle=di.adjustColor(t.color,Math.round(33*e)),i.strokeStyle=di.adjustColor(t.color,Math.round(33*e)),this.animations.reload(t.id,at.MouseLeave)}}):this.animations.add(t.id,at.MouseLeave,{timer:si.Dates.minDate,duration:100,body:e=>{let n=a(this,xt,"f")+s/2;const h={x:20*Math.cos(n)*(1-e),y:20*Math.sin(n)*(1-e)};i.translate(h.x,h.y),t.transition=h,i.fillStyle=di.adjustColor(t.color,Math.round(33*(1-e))),i.strokeStyle=di.adjustColor(t.color,Math.round(33*(1-e))),this.animations.reload(t.id,at.MouseOver)}}));let h=a(this,vt,"m",Tt).call(this,a(this,gt,"f"),s);if(s>0){if(i.save(),t.current>0){let e=a(this,vt,"m",Tt).call(this,a(this,gt,"f")+10,s/2),n=a(this,vt,"m",Tt).call(this,a(this,gt,"f")+20,s/2);const h=e.x>a(this,wt,"f").x?1:-1;let o={x:n.x+10*h,y:n.y},l=!1;const r=di.stringWidth(t.label),f=1==h?o.x+8:o.x-r-8,d=new Uint32Array(i.getImageData(f,o.y-12,r,24).data.buffer);if((f<0||f+r>this.canvas.width||o.y-12<0||o.y+12>this.canvas.height)&&(l=!0),!l)for(let t=0;t<d.length;t++)if(ut.Canvas.isPixelBusy(d[t])){l=!0;break}if(!l){i.beginPath(),i.moveTo(e.x,e.y),i.quadraticCurveTo(n.x,n.y,o.x,o.y),i.strokeStyle=mi.text,i.stroke();let s=Math.round(t.current/t.value*255).toString(16);s.length<2&&(s=0+s),i.fillStyle=mi.text+s,i.textAlign=1==h?"start":"end",i.textBaseline="alphabetic",i.font="14px serif",i.fillText(t.label,o.x+8*h,o.y+4)}}i.restore(),i.beginPath(),this.data.type==ht.Pie&&i.moveTo(a(this,wt,"f").x,a(this,wt,"f").y),i.lineTo(a(this,Mt,"f").x,a(this,Mt,"f").y);let e=0,n=s;for(;n>0;){let t=n-Math.PI/6>0?Math.PI/6:n;h=a(this,vt,"m",Tt).call(this,a(this,gt,"f"),e+t);const s=Math.PI-t,o=a(this,gt,"f")/Math.sin(s/2),l=a(this,vt,"m",Tt).call(this,o,e+t/2);i.quadraticCurveTo(l.x,l.y,h.x,h.y),e+=t,n-=Math.PI/6}if(this.data.type==ht.Donut||0!=t.innerRadius){const o=a(this,gt,"f")*(t.innerRadius/100),l={x:h.x-(a(this,gt,"f")-o)*(h.x-a(this,wt,"f").x)/a(this,gt,"f"),y:h.y-(a(this,gt,"f")-o)*(h.y-a(this,wt,"f").y)/a(this,gt,"f")};for(i.lineTo(l.x,l.y),n=0,e=s;n<s;){let t=n+Math.PI/6<s?Math.PI/6:s-n;h=a(this,vt,"m",Tt).call(this,o,e-t);const l=Math.PI-t,r=o/Math.sin(l/2),f=a(this,vt,"m",Tt).call(this,r,e-t/2);i.quadraticCurveTo(f.x,f.y,h.x,h.y),e-=t,n+=Math.PI/6}h=a(this,vt,"m",Tt).call(this,a(this,gt,"f"),s)}i.fill(),i.stroke(),ai(this,xt,a(this,xt,"f")+s,"f")}i.resetTransform(),ai(this,Mt,h,"f")},Tt=function(t,i){return{x:a(this,wt,"f").x+t*Math.cos(a(this,xt,"f")+i),y:a(this,wt,"f").y+t*Math.sin(a(this,xt,"f")+i)}},Pt=function(t,i){const e=t=>t.x*t.x+t.y*t.y<=a(this,gt,"f")*a(this,gt,"f")&&(this.data.type!=ht.Donut||t.x*t.x+t.y*t.y>=a(this,gt,"f")*(i.innerRadius/100)*a(this,gt,"f")*(i.innerRadius/100));let s={x:t.clientX-this.canvasPosition.x+scrollX,y:t.clientY-this.canvasPosition.y+scrollY};const n={x:s.x-a(this,wt,"f").x,y:s.y-a(this,wt,"f").y},h={x:s.x-a(this,wt,"f").x-i.transition?.x,y:s.y-a(this,wt,"f").y-i.transition?.y};return(t=>{let e=Math.atan2(t.y-a(this,wt,"f").y,t.x-a(this,wt,"f").x);e<0&&(e+=2*Math.PI),e<a(this,kt,"f")&&(e=2*Math.PI-Math.abs(a(this,kt,"f")-e)+a(this,kt,"f"));let s=a(this,bt,"f").findIndex(t=>t.id==i.id),n=a(this,bt,"f")[s].sum;return n<=e&&n+a(this,bt,"f")[s].value-e>=0})(s)&&(e(n)||e(h))},It=function(){const t=ut.Canvas.getContext(this.canvas);t.beginPath(),t.arc(a(this,wt,"f").x,a(this,wt,"f").y,a(this,gt,"f"),0,2*Math.PI),t.strokeStyle=mi.text,t.stroke(),ut.TextStyles.regular(t),t.fillText(bi.allDataIsHidden,a(this,wt,"f").x,a(this,wt,"f").y),requestAnimationFrame(this.render.bind(this))},Dt=function(){if(this.data.innerTitle){const t=ut.Canvas.getContext(this.canvas);ut.TextStyles.large(t),t.fillText(this.data.innerTitle,a(this,wt,"f").x,a(this,wt,"f").y)}},Et=function(){const t=this.canvas.width>this.canvas.height?this.canvas.height:this.canvas.width;ai(this,wt,{x:this.canvas.width/2,y:this.canvas.height/2},"f"),ai(this,gt,t/3,"f")};class yi extends n{constructor(t,i){super(t,i),Wt.add(this),Lt.set(this,void 0),At.set(this,void 0),a(this,Wt,"m",Bt).call(this),this.initAnimations(),this.dropdown=new ri(this.canvas,{x:-10,y:10,text:bi.menu,items:[{text:bi.exportPNG,action:()=>{fi.asPng(this.canvas,this.settings.title)}}]})}render(){super.render(),a(this,Wt,"m",Rt).call(this);const t=this.data.values[0];this.tooltip.render(a(this,Wt,"m",Ft).call(this,this.onMouseMoveEvent,t),this.onMouseMoveEvent,[new Ti(`${t?.label}: ${t?.current.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`)]),requestAnimationFrame(this.render.bind(this)),this.isInit=!0,super.renderDropdown()}refresh(){super.refresh()}resize(){super.resize(),this.initAnimations(),a(this,Wt,"m",Bt).call(this)}prepareSettings(){super.prepareSettings();for(let t of this.data.values)t.disabled=!t.value,t.value??=0;this.data.values.length>0&&this.data.values[0].value>this.data.max&&(this.data.values[0].value=this.data.max)}}Lt=new WeakMap,At=new WeakMap,Wt=new WeakSet,Rt=function(){const t=ut.Canvas.getContext(this.canvas),i=this.data.values[0]??{id:di.guid()};this.isInit&&!this.animations.contains(i.id,at.Init)||this.animations.add(i.id,at.Init,{duration:450,continuous:!0,body:t=>{i.current=i.value*t}}),t.beginPath(),t.strokeStyle=i.color,t.lineCap="round",t.lineWidth=40;const e=i.current/this.data.max,s=(isNaN(e)?1:e)*Math.PI;i.value&&(t.arc(a(this,At,"f").x,a(this,At,"f").y,a(this,Lt,"f"),Math.PI,s-Math.PI),t.stroke()),t.beginPath(),t.lineWidth=1,t.lineCap="square";let n=0,h=Math.PI;for(;h>=0;){let i=h-Math.PI/10>0?Math.PI/10:h;const e=t=>({x:a(this,At,"f").x+(a(this,Lt,"f")+t)*Math.cos(Math.PI+n),y:a(this,At,"f").y+(a(this,Lt,"f")+t)*Math.sin(Math.PI+n)});let o=e(50),l=e(90),r=e(115);const f=Math.PI-h>s?"66":"ff";t.moveTo(o.x,o.y),t.lineTo(l.x,l.y),t.strokeStyle=mi.text+f,t.stroke(),ut.TextStyles.regular(t),t.fillStyle=mi.text+f,t.fillText((this.data.max-h/Math.PI*this.data.max).toString(),r.x,r.y),n+=i,h-=Math.PI/10}},Ft=function(t,i){if(!t)return!1;let e={x:t.clientX-this.canvasPosition.x+scrollX,y:t.clientY-this.canvasPosition.y+scrollY};const s={x:e.x-a(this,At,"f").x,y:e.y-a(this,At,"f").y};return(t=>{let e=Math.atan2(t.y-a(this,At,"f").y,t.x-a(this,At,"f").x);e<0&&(e+=2*Math.PI);const s=i.current/this.data.max,n=(isNaN(s)?1:s)*Math.PI;return e>Math.PI&&Math.PI+n>=e})(e)&&(t=>{const i=a(this,Lt,"f")+20,e=a(this,Lt,"f")-20;return t.x*t.x+t.y*t.y<=i*i&&t.x*t.x+t.y*t.y>=e*e})(s)},Bt=function(){const t=this.canvas.width<this.canvas.height?this.canvas.height-250:this.canvas.width;ai(this,Lt,t/3,"f"),ai(this,At,{x:this.canvas.width/2,y:this.canvas.height-a(this,Lt,"f")/5},"f")};class wi extends n{constructor(t,i){if(super(t,i),Ot.add(this),$t.set(this,void 0),Nt.set(this,void 0),Yt.set(this,void 0),jt.set(this,void 0),Xt.set(this,void 0),Ht.set(this,void 0),zt.set(this,void 0),qt.set(this,void 0),Vt.set(this,void 0),Gt.set(this,void 0),_t.set(this,void 0),Ut.set(this,void 0),this.data.values=this.data.values.map(t=>new Ci(t)),this.data.values.filter(t=>t.type==dt.Bar).length>0)for(let t of this.data.values){for(let i of t.values){const t=i.x;i.x=i.y,i.y=t}t.values.sort((t,i)=>i.x>t.x?1:-1)}ai(this,Yt,{top:30,right:40,bottom:50,left:80},"f"),i.title&&(a(this,Yt,"f").top+=50),this.dropdown=new ri(this.canvas,{x:-10,y:10,text:bi.menu,items:[{text:bi.exportPNG,action:()=>{fi.asPng(this.canvas,this.settings.title)}},{text:bi.exportCSV,action:()=>{fi.asCsv(li.toTable(Di.getRows(this.data)),this.settings.title)}},{text:bi.decomposeToTable,action:()=>{new ui(li.toTable(Di.getRows(this.data))).open()}}]}),a(this,Ot,"m",Zt).call(this),this.tooltip=new xi(this.canvas,this.settings),ai(this,Ht,new Map,"f"),ai(this,zt,new Map,"f"),this.initAnimations()}render(){super.render();let t=[new Ti(a(this,Ht,"f").get(Math.round(a(this,jt,"f")))??a(this,zt,"f").get(Math.round(a(this,Xt,"f"))))];const i=ut.Canvas.getContext(this.canvas);ut.TextStyles.regular(i),i.lineJoin="round";const e=mi.lineActive;a(this,Ot,"m",Qt).call(this);let s=0,n=0,h=0,o=0,l=0,r=0,f=this.data.values.filter(t=>t.type==dt.Column).length,d=0,c=this.data.values.filter(t=>t.type==dt.Bar).length,u=a(this,Nt,"f").step/(2*c),v=[];for(let t=0;t<a(this,Vt,"f").length;t++)v.push(0);let g=!1;for(const c of this.data.values.filter(t=>!t.disabled)){let m;i.beginPath(),i.strokeStyle=c.color,i.fillStyle=c.color,i.lineWidth=c.width;for(const e of c.values){let x=c.values.indexOf(e),p=a(this,qt,"f").indexOf(this.data.xType==ft.Date?e.x.toString():e.x),y=a(this,Vt,"f").indexOf(e.y);const w=()=>({x:e.x?this.data.xType==ft.Date?a(this,qt,"f")[p]:a(this,qt,"f")[p].toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0",y:e.y?a(this,Vt,"f")[y].toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0"});switch(s=a(this,Yt,"f").left,c.type!=dt.Bar&&(s+=p*a(this,$t,"f").step),c.type==dt.Line&&(s-=a(this,$t,"f").step/2-a(this,$t,"f").step),c.type){case dt.Line:n=a(this,Yt,"f").top+a(this,Ut,"f").height-e.y/a(this,Nt,"f").unit*a(this,Nt,"f").step-Math.abs(a(this,Nt,"f").min/a(this,Nt,"f").unit*a(this,Nt,"f").step);const M=1500/c.values.length*1.2;!this.isInit||this.animations.contains(e.id,at.Init)?this.animations.add(e.id,at.Init,{duration:x*M,continuous:!0,body:t=>{if(t=(t*x*M-x*M)/M,0==x||t<0)return;s=a(this,Yt,"f").left+p*a(this,$t,"f").step-a(this,$t,"f").step/2,n=a(this,Yt,"f").top+a(this,Ut,"f").height-e.y/a(this,Nt,"f").unit*a(this,Nt,"f").step-Math.abs(a(this,Nt,"f").min/a(this,Nt,"f").unit*a(this,Nt,"f").step);const h=c.values[x-1];let o={x:a(this,Yt,"f").left+p*a(this,$t,"f").step-a(this,$t,"f").step/2,y:a(this,Yt,"f").top+a(this,Ut,"f").height-h.y/a(this,Nt,"f").unit*a(this,Nt,"f").step-Math.abs(a(this,Nt,"f").min/a(this,Nt,"f").unit*a(this,Nt,"f").step)};i.moveTo(o.x,o.y),i.lineTo(o.x+(s-o.x)*t,o.y+(n-o.y)*t)}}):(i.lineTo(s,n),a(this,Ot,"m",Jt).call(this,s)&&(m={x:s,y:n,index:x},t.push(new Ti(`${c.label}: ${w().y}`,c.color)),ai(this,jt,s+a(this,$t,"f").step/2,"f")));break;case dt.AttentionLine:h=this.canvas.height-a(this,Yt,"f").bottom-e.y/a(this,Nt,"f").unit*a(this,Nt,"f").step,i.moveTo(a(this,Yt,"f").left,h),!this.isInit||this.animations.contains(e.id,at.Init)?this.animations.add(e.id,at.Init,{duration:1500,continuous:!0,body:t=>{i.lineTo(a(this,Yt,"f").left+(this.canvas.width-a(this,Yt,"f").left-a(this,Yt,"f").right)*t,this.canvas.height-a(this,Yt,"f").bottom-e.y/a(this,Nt,"f").unit*a(this,Nt,"f").step)}}):i.lineTo(this.canvas.width-a(this,Yt,"f").right,h);break;case dt.Column:h=e.y>this.data.yMax?this.data.yMax:e.y,n=a(this,Ut,"f").height*h/a(this,Nt,"f").max,n<a(this,Nt,"f").minStep&&(n=a(this,Nt,"f").minStep),l=a(this,$t,"f").step*(c.width?c.width/100:.5)/f,!this.isInit||this.animations.contains(e.id+r,at.Init)?this.animations.add(e.id+r,at.Init,{duration:800,continuous:!0,body:t=>{h=e.y>this.data.yMax?this.data.yMax:e.y,s=a(this,Yt,"f").left+p*a(this,$t,"f").step,n=a(this,Ut,"f").height*h/a(this,Nt,"f").max*t,n<a(this,Nt,"f").minStep&&(n=a(this,Nt,"f").minStep*t),r=this.data.values.filter(t=>t.type==dt.Column).indexOf(c),i.fillRect(s+r*l+(a(this,$t,"f").step-f*l)/2,this.canvas.height-a(this,Yt,"f").bottom-n,l,n)}}):(a(this,Ot,"m",Jt).call(this,s+a(this,$t,"f").step/2)?(g=this.data.values.filter(t=>(t.type==dt.Column||t.type==dt.StackingColumn)&&t.values.filter(t=>t.x==e.x).length>0&&!t.disabled).length-1<=r,m={x:s,y:n,index:x},t.push(new Ti(`${c.label}: ${w().y}`,c.color)),ai(this,jt,s+a(this,$t,"f").step,"f"),i.fillStyle+="88"):i.fillStyle=c.color,i.fillRect(s+r*l+(a(this,$t,"f").step-f*l)/2,this.canvas.height-a(this,Yt,"f").bottom-n,l,n));break;case dt.Bar:n=a(this,Yt,"f").top+y*a(this,Nt,"f").step+a(this,Nt,"f").step/2,!this.isInit||this.animations.contains(e.id+d,at.Init)?this.animations.add(e.id+d,at.Init,{duration:800,continuous:!0,body:t=>{n=a(this,Yt,"f").top+y*a(this,Nt,"f").step+a(this,Nt,"f").step/2,d=this.data.values.filter(t=>t.type==dt.Bar).indexOf(c),i.fillRect(s,n-a(this,Nt,"f").step/4+d*u,e.x/a(this,$t,"f").unit*a(this,$t,"f").step*t,u)}}):(i.fillRect(s,n-a(this,Nt,"f").step/4+d*u,e.x/a(this,$t,"f").unit*a(this,$t,"f").step,u),a(this,Ot,"m",Kt).call(this,n)&&(m={x:s,y:n,index:x},t.push(new Ti(`${c.label}: ${w().x}`,c.color)),ai(this,Xt,n-a(this,Nt,"f").step/2,"f")));break;case dt.StackingColumn:if(n=this.canvas.height-a(this,Yt,"f").bottom-e.y/a(this,Nt,"f").unit*a(this,Nt,"f").step,l=a(this,$t,"f").step*(c.width?c.width/100:.5),!this.isInit||this.animations.contains(e.id+x,at.Init))this.animations.add(e.id+x,at.Init,{duration:800,continuous:!0,body:t=>{r=this.data.values.filter(t=>t.type==dt.StackingColumn&&t.values.filter(t=>t.x==e.x).length>0).indexOf(c),s=a(this,Yt,"f").left+p*a(this,$t,"f").step,n=this.canvas.height-a(this,Yt,"f").bottom-e.y/a(this,Nt,"f").unit*a(this,Nt,"f").step,0==r&&(v[p]=0);let f=null!=v[p]?v[p]:0;h=this.canvas.height-a(this,Yt,"f").bottom+f,o=(n-this.canvas.height+a(this,Yt,"f").bottom)*t,h>a(this,Yt,"f").top&&(h+o<a(this,Yt,"f").top&&(o-=h+o-a(this,Yt,"f").top),i.fillRect(s+(a(this,$t,"f").step-l)/2,h,l,o)),v[p]+=(n-this.canvas.height+a(this,Yt,"f").bottom)*t}});else{a(this,Ot,"m",Jt).call(this,s+a(this,$t,"f").step/2)?(g=this.data.values.filter(t=>(t.type==dt.Column||t.type==dt.StackingColumn)&&t.values.filter(t=>t.x==e.x).length>0&&!t.disabled).length-1<=r,m={x:s,y:n,index:p},t.push(new Ti(`${c.label}: ${w().y}`,c.color)),ai(this,jt,s+a(this,$t,"f").step,"f"),i.fillStyle+="88"):i.fillStyle=c.color;let f=null!=v[p]?v[p]:0;h=this.canvas.height-a(this,Yt,"f").bottom+f,o=n-this.canvas.height+a(this,Yt,"f").bottom,h>a(this,Yt,"f").top&&(h+o<a(this,Yt,"f").top&&(o-=h+o-a(this,Yt,"f").top),i.fillRect(s+(a(this,$t,"f").step-l)/2,h,l,o)),v[p]+=n-this.canvas.height+a(this,Yt,"f").bottom}}}switch(c.type){case dt.Line:if(i.stroke(),m){const t=this.onMouseMoveEvent.clientX-this.canvasPosition.x+scrollX,s=this.onMouseMoveEvent.clientY-this.canvasPosition.y+scrollY;Math.abs(t-m.x)<25&&Math.abs(s-m.y)<25&&(i.beginPath(),i.lineWidth=1,i.strokeStyle=e,i.moveTo(a(this,Yt,"f").left,m.y),i.lineTo(this.canvas.width-a(this,Yt,"f").right,m.y),i.stroke()),i.beginPath(),i.arc(m.x,m.y,5,0,2*Math.PI),i.fill()}break;case dt.AttentionLine:i.stroke(),ut.TextStyles.regular(i),i.fillText(c.label,a(this,Yt,"f").left+(this.canvas.width-a(this,Yt,"f").left-a(this,Yt,"f").right)/2,this.canvas.height-a(this,Yt,"f").bottom-c.values[0].y/a(this,Nt,"f").unit*a(this,Nt,"f").step+16);break;case dt.Column:case dt.StackingColumn:if(m&&g){let t=null!=v[m.index]?v[m.index]:0;this.canvas.height-a(this,Yt,"f").bottom+t>a(this,Yt,"f").top&&(i.lineWidth=1,i.strokeStyle=e,i.moveTo(a(this,jt,"f")-a(this,$t,"f").step/2,a(this,Yt,"f").top),i.lineTo(a(this,jt,"f")-a(this,$t,"f").step/2,this.canvas.height-a(this,Yt,"f").bottom+t),i.stroke())}r++;break;case dt.Bar:m&&(i.lineWidth=1,i.strokeStyle=e,i.moveTo(a(this,Yt,"f").left,a(this,Xt,"f")+a(this,Nt,"f").step/2),i.lineTo(this.canvas.width-a(this,Yt,"f").right,a(this,Xt,"f")+a(this,Nt,"f").step/2),i.stroke()),d++}}i.beginPath(),i.strokeStyle=mi.line,i.lineWidth=1,i.moveTo(a(this,Yt,"f").left,this.canvas.height-a(this,Yt,"f").bottom),this.data.values.filter(t=>t.type==dt.Bar).length>0?i.lineTo(a(this,Yt,"f").left,a(this,Yt,"f").top):i.lineTo(this.canvas.width-a(this,Yt,"f").right,this.canvas.height-a(this,Yt,"f").bottom),i.stroke(),this.tooltip.render(t.length>1,this.onMouseMoveEvent,t),requestAnimationFrame(this.render.bind(this)),this.isInit=!0,super.renderDropdown()}refresh(){super.refresh()}resize(){super.resize(),ai(this,Gt,void 0,"f"),a(this,Ot,"m",Zt).call(this)}resetMouse(){super.resetMouse(),this.onMouseMoveEvent=new MouseEvent(lt.MouseMove),this.onClickEvent=new MouseEvent(lt.Click)}prepareSettings(){super.prepareSettings();for(let t of this.data.values){t.disabled=!t.values,t.type??=dt.Line;for(let i of t.values)i.id=di.guid(),this.data.xType==ft.Date&&("string"==typeof i.x&&di.isISOString(i.x)?i.x=new Date(i.x):console.warn(`${i.x} is not a date in ISO format.`))}}}$t=new WeakMap,Nt=new WeakMap,Yt=new WeakMap,jt=new WeakMap,Xt=new WeakMap,Ht=new WeakMap,zt=new WeakMap,qt=new WeakMap,Vt=new WeakMap,Gt=new WeakMap,_t=new WeakMap,Ut=new WeakMap,Ot=new WeakSet,Jt=function(t){if(!this.onMouseMoveEvent)return!1;let i=this.onMouseMoveEvent.clientX-this.canvasPosition.x+scrollX,e=this.onMouseMoveEvent.clientY-this.canvasPosition.y+scrollY;return t-a(this,$t,"f").step/2<=i&&i<t+a(this,$t,"f").step/2&&a(this,Yt,"f").top<=e&&e<=this.canvas.height-a(this,Yt,"f").bottom&&a(this,Yt,"f").left<i},Kt=function(t){if(!this.onMouseMoveEvent)return!1;let i=this.onMouseMoveEvent.clientX-this.canvasPosition.x+scrollX,e=this.onMouseMoveEvent.clientY-this.canvasPosition.y+scrollY;return t-a(this,Nt,"f").step/2<=e&&e<t+a(this,Nt,"f").step/2&&a(this,Yt,"f").left<=i&&i<=this.canvas.width-a(this,Yt,"f").right},Qt=function(){const t=ut.Canvas.getContext(this.canvas);if(a(this,Gt,"f"))return void t.putImageData(a(this,Gt,"f"),0,0);const i=mi.lineAxis,e=this.data.values.filter(t=>t.type==dt.Column).length>0,s=this.data.values.filter(t=>t.type==dt.Bar).length>0;(this.data.xTitle||this.data.yTitle)&&(t.textAlign="center",t.textBaseline="bottom",this.data.xTitle&&t.fillText(this.data.xTitle,a(this,Yt,"f").left+(this.canvas.width-a(this,Yt,"f").left-a(this,Yt,"f").right)/2,this.canvas.height-4),this.data.yTitle&&(t.rotate(-Math.PI/2),t.textBaseline="top",t.fillText(this.data.yTitle,-(a(this,Yt,"f").top+(this.canvas.height-a(this,Yt,"f").top-a(this,Yt,"f").bottom)/2),8),t.resetTransform())),t.textAlign="center",t.textBaseline="top";const n=a(this,$t,"f").count>20?20:a(this,$t,"f").count;let h=s?0:1,o=a(this,qt,"f").length/n;for(let n=s?0:1;n<a(this,qt,"f").length+1;n++){const l=a(this,Yt,"f").left+h*o*a(this,$t,"f").step,r=Math.round(a(this,Yt,"f").left+n*a(this,$t,"f").step);a(this,Ht,"f").has(r)||a(this,Ht,"f").set(r,this.data.xType==ft.Date?new Date(a(this,qt,"f")[n-1]).toLocaleDateString():isNaN(+a(this,$t,"f").min)||!isFinite(+a(this,$t,"f").min)?a(this,qt,"f")[n-1]:(a(this,$t,"f").min+(n+(e?-1:0))*(a(this,$t,"f").max-a(this,$t,"f").min)/(a(this,$t,"f").count-1)).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}));const f={x:l,y:this.canvas.height-a(this,Yt,"f").bottom,label:this.data.xType==ft.Date?new Date(a(this,qt,"f")[n-1]).toLocaleDateString():isNaN(+a(this,$t,"f").min)||!isFinite(+a(this,$t,"f").min)?a(this,qt,"f")[n-1]:(a(this,$t,"f").min+(n+(e?-1:0))*(a(this,$t,"f").max-a(this,$t,"f").min)/(a(this,$t,"f").count-1)).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})};let d=n>=h*o;if(d){const i=di.stringWidth(f.label),e=f.x,s=new Uint32Array(t.getImageData(e-i/2,f.y+4,i>0?i:1,24).data.buffer);for(let t=0;t<s.length;t++)if(ut.Canvas.isPixelBusy(s[t])){d=!1;break}}d&&(t.fillText(f.label,f.x-(s?0:a(this,$t,"f").step/2),f.y+12),s&&(t.beginPath(),t.moveTo(f.x,f.y),t.lineTo(f.x,a(this,Yt,"f").top),t.lineWidth=1,t.strokeStyle=i,t.stroke()),h++)}t.textAlign="right",t.textBaseline="middle";const l=a(this,Nt,"f").count>10?10:a(this,Nt,"f").count;let r=s?1:0,f=a(this,Vt,"f").length/l;for(let e=s?1:0;e<a(this,Vt,"f").length+1;e++){const n=this.canvas.height-r*f*a(this,Nt,"f").step-a(this,Yt,"f").bottom,h=Math.round(this.canvas.height-e*a(this,Nt,"f").step-a(this,Yt,"f").bottom);if(a(this,zt,"f").get(h)||a(this,zt,"f").set(h,(a(this,Nt,"f").min+(e+(s?-1:0))*(a(this,Nt,"f").max-a(this,Nt,"f").min)/a(this,Nt,"f").count).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})),e>=r*f){const e={x:a(this,Yt,"f").left,y:n,label:a(this,_t,"f")>=1?Math.round((a(this,Nt,"f").min+(r*f+(s?-1:0))*(a(this,Nt,"f").max-a(this,Nt,"f").min)/a(this,Nt,"f").count)/a(this,_t,"f"))*a(this,_t,"f"):Math.round(a(this,Nt,"f").min+(r*f+(s?-1:0))*(a(this,Nt,"f").max-a(this,Nt,"f").min)/a(this,Nt,"f").count/a(this,_t,"f"))*a(this,_t,"f")};let h;if(this.data.shortLabels){let t=0;for(;e.label>=1e3;)e.label/=1e3,t++;let i="";switch(t){case 1:i="K";break;case 2:i="M";break;case 3:i="B"}h=e.label.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+i}else h=e.label.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});t.fillText(h,e.x-12,e.y+(s?a(this,Nt,"f").step/2:0)),this.data.values.filter(t=>t.type==dt.Column||t.type==dt.StackingColumn||t.type==dt.Line).length>0&&(t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(this.canvas.width-a(this,Yt,"f").right,e.y),t.lineWidth=1,t.strokeStyle=i,t.stroke()),r++}}ai(this,Gt,t.getImageData(0,0,this.canvas.width,this.canvas.height),"f")},Zt=function(){let t=this.data.values.flatMap(t=>t.values.map(t=>t.x)),i=this.data.values.flatMap(t=>t.values.map(t=>t.y));const e=this.data.xType==ft.Date;if(e){let l=new Date(Math.min(...t));function r(t,i){let e=new Date(t);return e.setDate(e.getDate()+i),e}for(;l.getTime()<Math.max(...t);)t.includes(l.getTime())||t.push(new Date(l.getTime())),l=r(l,1);t.sort((t,i)=>t<i?-1:1)}i.sort((t,i)=>i>t?-1:1),ai(this,qt,[...new Set(t.filter(t=>null!=t).map(t=>e?t.toString():t))],"f"),ai(this,Vt,[...new Set(i.filter(t=>null!=t))],"f"),ai(this,$t,{min:Math.min(...t),max:Math.max(...t),unit:(Math.abs(Math.min(...t))+Math.abs(Math.max(...t)))/(a(this,qt,"f").length-1),step:(this.canvas.width-a(this,Yt,"f").left-a(this,Yt,"f").right)/a(this,qt,"f").length,minStep:0,count:a(this,qt,"f").length},"f");let s=Math.min(...i);s>0&&(s=0),ai(this,Nt,{min:s,max:this.data.yMax??Math.max(...i),unit:(Math.abs(s)+Math.abs(this.data.yMax??Math.max(...i)))/(a(this,Vt,"f").length-1),step:(this.canvas.height-a(this,Yt,"f").top-a(this,Yt,"f").bottom)/a(this,Vt,"f").length,minStep:0,count:a(this,Vt,"f").length},"f");let n,h=this.data.values.filter(t=>t.type==dt.StackingColumn);if(h.length>0){let f=h.map(t=>t.values.flatMap(t=>+t.y));n=a(this,Nt,"f").max;for(let d=0;d<f[0].length;d++){let c=0;for(const u of f)c+=u[d];c>n&&(n=c)}a(this,Nt,"f").max=n>this.data.yMax?this.data.yMax:n,a(this,Nt,"f").unit=(Math.abs(a(this,Nt,"f").min)+Math.abs(a(this,Nt,"f").max))/(a(this,Vt,"f").length-1)}const o=di.stringWidth(a(this,Nt,"f").max.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}));o>a(this,Yt,"f").left-40&&(a(this,Yt,"f").left+=o-a(this,Yt,"f").left+40,a(this,$t,"f").step=(this.canvas.width-a(this,Yt,"f").left-a(this,Yt,"f").right)/a(this,qt,"f").length),ai(this,_t,Math.abs(a(this,Nt,"f").min)+Math.abs(a(this,Nt,"f").max),"f"),.5<=a(this,_t,"f")&&a(this,_t,"f")<1?ai(this,_t,.05,"f"):1<=a(this,_t,"f")&&a(this,_t,"f")<10?ai(this,_t,.1,"f"):10<=a(this,_t,"f")&&a(this,_t,"f")<100?ai(this,_t,2,"f"):100<=a(this,_t,"f")&&a(this,_t,"f")<1e3?ai(this,_t,20,"f"):1e3<=a(this,_t,"f")&&a(this,_t,"f")<1e4?ai(this,_t,50,"f"):1e4<=a(this,_t,"f")&&a(this,_t,"f")<1e5?ai(this,_t,1e3,"f"):1e5<=a(this,_t,"f")&&a(this,_t,"f")<1e6?ai(this,_t,1e4,"f"):1e6<=a(this,_t,"f")&&a(this,_t,"f")<1e7?ai(this,_t,5e4,"f"):ai(this,_t,1,"f"),1!=a(this,_t,"f")&&(n=i.length>10?10*(a(this,Nt,"f").max/10+a(this,_t,"f")-a(this,Nt,"f").max/10%a(this,_t,"f")):Math.ceil(a(this,Nt,"f").max/a(this,_t,"f"))*a(this,_t,"f"),a(this,Nt,"f").max=n>this.data.yMax?this.data.yMax:n,a(this,Nt,"f").unit=(Math.abs(a(this,Nt,"f").min)+Math.abs(a(this,Nt,"f").max))/a(this,Vt,"f").length),ai(this,Ut,{width:this.canvas.width-a(this,Yt,"f").left-a(this,Yt,"f").right,height:this.canvas.height-a(this,Yt,"f").top-a(this,Yt,"f").bottom,x:0,y:0,left:0,bottom:0,right:0,top:0,toJSON(){}},"f"),a(this,$t,"f").minStep=.002*a(this,Ut,"f").width,a(this,Nt,"f").minStep=.002*a(this,Ut,"f").height};class Mi extends n{constructor(t,i){super(t,i),ti.add(this),this.data.values.sort((t,i)=>i.value>t.value?1:-1);const e=i.baseColor??di.randomColor();let s=Math.round(100/this.data.values.length),a=-50;s<=1&&(s=1);for(let t of this.data.values)t.color=di.adjustColor(e,a+=s);this.dropdown=new ri(this.canvas,{x:-10,y:10,text:bi.menu,items:[{text:bi.exportCSV,action:()=>{fi.asCsv(li.toTable(Ei.getRows(this.data)),this.settings.title)}},{text:bi.decomposeToTable,action:()=>{new ui(li.toTable(Ei.getRows(this.data))).open()}}]}),this.initAnimations()}render(){if(super.render(),0==this.data.values.filter(t=>t.value>0).length)return void a(this,ti,"m",ei).call(this);let t=this.settings.title?50:0,i=this.canvas.width-2*this.data.padding,e=this.canvas.height-2*this.data.padding-t,s=this.data.values.reduce((t,i)=>t+i.value,0),n=i*e,h=this.data.padding,o=this.data.padding+t,l=this.data.padding,r=this.data.padding+t,f=new Pi;const d=ut.Canvas.getContext(this.canvas);let c=!0;for(let u=0;u<this.data.values.length;u++){const v=this.data.values[u],g=i-l+this.data.padding,m=e-r+this.data.padding+t;let x=[{color:v.color,label:v.label,s:v.value/s*n,value:v.value,id:v.id,x:h,y:o,w:0,h:0}];if(u+1<=this.data.values.length-1){const t=this.data.values[u+1];x.push({color:t.color,label:t.label,s:t.value/s*n,value:t.value,id:t.id,x:h,y:o,w:0,h:0}),u++}const p=1==x.length,y=u==this.data.values.length-1;if(c)for(let t=1;t<=g+u*u;t++){const i=g-t,e=x[0].s/i;if(e+(p?0:x[1].s/i)>=m){x[0].w=Math.floor(i),x[0].h=Math.floor(e),p||(x[1].w=Math.floor(i),x[1].h=m-x[0].h,x[1].y+=x[0].h);break}}else for(let t=1;t<=m+u*u;t++){const i=m-t,e=x[0].s/i;if(e+(p?0:x[1].s/i)>=g){x[0].h=Math.floor(i),x[0].w=Math.floor(e),p||(x[1].h=Math.floor(i),x[1].w=g-x[0].w,x[1].x+=x[0].w);break}}for(const t of x){y&&(c?(t.w=g,p&&(t.h=m)):(t.h=m,p&&(t.w=g))),d.beginPath(),d.fillStyle=t.color;const i=this.isInit&&!this.animations.contains(t.id,at.Init),e=u+x.indexOf(t)+(y&&p?1:0),l=260,r=()=>{let t=0;for(let i=0;i<e;i++)t+=l-l*(i/this.data.values.length)/Math.E;return t},v=l-l*e/(this.data.values.length+1);i?a(this,ti,"m",ii).call(this,t)?(f=t,this.animations.add(t.id,at.MouseOver,{duration:140,body:i=>{i=1-i;const e=t.x+t.w/2,s=t.y+t.h/2,a=t.w>t.h?1-12/t.w:1-12/t.h,n=1-a;d.translate(e-e*(a+i*n),s-s*(a+i*n)),d.scale(a+i*n,a+i*n),this.animations.reload(t.id,at.MouseLeave)}})):this.animations.add(t.id,at.MouseLeave,{timer:si.Dates.minDate,duration:140,body:i=>{const e=t.x+t.w/2,s=t.y+t.h/2,a=t.w>t.h?1-12/t.w:1-12/t.h,n=1-a;d.translate(e-e*(a+i*n),s-s*(a+i*n)),d.scale(a+i*n,a+i*n),this.animations.reload(t.id,at.MouseOver)}}):this.animations.add(t.id,at.Init,{duration:r(),continuous:!0,body:i=>{if(i*r()-r()+v<0)return d.fillStyle+="00";i=(i*r()-r()+v)/v;const e=t.x+t.w/2,s=t.y+t.h/2,a=.7,n=1-a;d.translate(e-e*(a+i*n),s-s*(a+i*n)),d.scale(a+i*n,a+i*n);let h=Math.round(255*i).toString(16);h.length<2&&(h=0+h),d.fillStyle=t.color+h}});const w=4;d.roundRect(h+w,o+w,t.w-w,t.h-w,2*w),d.fill(),t.label&&di.stringWidth(t.label)<t.w-w&&t.h-w>16&&!this.animations.contains(t.id,at.Init)&&(d.beginPath(),ut.TextStyles.large(d),d.fillStyle=di.isColorVisible(t.color,"#ffffff")?"#ffffff":"#000000",d.fillText(t.label,h+t.w/2,o+t.h/2)),d.resetTransform(),c?o+=t.h:h+=t.w,n-=t.w*t.h,s-=t.value}c?(h+=x[0].w,o=r):(o+=x[0].h,h=l),l=h,r=o,c=!c}this.tooltip.render(!!f,this.onMouseMoveEvent,[new Ti(`${f?.label}: ${f?.value?.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`)],this.data.values.find(t=>t.id==f?.id)),requestAnimationFrame(this.render.bind(this)),this.isInit=!0,super.renderDropdown()}refresh(){super.refresh()}resize(){super.resize(),this.initAnimations(),this.animations.clear()}prepareSettings(){this.data.values.sort((t,i)=>(i.value??0)-(t.value??0)),super.prepareSettings();for(let t of this.data.values)t.disabled=!t.value,t.value??=0}}ti=new WeakSet,ii=function(t){if(!this.onMouseMoveEvent||!t)return!1;let i=this.onMouseMoveEvent.clientX-this.canvasPosition.x+scrollX,e=this.onMouseMoveEvent.clientY-this.canvasPosition.y+scrollY;return t.x<=i&&i<=t.x+t.w&&t.y<=e&&e<=t.y+t.h},ei=function(){const t=ut.Canvas.getContext(this.canvas);ut.TextStyles.regular(t),t.fillText(bi.incorrectValues,this.canvas.width/2,this.canvas.height/2)};class bi{}bi.exportPNG="Export PNG",bi.decomposeToTable="Decompose to Table",bi.reset="Reset",bi.exportCSV="Export CSV",bi.menu="Menu",bi.allDataIsHidden="All data is hidden",bi.other="Other",bi.incorrectValues="Incorrect values",function(t){class i{}i.minDate=new Date(2e3,1,1),t.Dates=i}(si||(si={}));class ki{}class Ci extends t{constructor(t){super(),Object.assign(this,t)}toggle(t){super.toggle(t)}checkCondition(){return super.checkCondition(),!0}reset(){super.reset()}}class Si extends t{constructor(t){super(),Object.assign(this,t)}toggle(t){super.toggle(t),this.disabled?this.current=this.value*(1-t):this.current=this.value*t}checkCondition(){return super.checkCondition(),0==this.current&&!this.disabled||0!=this.value}reset(){super.reset(),this.current=this.value}}class Ti{constructor(t,i){this.text=t,this.color=i}}class Pi{constructor(){}}class Ii{static getRows(t){const i="Value";let e=[];for(const s of t.values)e.push({name:s.label,values:new Map([[i,s.value]])});return{headers:[{value:i,display:i}],values:e}}}class Di{static getRows(t){let i=[],e=[];for(const s of t.values){let a=new Map;for(const e of s.values)a.set(e.x.toString(),e.y),i.push({value:e.x.toString(),display:t.xType==ft.Date?new Date(e.x).toLocaleDateString():e.x.toString()});e.push({name:s.label,values:a})}const s=new Set,a=i.filter(t=>!s.has(t.display)&&s.add(t.display));return t.xType==ft.Date&&a.sort((t,i)=>new Date(t.value).getTime()-new Date(i.value).getTime()),{headers:a,values:e}}}class Ei{static getRows(t){const i="Value";let e=[];for(const s of t.values)e.push({name:s.label,values:new Map([[i,s.value]])});return{headers:[{value:i,display:i}],values:e}}}}};t[832](),t[172]()})();
//# sourceMappingURL=ocharts.js.map