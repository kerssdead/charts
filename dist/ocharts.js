(()=>{"use strict";({832:function(){class t{toggle(t){0==t&&(this.disabled=!this.disabled)}checkCondition(){return!1}reset(){this.disabled=!1}}class i{constructor(t,i){this.isInit=!1,this.node=t,this.settings=i,this.animations=new li,this.canvas=document.createElement(lt.Canvas),this.node.append(this.canvas),this.tooltip=new mi(this.canvas,i),this.initAnimations()}render(){ft.Canvas.getContext(this.canvas).clearRect(0,0,this.canvas.width,this.canvas.height)}refresh(){this.tooltip.refresh(),this.isInit=!1}resetMouse(){this.onMouseMoveEvent=new MouseEvent(ht.MouseMove),this.onClickEvent=new MouseEvent(ht.Click)}initAnimations(){this.canvasPosition=this.canvas.getBoundingClientRect(),this.canvasPosition.x+=scrollX,this.canvasPosition.y+=scrollY,this.isInit||(this.canvas.onmousemove=t=>this.onMouseMoveEvent=t,this.canvas.onclick=t=>this.onClickEvent=t)}}var s,e,h=this&&this.__classPrivateFieldGet||function(t,i,s,e){if("a"===s&&!e)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof i?t!==i||!e:!i.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?e:"a"===s?e.call(t):e?e.value:i.get(t)};class a extends i{constructor(t,i){super(t,i),s.add(this),this.data=i.data,h(this,s,"m",e).call(this)}render(){super.render();const t=ft.Canvas.getContext(this.canvas);this.settings.title&&(ft.TextStyles.title(t),t.fillText(this.settings.title,this.canvas.width/2,40)),this.onClickEvent=this.dropdown?.render(this.onMouseMoveEvent,this.onClickEvent)}resize(){this.tooltip.refresh(),h(this,s,"m",e).call(this)}prepareSettings(){const t=this.node.parentElement.getBoundingClientRect();this.settings.maxWidth=this.settings.width??t.width,this.settings.maxHeight=this.settings.height??t.height,0==+this.settings.width&&(this.settings.width=t.width>this.settings.maxWidth&&0!=+this.settings.maxWidth?this.settings.maxWidth:t.width),0==+this.settings.height&&(this.settings.height=t.height>this.settings.maxHeight&&0!=+this.settings.maxHeight?this.settings.maxHeight:t.height);const i=this.settings.baseColor??ui.randomColor();let s=Math.round(100/this.settings.data.values.length),e=-50;s<=1&&(s=1);for(let t of this.settings.data.values)t.id=ui.guid(),t.color??=ui.adjustColor(i,e+=s)}}s=new WeakSet,e=function(){let t=this.node.getBoundingClientRect();this.canvas.width=t.width>this.settings.maxWidth?this.settings.maxWidth:t.width,this.canvas.height=t.height>this.settings.maxHeight?this.settings.maxHeight:t.height,this.settings.enableLegend&&(this.settings.legendPlace!=at.Top&&this.settings.legendPlace!=at.Bottom||(this.canvas.height-=gi.getLegendHeight(this.settings.data.values,this.canvas.width)),this.settings.legendPlace!=at.Left&&this.settings.legendPlace!=at.Right||(this.canvas.width-=500))};var n,o,l,f,r,d,c,u,g,v,m,p,x,y,w,M,b,k,C,S,T,I,W,P,D,E,L,A,R,B,F,O,Y,X,j,$,N,H,z,q,G,_,U,V,J,K,Q,Z,tt,it,st,et,ht,at,nt,ot,lt,ft,rt,dt,ct,ut,gt,vt,mt,pt,xt,yt,wt,Mt,bt,kt,Ct,St,Tt,It,Wt,Pt,Dt,Et,Lt,At,Rt,Bt,Ft,Ot,Yt,Xt,jt,$t,Nt,Ht,zt,qt,Gt,_t,Ut,Vt,Jt,Kt,Qt,Zt,ti,ii,si,ei,hi,ai,ni,oi=this&&this.__classPrivateFieldSet||function(t,i,s,e,h){if("m"===e)throw new TypeError("Private method is not writable");if("a"===e&&!h)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof i?t!==i||!h:!i.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===e?h.call(t,s):h?h.value=s:i.set(t,s),s};class li{constructor(){n.add(this),l.set(this,void 0),oi(this,l,new Map,"f")}add(t,i,s){const e=h(this,n,"m",r).call(this,t,i);h(this,l,"f").has(e)||h(this,l,"f").set(e,s),h(this,n,"m",f).call(this,e)}contains(t,i){return h(this,l,"f").has(h(this,n,"m",r).call(this,t,i))}reload(t,i){this.contains(t,i)&&(h(this,l,"f").get(h(this,n,"m",r).call(this,t,i)).timer=new Date)}clear(){h(this,l,"f").forEach((t,i)=>!h(this,n,"m",d).call(this,i,tt.Init)&&h(this,l,"f").delete(i))}static initializeTransitions(){for(let t=0;t<2e4;t++){const i=(t+1)/2e4;let s=0*Math.pow(1-i,3)+3*Math.pow(1-i,2)*.23*i+3*(1-i)*Math.pow(i,2)*.77+1*Math.pow(i,3),e=0*Math.pow(1-i,3)+3*Math.pow(1-i,2)*.77*i+3*(1-i)*Math.pow(i,2)*.23+1*Math.pow(i,3);o.transitionCurve.set(+s.toFixed(4),e)}o.transitionCurve.set(0,0)}static getTransition(t){return o.transitionCurve.get(+t.toFixed(4))??0}}o=li,l=new WeakMap,n=new WeakSet,f=function(t){const i=h(this,l,"f").get(t),s=new Date,e=s.getTime()-(i.timer??s).getTime(),a=o.getTransition(e>i.duration?1:e/i.duration),n=!i.before||i.before();!i.timer&&n&&(i.timer=s),n&&i.body(a),1!=a||n&&!i.continuous||h(this,l,"f").delete(t)},r=function(t,i){return t+"_"+i},d=function(t,i){return t.endsWith("_"+i)},li.transitionCurve=new Map;class fi{constructor(t,i){c.add(this),u.set(this,void 0),g.set(this,void 0),v.set(this,void 0),m.set(this,void 0),p.set(this,void 0),oi(this,u,t,"f"),oi(this,g,i,"f"),this.animations=new li,h(this,c,"m",x).call(this);const s=ui.stringWidth(h(this,g,"f").text)+20;oi(this,p,{x:h(this,g,"f").x+s>h(this,u,"f").width?h(this,u,"f").width-s:h(this,g,"f").x<0?h(this,u,"f").width+h(this,g,"f").x-s:h(this,g,"f").x,y:h(this,g,"f").y+24>h(this,u,"f").height?h(this,u,"f").height-24:h(this,g,"f").y<0?h(this,u,"f").height+h(this,g,"f").y-24:h(this,g,"f").y,width:s,height:24},"f")}render(t,i){h(this,m,"f")||h(this,c,"m",x).call(this);const s=ft.Canvas.getContext(h(this,u,"f"));return s.beginPath(),h(this,c,"m",y).call(this,t)?(h(this,u,"f").style.cursor="pointer",i&&h(this,c,"m",y).call(this,i)&&(h(this,g,"f").action(),i=void 0),this.animations.add("animation-button",tt.MouseOver,{duration:300,before:()=>null==i,body:t=>{this.animations.reload("animation-button-leave",tt.MouseLeave),s.fillStyle=ui.adjustColor("#ffffff",-Math.round(40*t))}})):this.animations.add("animation-button-leave",tt.MouseLeave,{duration:300,body:t=>{this.animations.reload("animation-button",tt.MouseOver),s.fillStyle=ui.adjustColor("#ffffff",-Math.round(40*(1-t)))}}),s.strokeStyle="#ffffff",s.roundRect(h(this,p,"f").x,h(this,p,"f").y,h(this,p,"f").width,h(this,p,"f").height,4),s.fill(),ft.TextStyles.regular(s),s.fillText(h(this,g,"f").text,h(this,p,"f").x+h(this,p,"f").width/2,h(this,p,"f").y+h(this,p,"f").height/2),oi(this,m,!0,"f"),i}}u=new WeakMap,g=new WeakMap,v=new WeakMap,m=new WeakMap,p=new WeakMap,c=new WeakSet,x=function(){oi(this,v,h(this,u,"f").getBoundingClientRect(),"f"),h(this,v,"f").x+=scrollX,h(this,v,"f").y+=scrollY},y=function(t){if(!t)return!1;let i=t.clientX-h(this,v,"f").x+scrollX,s=t.clientY-h(this,v,"f").y+scrollY;return i>=h(this,p,"f").x&&i<=h(this,p,"f").x+h(this,p,"f").width&&s>=h(this,p,"f").y&&s<=h(this,p,"f").y+h(this,p,"f").height};class ri{constructor(t,i){w.add(this),M.set(this,void 0),b.set(this,void 0),k.set(this,void 0),h(this,w,"m",I).call(this),t.chart=this,this.node=t,this.node.style.display="flex",this.node.style.flexDirection="column",this.node.style.alignItems="center",this.settings=i,h(this,w,"m",C).call(this),i.enableLegend&&(oi(this,b,new gi(t,i),"f"),null!=i.legendPlace&&i.legendPlace!=at.Bottom&&i.legendPlace!=at.Top||(i.height-=h(this,b,"f").canvas.height)),document.addEventListener(ht.VisibilityChanged,()=>h(this,M,"f").resetMouse()),window.addEventListener(ht.Blur,()=>h(this,M,"f").resetMouse())}render(){h(this,M,"f").render(),h(this,b,"f")?.render(),oi(this,k,new ResizeObserver(()=>h(this,w,"m",T).call(this)),"f"),h(this,k,"f").observe(this.node),h(this,w,"m",S).call(this)}}M=new WeakMap,b=new WeakMap,k=new WeakMap,w=new WeakSet,C=function(){switch(this.settings.type){case it.Plot:oi(this,M,new yi(this.node,this.settings),"f");break;case it.Circular:oi(this,M,new pi(this.node,this.settings),"f");break;case it.Gauge:oi(this,M,new xi(this.node,this.settings),"f");break;case it.TreeMap:oi(this,M,new wi(this.node,this.settings),"f")}h(this,M,"f").prepareSettings()},S=function(){h(this,M,"f").refresh(),h(this,b,"f")?.refresh()},T=function(){h(this,M,"f").resize(),h(this,b,"f")?.resize()},I=function(){li.initializeTransitions()};class di{constructor(t,i){W.add(this),P.set(this,void 0),D.set(this,void 0),E.set(this,void 0),this.isActive=!1,L.set(this,void 0),A.set(this,void 0),oi(this,P,t,"f"),oi(this,D,i,"f"),this.animations=new li,h(this,W,"m",R).call(this);const s=ui.stringWidth(h(this,D,"f").text)+20;oi(this,A,{x:h(this,D,"f").x+s>h(this,P,"f").width?h(this,P,"f").width-s:h(this,D,"f").x<0?h(this,P,"f").width+h(this,D,"f").x-s:h(this,D,"f").x,y:h(this,D,"f").y+24>h(this,P,"f").height?h(this,P,"f").height-24:h(this,D,"f").y<0?h(this,P,"f").height+h(this,D,"f").y-24:h(this,D,"f").y,width:s,height:24},"f")}render(t,i){h(this,L,"f")||h(this,W,"m",R).call(this);const s=ft.Canvas.getContext(h(this,P,"f"));s.beginPath();let e=h(this,A,"f").x,a=h(this,A,"f").y,n=h(this,A,"f").width,o=h(this,A,"f").height;if(h(this,W,"m",B).call(this,t,e,a,n,o)?(h(this,P,"f").style.cursor="pointer",i&&t.x==i.x&&t.y==i.y&&(this.isActive=!this.isActive,i=void 0),this.isActive?s.fillStyle=ui.adjustColor("#ffffff",-40):this.animations.add("animation-dropdown",tt.MouseOver,{duration:300,body:t=>{this.animations.reload("animation-dropdown",tt.MouseLeave),s.fillStyle=ui.adjustColor("#ffffff",-Math.round(40*t))}})):(h(this,P,"f").style.cursor="default",this.isActive?s.fillStyle=ui.adjustColor("#ffffff",-40):this.animations.add("animation-dropdown",tt.MouseLeave,{duration:300,body:t=>{this.animations.reload("animation-dropdown",tt.MouseOver),s.fillStyle=ui.adjustColor("#ffffff",-Math.round(40*(1-t)))}})),s.strokeStyle="#ffffff",s.roundRect(e,a,n,o,4),s.fill(),ft.TextStyles.regular(s),s.fillText(h(this,D,"f").text,e+n/2,a+o/2),this.isActive){a+=o;let n=Math.max(...h(this,D,"f").items.map(t=>ui.stringWidth(t.text)))+8;n<50&&(n=50),e+n>h(this,P,"f").width-4&&(e-=e+n-h(this,P,"f").width+4),s.beginPath(),s.roundRect(e,a,n,20*h(this,D,"f").items.length+8,4),s.fillStyle="#ffffff",s.strokeStyle="#353535",s.fill(),s.stroke(),s.beginPath(),a+=4;for(const o of h(this,D,"f").items)h(this,W,"m",B).call(this,t,e,a,n,20)?(this.animations.add("animation-dropdown"+o.text,tt.MouseOver,{duration:300,before:()=>null==i,body:t=>{this.animations.reload("animation-dropdown"+o.text,tt.MouseLeave),s.fillStyle=ui.adjustColor("#ffffff",60-Math.round(100*t))}}),h(this,P,"f").style.cursor="pointer",i&&(o.action(),i=void 0,this.isActive=!1)):this.animations.add("animation-dropdown"+o.text,tt.MouseLeave,{duration:300,body:t=>{this.animations.reload("animation-dropdown",tt.MouseOver),s.fillStyle=ui.adjustColor("#ffffff",60-Math.round(100*(1-t)))}}),s.rect(e,a,n,20),s.fill(),s.fillStyle="#000000",s.textAlign="center",s.textBaseline="hanging",s.fillText(o.text,e+n/2,a+4),a+=20}return null!=i&&this.isActive&&(this.isActive=!1,i=void 0),oi(this,L,!0,"f"),i}refresh(){oi(this,L,!1,"f")}resize(){h(this,W,"m",R).call(this)}}P=new WeakMap,D=new WeakMap,E=new WeakMap,L=new WeakMap,A=new WeakMap,W=new WeakSet,R=function(){oi(this,E,h(this,P,"f").getBoundingClientRect(),"f"),h(this,E,"f").x+=scrollX,h(this,E,"f").y+=scrollY},B=function(t,i,s,e,a){if(!t)return!1;let n=t.clientX-h(this,E,"f").x+scrollX,o=t.clientY-h(this,E,"f").y+scrollY;return n>=i&&n<=i+e&&o>=s&&o<=s+a};class ci{static asPng(t,i){const s=ft.Canvas.getContext(t);let e=ui.stringWidth("Export PNG")+16;e<50&&(e=50),s.clearRect(t.width-e,0,e,64);let h=0,a=0;const n=new Uint32Array(s.getImageData(0,0,t.width,t.height).data.buffer);let o=!1;for(let i=0;i<t.width;i++){for(let s=0;s<t.height;s++)if(4278190080&n[i+s*t.width]){o=!0;break}if(o)break;h++}o=!1;for(let i=t.width;i>=0;i--){for(let s=0;s<t.height;s++)if(4278190080&n[i+s*t.width]){o=!0;break}if(o)break;a++}h>4&&(h-=4),a>4&&(a-=4),h>a&&(h=a),a>h&&(a=h);let l=document.createElement(lt.Canvas);l.width=t.width-h-a,l.height=t.height;const f=ft.Canvas.getContext(l);f.fillStyle="#FFFFFF",f.fillRect(0,0,t.width,t.height),f.drawImage(t,-h,0);let r=document.createElement(lt.A);r.href=l.toDataURL("image/png"),r.download=(i??"chart")+".png",r.click()}}class ui{static adjustColor(t,i){return"#"+t.replace(/^#/,"").replace(/../g,t=>("0"+Math.min(255,Math.max(0,parseInt(t,16)+i)).toString(16)).slice(-2))}static grayScale(t){return"#"+Array(4).join(Math.round([.3,.59,.11].reduce((i,s,e)=>i+s*parseInt(t[2*e+1]+t[2*e+2],16),0)/3).toString(16).padStart(2,"0"))}static randomColor(){let t="#";for(let i=0;i<6;i++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}static stringWidth(t,i){const s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2796875,.2765625,.3546875,.5546875,.5546875,.8890625,.665625,.190625,.3328125,.3328125,.3890625,.5828125,.2765625,.3328125,.2765625,.3015625,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.2765625,.2765625,.584375,.5828125,.584375,.5546875,1.0140625,.665625,.665625,.721875,.721875,.665625,.609375,.7765625,.721875,.2765625,.5,.665625,.5546875,.8328125,.721875,.7765625,.665625,.7765625,.721875,.665625,.609375,.721875,.665625,.94375,.665625,.665625,.609375,.2765625,.3546875,.2765625,.4765625,.5546875,.3328125,.5546875,.5546875,.5,.5546875,.5546875,.2765625,.5546875,.5546875,.221875,.240625,.5,.221875,.8328125,.5546875,.5546875,.5546875,.5546875,.3328125,.5,.2765625,.5546875,.5,.721875,.5,.5,.5,.3546875,.259375,.353125,.5890625];return Array.from(t).reduce((t,i)=>t+(s[i.charCodeAt(0)]??.5279276315789471),0)*(i||14)}static guid(){const t=()=>(65536*(1+Math.random())|0).toString(16).substring(1);return(t()+t()+"-"+t()+"-4"+t().slice(0,3)+"-"+t()+"-"+t()+t()+t()).toLowerCase()}static hexToRgb(t){if(t.length>4){const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(i)return{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}}else{const i=/^#?([a-f\d])([a-f\d])([a-f\d])$/i.exec(t);if(i)return{r:parseInt(i[1]+i[1],16),g:parseInt(i[2]+i[2],16),b:parseInt(i[3]+i[3],16)}}return new Mi}static isColorVisible(t,i){const s=ui.hexToRgb(t),e=ui.hexToRgb(i);return(s.r+s.g+s.b)/(e.r+e.g+e.b)<.77}static isISOString(t){return/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+/.test(t)}}class gi extends i{constructor(t,i){switch(super(t,i),F.add(this),O.set(this,void 0),Y.set(this,void 0),i.legendPlace){case at.Bottom:default:this.canvas.width=i.width,this.canvas.height=gi.getLegendHeight(i.data.values,this.canvas.width),t.style.flexDirection="column";break;case at.Top:this.canvas.width=i.width??i.maxWidth,this.canvas.height=gi.getLegendHeight(i.data.values,this.canvas.width),t.style.flexDirection="column-reverse";break;case at.Left:this.canvas.width=500,this.canvas.height=i.height??i.maxHeight,t.style.flexDirection="row";break;case at.Right:this.canvas.width=500,this.canvas.height=i.height??i.maxHeight,t.style.flexDirection="row-reverse"}oi(this,O,new fi(this.canvas,{x:-10,y:10,text:"Reset",action:()=>{for(let t of i.data.values)t.reset()}}),"f"),oi(this,Y,{x:gi.getOffsetToCenter(this.settings.data.values,this.canvas.width),y:(this.canvas.height-gi.getLegendHeight(this.settings.data.values,this.canvas.width))/2},"f")}render(){super.render();const t=ft.Canvas.getContext(this.canvas);let i={x:20,y:20};this.canvas.style.cursor="default",ft.TextStyles.regular(t),t.textAlign="start",t.textBaseline="alphabetic",t.translate(h(this,Y,"f").x,h(this,Y,"f").y);for(const t of this.settings.data.values.filter(t=>!t.hideInLegend))i=h(this,F,"m",X).call(this,t,i.x,i.y);t.translate(-h(this,Y,"f").x,-h(this,Y,"f").y),requestAnimationFrame(this.render.bind(this)),this.onClickEvent=h(this,O,"f").render(this.onMouseMoveEvent,this.onClickEvent),this.isInit=!0}refresh(){this.isInit=!1}resize(){this.initAnimations()}static getOffsetToCenter(t,i){let s=20;for(const e of t.filter(t=>!t.hideInLegend)){const t=ui.stringWidth(e.label);if(s+t+47>=i-100)break;s+=t+47}return i/2-s/2}static getLegendHeight(t,i){let s=1,e=20,h=gi.getOffsetToCenter(t,i);for(const a of t.filter(t=>!t.hideInLegend)){const t=ui.stringWidth(a.label);e+t+57>=i-100-h&&(e=20,s++),e+=t+57}return 40*s}}function vi(){}O=new WeakMap,Y=new WeakMap,F=new WeakSet,X=function(t,i,s){const e=ft.Canvas.getContext(this.canvas),a=ui.stringWidth(t.label),n=10;i+50+a>=this.canvas.width-100-h(this,Y,"f").x&&(i=20,s+=38);let o=i-n-n,l=s-5-n,f=52+a;const r=t=>{if(!t)return!1;const i=t.clientX-this.canvasPosition.x+scrollX-h(this,Y,"f").x,s=t.clientY-this.canvasPosition.y+scrollY-h(this,Y,"f").y;return i>=o&&i<=o+f&&s>=l&&s<=l+30};return this.onClickEvent&&this.animations.add(t.id,tt.Click,{duration:220,continuous:!0,before:()=>r(this.onClickEvent)&&t.checkCondition(),body:i=>{t.toggle(i),1==i&&(this.onClickEvent=new PointerEvent(ht.Click))}}),this.onMouseMoveEvent&&(r(this.onMouseMoveEvent)&&(this.canvas.style.cursor="pointer"),this.animations.add(t.id,tt.MouseLeave,{duration:100,before:()=>!r(this.onMouseMoveEvent)&&!this.isInit,body:t=>{e.roundRect(o,l,f,30,n),e.fillStyle=ui.adjustColor("#ffffff",Math.round(-50*(1-t))),e.fill()}}),this.animations.add(t.id,tt.MouseOver,{duration:100,before:()=>r(this.onMouseMoveEvent),body:t=>{e.beginPath(),e.roundRect(o,l,f,30,n),e.fillStyle=ui.adjustColor("#ffffff",Math.round(-50*t)),e.fill()}})),e.beginPath(),e.arc(i,s,n,0,2*Math.PI),e.fillStyle=t.disabled?ui.grayScale(t.color):t.color,e.fill(),e.fillStyle="#000000",e.fillText(t.label,i+20,s+4),i+=20,t.disabled&&(e.moveTo(i-5,s),e.lineTo(i+a,s),e.strokeStyle="#000000",e.stroke()),{x:i+=a+45,y:s}},vi.chart=function(t,i){return new ri(t,i)},window.OCharts=vi;class mi{constructor(t,i){j.add(this),$.set(this,void 0),N.set(this,void 0),H.set(this,void 0),z.set(this,void 0),q.set(this,void 0),G.set(this,void 0),_.set(this,void 0),U.set(this,120),V.set(this,void 0),this.canvas=t,this.data=i.data,oi(this,$,i.enableTooltip,"f"),oi(this,N,!!i.templateId,"f"),h(this,N,"f")&&oi(this,z,document.getElementById(i.templateId),"f"),this.refresh()}render(t,i,s,e){if(h(this,j,"m",Q).call(this),h(this,$,"f")&&i)if(t||h(this,q,"f")||h(this,G,"f")){t&&oi(this,V,s,"f"),h(this,_,"f")||oi(this,_,new Date,"f"),h(this,G,"f")?h(this,q,"f")&&oi(this,_,new Date,"f"):oi(this,q,!0,"f"),h(this,N,"f")?h(this,j,"m",K).call(this,i,e):h(this,j,"m",J).call(this,i);const a=h(this,j,"m",Z).call(this);h(this,G,"f")&&a>=1&&(oi(this,q,!1,"f"),oi(this,G,!1,"f")),h(this,G,"f")&&a<=0&&(oi(this,q,!1,"f"),oi(this,G,!1,"f"),oi(this,_,void 0,"f")),t||null==h(this,_,"f")||oi(this,G,!0,"f")}else oi(this,_,void 0,"f")}refresh(){oi(this,H,this.canvas.getBoundingClientRect(),"f"),h(this,H,"f").x+=scrollX,h(this,H,"f").y+=scrollY}}$=new WeakMap,N=new WeakMap,H=new WeakMap,z=new WeakMap,q=new WeakMap,G=new WeakMap,_=new WeakMap,U=new WeakMap,V=new WeakMap,j=new WeakSet,J=function(t){const i=ft.Canvas.getContext(this.canvas),s=Math.max(...h(this,V,"f").map(t=>ui.stringWidth(t.text??"")+(t.color?8:0)));let e=t.clientX-h(this,H,"f").x+10,a=t.clientY-h(this,H,"f").y+scrollY+10;e+s+16>h(this,H,"f").width&&(e=h(this,H,"f").width-(s+16)),a+10+18*h(this,V,"f").length>h(this,H,"f").height&&(a=h(this,H,"f").height-10-18*h(this,V,"f").length),i.beginPath(),i.roundRect(e,a,s+16,16+16*h(this,V,"f").length,20);let n=Math.round(77*h(this,j,"m",Z).call(this)).toString(16);1==n.length&&(n="0"+n),i.fillStyle="#000000"+n,i.fill();for(let t of h(this,V,"f")){let s=0;t.color&&(s=12,i.beginPath(),i.fillStyle=t.color,i.arc(e+16,a+17,5,0,2*Math.PI),i.fill()),i.fillStyle="#ffffff",i.font="14px serif",i.textAlign="start",i.textBaseline="alphabetic",i.fillText(t.text??"",e+s+12,a+22),a+=16}},K=function(t,i){if(null==i)return;const s=h(this,z,"f").id+i.id;let e=document.getElementById(s);const a=()=>{h(this,j,"m",Q).call(this),e.style.visibility="visible"};if(!e){const t=/\${[^}]*}/gm;let n=h(this,z,"f").cloneNode(!0);e=document.createElement(lt.Div),e.innerHTML=n.innerHTML,e.id=s,e.style.position="absolute",e.style.pointerEvents="none",e.style.visibility="visible",e.setAttribute("name",h(this,z,"f").id);const o=[...e.innerHTML.matchAll(t)];let l=e.innerHTML;for(const t of o){const s=t[0].replace("${","").replace("}","").replaceAll(" ","");l=l.replaceAll(t[0],i.data[s])}e.innerHTML=l,document.body.appendChild(e),e.position=e.getBoundingClientRect(),a()}"hidden"==e.style.visibility&&a(),0==e.position.height&&(e.position=e.getBoundingClientRect());const n=10;let o=t.clientX,l=t.clientY+scrollY;o+e.position.width-h(this,H,"f").x>h(this,H,"f").width-n&&(o=h(this,H,"f").width-e.position.width+h(this,H,"f").x-n),l+e.position.height-h(this,H,"f").y>h(this,H,"f").height-n&&(l=h(this,H,"f").height-e.position.height+h(this,H,"f").y-n),e.style.left=o+n+"px",e.style.top=l+n+"px"},Q=function(){if(!h(this,N,"f"))return;const t=document.querySelectorAll(`[name="${h(this,z,"f").id}"]`);for(let i of t)i.style.visibility="hidden"},Z=function(){if(!h(this,_,"f"))return 0;let t=h(this,G,"f")?1-((new Date).getTime()-h(this,_,"f").getTime())/h(this,U,"f"):((new Date).getTime()-h(this,_,"f").getTime())/h(this,U,"f");return t>1&&(t=1),t<0&&(t=0),t},function(t){t[t.MouseOver=0]="MouseOver",t[t.MouseLeave=1]="MouseLeave",t[t.Init=2]="Init",t[t.Click=3]="Click"}(tt||(tt={})),function(t){t[t.Plot=0]="Plot",t[t.Circular=1]="Circular",t[t.Gauge=2]="Gauge",t[t.TreeMap=3]="TreeMap"}(it||(it={})),function(t){t[t.Pie=0]="Pie",t[t.Donut=1]="Donut"}(st||(st={})),function(t){t.NullContext="Can't find context"}(et||(et={})),function(t){t.VisibilityChanged="visibilitychange",t.Blur="blur",t.MouseMove="mousemove",t.Click="click"}(ht||(ht={})),function(t){t[t.Bottom=0]="Bottom",t[t.Left=1]="Left",t[t.Top=2]="Top",t[t.Right=3]="Right"}(at||(at={})),function(t){t[t.Date=1]="Date"}(nt||(nt={})),function(t){t[t.Line=0]="Line",t[t.AttentionLine=1]="AttentionLine",t[t.Column=2]="Column",t[t.Bar=3]="Bar",t[t.StackingColumn=4]="StackingColumn"}(ot||(ot={})),function(t){t.Canvas="canvas",t.A="a",t.Div="div"}(lt||(lt={})),function(t){t.Canvas=class{static getContext(i){return i.getContext("2d",{willReadFrequently:!0})??t.Errors.throw(et.NullContext)}}}(ft||(ft={})),function(t){t.Errors=class{static throw(t){throw new Error(t)}}}(ft||(ft={})),function(t){t.TextStyles=class{static title(t){t.fillStyle="#000000",t.textAlign="center",t.textBaseline="middle",t.font="20px serif"}static regular(t){t.fillStyle="#000000",t.textAlign="center",t.textBaseline="middle",t.font="14px serif"}static large(t){t.fillStyle="#000000",t.textAlign="center",t.textBaseline="middle",t.font="16px serif"}}}(ft||(ft={}));class pi extends a{constructor(t,i){super(t,i),rt.add(this),dt.set(this,void 0),ct.set(this,void 0),ut.set(this,void 0),gt.set(this,void 0),vt.set(this,void 0),mt.set(this,void 0),pt.set(this,void 0),xt.set(this,void 0),yt.set(this,void 0),this.data.values=this.data.values.map(t=>new ki(t)),this.dropdown=new di(this.canvas,{x:-10,y:10,text:"Menu",items:[{text:"Export PNG",action:()=>{ci.asPng(this.canvas,this.settings.title)}}]}),h(this,rt,"m",Tt).call(this),oi(this,yt,Math.random()%(2*Math.PI),"f"),oi(this,vt,[],"f"),this.initAnimations(),this.canvas.dispatchEvent(new MouseEvent(ht.MouseMove))}render(){super.render(),oi(this,ut,h(this,yt,"f"),"f"),oi(this,gt,void 0,"f"),0==this.data.values.filter(t=>!t.disabled).length?h(this,rt,"m",Ct).call(this):h(this,rt,"m",wt).call(this),this.isInit=!0}refresh(){super.refresh(),this.dropdown.refresh()}resize(){super.resize(),this.initAnimations(),h(this,rt,"m",Tt).call(this),this.dropdown.resize()}prepareSettings(){super.prepareSettings();for(let t of this.data.values)t.disabled=!t.value,t.value??=0,t.current=t.value,t.innerRadius??=this.data.type==st.Donut?this.data.innerRadius??50:0,t.value<0&&console.warn(`"${t.label}" has negative value (${t.value}) and will not be render`);if(this.data.values=this.data.values.filter(t=>t.value>=0),this.settings.enableOther&&this.data.values.length>20){const t=this.data.values.splice(20).reduce((t,i)=>t+i.current,0);this.data.values=this.data.values.slice(0,20),this.data.values.push(new ki({value:t,current:t,label:"Other",id:ui.guid(),color:"#a3a3a3",innerRadius:this.data.innerRadius}))}}}dt=new WeakMap,ct=new WeakMap,ut=new WeakMap,gt=new WeakMap,vt=new WeakMap,mt=new WeakMap,pt=new WeakMap,xt=new WeakMap,yt=new WeakMap,rt=new WeakSet,wt=function(){if(this.onMouseMoveEvent||!this.isInit){oi(this,ct,this.data.values.reduce((t,i)=>t+i.current,0),"f");let t=h(this,yt,"f");oi(this,xt,this.data.values.flatMap(i=>{const s=i.current/h(this,ct,"f")*2*Math.PI;return{id:i.id,value:s,sum:(t+=s)-s}}).reverse(),"f"),oi(this,pt,h(this,rt,"m",bt).call(this,h(this,dt,"f"),0),"f");for(const t of this.data.values)h(this,rt,"m",Mt).call(this,t);const i=this.data.values.find(t=>t.id==h(this,gt,"f"));this.tooltip.render(!!i,this.onMouseMoveEvent,[new Ci(`${i?.label}: ${i?.current.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`)]),h(this,rt,"m",St).call(this)}requestAnimationFrame(this.render.bind(this))},Mt=function(t){const i=ft.Canvas.getContext(this.canvas);i.fillStyle=t.color,i.strokeStyle=t.color;const s=t.current/h(this,ct,"f"),e=2*(isNaN(s)?1:s)*Math.PI,a=1==this.data.values.filter(t=>!t.disabled).length;!this.onClickEvent&&!h(this,vt,"f").includes(t.id)||this.animations.contains(t.id,tt.Init)||a||this.animations.add(t.id,tt.Click,{duration:100,before:()=>(this.onClickEvent&&h(this,rt,"m",kt).call(this,this.onClickEvent,t)&&(h(this,vt,"f").includes(t.id)?oi(this,vt,h(this,vt,"f").filter(i=>i!=t.id),"f"):h(this,vt,"f").push(t.id),this.onClickEvent=new PointerEvent("click")),!0),body:()=>{if(!h(this,vt,"f").includes(t.id))return;let s=h(this,ut,"f")+e/2;const a={x:20*Math.cos(s),y:20*Math.sin(s)};i.translate(a.x,a.y),i.fillStyle=t.color}}),this.onMouseMoveEvent&&h(this,rt,"m",kt).call(this,this.onMouseMoveEvent,t)&&oi(this,gt,t.id,"f"),!this.isInit||this.animations.contains(t.id,tt.Init)?this.animations.add(t.id,tt.Init,{timer:new Date,duration:125+(this.data.values.indexOf(t)+1)/this.data.values.length*175,continuous:!0,body:s=>{const a=h(this,mt,"f").x+h(this,dt,"f")/2*Math.cos(h(this,ut,"f")+e/2),n=h(this,mt,"f").y+h(this,dt,"f")/2*Math.sin(h(this,ut,"f")+e/2),o=.7,l=1-o;i.translate(a-a*(o+s*l),n-n*(o+s*l)),i.scale(o+s*l,o+s*l);let f=Math.round(255*s).toString(16);f.length<2&&(f=0+f),i.fillStyle=t.color+f,i.strokeStyle=t.color+f}}):!this.onMouseMoveEvent||this.animations.contains(t.id,tt.Init)||h(this,vt,"f").includes(t.id)||a||(h(this,rt,"m",kt).call(this,this.onMouseMoveEvent,t)?this.animations.add(t.id,tt.MouseOver,{duration:100,body:s=>{const e=t.current/h(this,ct,"f"),a=2*(isNaN(e)?1:e)*Math.PI;this.canvas.style.cursor="pointer";let n=h(this,ut,"f")+a/2;const o={x:20*Math.cos(n)*s,y:20*Math.sin(n)*s};i.translate(o.x,o.y),t.transition=o,i.fillStyle=ui.adjustColor(t.color,Math.round(33*s)),i.strokeStyle=ui.adjustColor(t.color,Math.round(33*s)),this.animations.reload(t.id,tt.MouseLeave)}}):this.animations.add(t.id,tt.MouseLeave,{timer:new Date(2e3,1,1),duration:100,body:s=>{let a=h(this,ut,"f")+e/2;const n={x:20*Math.cos(a)*(1-s),y:20*Math.sin(a)*(1-s)};i.translate(n.x,n.y),t.transition=n,i.fillStyle=ui.adjustColor(t.color,Math.round(33*(1-s))),i.strokeStyle=ui.adjustColor(t.color,Math.round(33*(1-s))),this.animations.reload(t.id,tt.MouseOver)}}));let n=h(this,rt,"m",bt).call(this,h(this,dt,"f"),e);if(e>0){if(i.save(),t.current>0){let s=h(this,rt,"m",bt).call(this,h(this,dt,"f")+10,e/2),a=h(this,rt,"m",bt).call(this,h(this,dt,"f")+20,e/2);const n=s.x>h(this,mt,"f").x?1:-1;let o={x:a.x+10*n,y:a.y},l=!1;const f=ui.stringWidth(t.label),r=1==n?o.x+8:o.x-f-8,d=new Uint32Array(i.getImageData(r,o.y-12,f,24).data.buffer);if((r<0||r+f>this.canvas.width||o.y-12<0||o.y+12>this.canvas.height)&&(l=!0),!l)for(let t=0;t<d.length;t++)if(4278190080&d[t]){l=!0;break}if(!l){i.beginPath(),i.moveTo(s.x,s.y),i.quadraticCurveTo(a.x,a.y,o.x,o.y),i.strokeStyle="#000000",i.stroke();let e=Math.round(t.current/t.value*255).toString(16);e.length<2&&(e=0+e),i.fillStyle="#000000"+e,i.textAlign=1==n?"start":"end",i.textBaseline="alphabetic",i.font="14px serif",i.fillText(t.label,o.x+8*n,o.y+4)}}i.restore(),i.beginPath(),this.data.type==st.Pie&&i.moveTo(h(this,mt,"f").x,h(this,mt,"f").y),i.lineTo(h(this,pt,"f").x,h(this,pt,"f").y);let s=0,a=e;for(;a>0;){let t=a-Math.PI/6>0?Math.PI/6:a;n=h(this,rt,"m",bt).call(this,h(this,dt,"f"),s+t);const e=Math.PI-t,o=h(this,dt,"f")/Math.sin(e/2),l=h(this,rt,"m",bt).call(this,o,s+t/2);i.quadraticCurveTo(l.x,l.y,n.x,n.y),s+=t,a-=Math.PI/6}if(this.data.type==st.Donut||0!=t.innerRadius){const o=h(this,dt,"f")*(t.innerRadius/100),l={x:n.x-(h(this,dt,"f")-o)*(n.x-h(this,mt,"f").x)/h(this,dt,"f"),y:n.y-(h(this,dt,"f")-o)*(n.y-h(this,mt,"f").y)/h(this,dt,"f")};for(i.lineTo(l.x,l.y),a=0,s=e;a<e;){let t=a+Math.PI/6<e?Math.PI/6:e-a;n=h(this,rt,"m",bt).call(this,o,s-t);const l=Math.PI-t,f=o/Math.sin(l/2),r=h(this,rt,"m",bt).call(this,f,s-t/2);i.quadraticCurveTo(r.x,r.y,n.x,n.y),s-=t,a+=Math.PI/6}n=h(this,rt,"m",bt).call(this,h(this,dt,"f"),e)}i.fill(),i.stroke(),oi(this,ut,h(this,ut,"f")+e,"f")}i.resetTransform(),oi(this,pt,n,"f")},bt=function(t,i){return{x:h(this,mt,"f").x+t*Math.cos(h(this,ut,"f")+i),y:h(this,mt,"f").y+t*Math.sin(h(this,ut,"f")+i)}},kt=function(t,i){const s=t=>t.x*t.x+t.y*t.y<=h(this,dt,"f")*h(this,dt,"f")&&(this.data.type!=st.Donut||t.x*t.x+t.y*t.y>=h(this,dt,"f")*(i.innerRadius/100)*h(this,dt,"f")*(i.innerRadius/100));let e={x:t.clientX-this.canvasPosition.x+scrollX,y:t.clientY-this.canvasPosition.y+scrollY};const a={x:e.x-h(this,mt,"f").x,y:e.y-h(this,mt,"f").y},n={x:e.x-h(this,mt,"f").x-i.transition?.x,y:e.y-h(this,mt,"f").y-i.transition?.y};return(t=>{let s=Math.atan2(t.y-h(this,mt,"f").y,t.x-h(this,mt,"f").x);s<0&&(s+=2*Math.PI),s<h(this,yt,"f")&&(s=2*Math.PI-Math.abs(h(this,yt,"f")-s)+h(this,yt,"f"));let e=h(this,xt,"f").findIndex(t=>t.id==i.id),a=h(this,xt,"f")[e].sum;return a<=s&&a+h(this,xt,"f")[e].value-s>=0})(e)&&(s(a)||s(n))},Ct=function(){const t=ft.Canvas.getContext(this.canvas);t.beginPath(),t.arc(h(this,mt,"f").x,h(this,mt,"f").y,h(this,dt,"f"),0,2*Math.PI),t.strokeStyle="#000000",t.stroke(),ft.TextStyles.regular(t),t.fillText("All data is hidden",h(this,mt,"f").x,h(this,mt,"f").y),requestAnimationFrame(this.render.bind(this))},St=function(){if(this.data.innerTitle){const t=ft.Canvas.getContext(this.canvas);ft.TextStyles.large(t),t.fillText(this.data.innerTitle,h(this,mt,"f").x,h(this,mt,"f").y)}},Tt=function(){const t=this.canvas.width>this.canvas.height?this.canvas.height:this.canvas.width;oi(this,mt,{x:this.canvas.width/2,y:this.canvas.height/2},"f"),oi(this,dt,t/3,"f")};class xi extends a{constructor(t,i){super(t,i),It.add(this),Wt.set(this,void 0),Pt.set(this,void 0),h(this,It,"m",Lt).call(this),this.initAnimations(),this.dropdown=new di(this.canvas,{x:-10,y:10,text:"Menu",items:[{text:"Export PNG",action:()=>{ci.asPng(this.canvas,this.settings.title)}}]})}render(){super.render(),h(this,It,"m",Dt).call(this);const t=this.data.values[0];this.tooltip.render(h(this,It,"m",Et).call(this,this.onMouseMoveEvent,t),this.onMouseMoveEvent,[new Ci(`${t?.label}: ${t?.current.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`)]),requestAnimationFrame(this.render.bind(this)),this.isInit=!0}refresh(){super.refresh()}resize(){super.resize(),this.initAnimations(),h(this,It,"m",Lt).call(this)}prepareSettings(){super.prepareSettings();for(let t of this.data.values)t.disabled=!t.value,t.value??=0;this.data.values.length>0&&this.data.values[0].value>this.data.max&&(this.data.values[0].value=this.data.max)}}Wt=new WeakMap,Pt=new WeakMap,It=new WeakSet,Dt=function(){const t=ft.Canvas.getContext(this.canvas),i=this.data.values[0]??{id:ui.guid()};this.isInit&&!this.animations.contains(i.id,tt.Init)||this.animations.add(i.id,tt.Init,{duration:450,continuous:!0,body:t=>{i.current=i.value*t}}),t.beginPath(),t.strokeStyle=i.color,t.lineCap="round",t.lineWidth=40;const s=i.current/this.data.max,e=(isNaN(s)?1:s)*Math.PI;i.value&&(t.arc(h(this,Pt,"f").x,h(this,Pt,"f").y,h(this,Wt,"f"),Math.PI,e-Math.PI),t.stroke()),t.beginPath(),t.lineWidth=1,t.lineCap="square";let a=0,n=Math.PI;for(;n>=0;){let i=n-Math.PI/10>0?Math.PI/10:n;const s=t=>({x:h(this,Pt,"f").x+(h(this,Wt,"f")+t)*Math.cos(Math.PI+a),y:h(this,Pt,"f").y+(h(this,Wt,"f")+t)*Math.sin(Math.PI+a)});let o=s(50),l=s(90),f=s(115);const r=Math.PI-n>e?"66":"ff";t.moveTo(o.x,o.y),t.lineTo(l.x,l.y),t.strokeStyle="#000000"+r,t.stroke(),ft.TextStyles.regular(t),t.fillStyle="#000000"+r,t.fillText((this.data.max-n/Math.PI*this.data.max).toString(),f.x,f.y),a+=i,n-=Math.PI/10}},Et=function(t,i){if(!t)return!1;let s={x:t.clientX-this.canvasPosition.x+scrollX,y:t.clientY-this.canvasPosition.y+scrollY};const e={x:s.x-h(this,Pt,"f").x,y:s.y-h(this,Pt,"f").y};return(t=>{let s=Math.atan2(t.y-h(this,Pt,"f").y,t.x-h(this,Pt,"f").x);s<0&&(s+=2*Math.PI);const e=i.current/this.data.max,a=(isNaN(e)?1:e)*Math.PI;return s>Math.PI&&Math.PI+a>=s})(s)&&(t=>{const i=h(this,Wt,"f")+20,s=h(this,Wt,"f")-20;return t.x*t.x+t.y*t.y<=i*i&&t.x*t.x+t.y*t.y>=s*s})(e)},Lt=function(){const t=this.canvas.width<this.canvas.height?this.canvas.height-250:this.canvas.width;oi(this,Wt,t/3,"f"),oi(this,Pt,{x:this.canvas.width/2,y:this.canvas.height-h(this,Wt,"f")/3},"f")};class yi extends a{constructor(t,i){if(super(t,i),At.add(this),Rt.set(this,void 0),Bt.set(this,void 0),Ft.set(this,void 0),Ot.set(this,void 0),Yt.set(this,void 0),Xt.set(this,void 0),jt.set(this,void 0),$t.set(this,void 0),Nt.set(this,void 0),Ht.set(this,void 0),zt.set(this,void 0),qt.set(this,void 0),Gt.set(this,void 0),_t.set(this,void 0),Ut.set(this,void 0),Vt.set(this,void 0),this.data.values=this.data.values.map(t=>new bi(t)),this.data.values.filter(t=>t.type==ot.Bar).length>0)for(let t of this.data.values){for(let i of t.values){const t=i.x;i.x=i.y,i.y=t}t.values.sort((t,i)=>i.x>t.x?1:-1)}oi(this,Ft,{top:30,right:40,bottom:50,left:80},"f"),i.title&&(h(this,Ft,"f").top+=50),oi(this,jt,new di(this.canvas,{x:-10,y:10,text:"Menu",items:[{text:"Export PNG",action:()=>{ci.asPng(this.canvas,this.settings.title)}}]}),"f"),h(this,At,"m",ti).call(this),this.tooltip=new mi(this.canvas,this.settings),oi(this,Ht,new Map,"f"),oi(this,zt,new Map,"f"),h(this,At,"m",Jt).call(this)}render(){super.render();let t=[new Ci(h(this,Ht,"f").get(Math.round(h(this,$t,"f")))??h(this,zt,"f").get(Math.round(h(this,Nt,"f"))))];const i=ft.Canvas.getContext(this.canvas);ft.TextStyles.regular(i),i.lineJoin="round";const s="#00000088";h(this,At,"m",Zt).call(this);let e=0,a=0,n=0,o=0,l=0,f=0,r=this.data.values.filter(t=>t.type==ot.Column).length,d=0,c=this.data.values.filter(t=>t.type==ot.Bar).length,u=h(this,Bt,"f").step/(2*c),g=[];for(let t=0;t<h(this,Gt,"f").length;t++)g.push(0);let v=!1;for(const c of this.data.values.filter(t=>!t.disabled)){let m;i.beginPath(),i.strokeStyle=c.color,i.fillStyle=c.color,i.lineWidth=c.width;for(const s of c.values){let p=c.values.indexOf(s),x=h(this,qt,"f").indexOf(this.data.xType==nt.Date?s.x.toString():s.x),y=h(this,Gt,"f").indexOf(s.y);const w=()=>({x:s.x?this.data.xType==nt.Date?h(this,qt,"f")[x]:h(this,qt,"f")[x].toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0",y:s.y?h(this,Gt,"f")[y].toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0"});switch(e=h(this,Ft,"f").left,c.type!=ot.Bar&&(e+=x*h(this,Rt,"f").step),c.type==ot.Line&&(e-=h(this,Rt,"f").step/2-h(this,Rt,"f").step),c.type){case ot.Line:a=h(this,Ft,"f").top+h(this,Vt,"f").height-s.y/h(this,Bt,"f").unit*h(this,Bt,"f").step-Math.abs(h(this,Bt,"f").min/h(this,Bt,"f").unit*h(this,Bt,"f").step);const M=1500/c.values.length*1.2;!this.isInit||this.animations.contains(s.id,tt.Init)?this.animations.add(s.id,tt.Init,{duration:p*M,continuous:!0,body:t=>{if(t=(t*p*M-p*M)/M,0==p||t<0)return;e=h(this,Ft,"f").left+x*h(this,Rt,"f").step-h(this,Rt,"f").step/2,a=h(this,Ft,"f").top+h(this,Vt,"f").height-s.y/h(this,Bt,"f").unit*h(this,Bt,"f").step-Math.abs(h(this,Bt,"f").min/h(this,Bt,"f").unit*h(this,Bt,"f").step);const n=c.values[p-1];let o=h(this,Ft,"f").left+x*h(this,Rt,"f").step-h(this,Rt,"f").step/2,l=h(this,Ft,"f").top+h(this,Vt,"f").height-n.y/h(this,Bt,"f").unit*h(this,Bt,"f").step-Math.abs(h(this,Bt,"f").min/h(this,Bt,"f").unit*h(this,Bt,"f").step);i.lineTo(o+(e-o)*t,l+(a-l)*t)}}):(i.lineTo(e,a),h(this,At,"m",Kt).call(this,e)&&(m={x:e,y:a,index:p},t.push(new Ci(`${c.label}: ${w().y}`,c.color)),oi(this,$t,e+h(this,Rt,"f").step/2,"f")));break;case ot.AttentionLine:n=this.canvas.height-h(this,Ft,"f").bottom-s.y/h(this,Bt,"f").unit*h(this,Bt,"f").step,i.moveTo(h(this,Ft,"f").left,n),!this.isInit||this.animations.contains(s.id,tt.Init)?this.animations.add(s.id,tt.Init,{duration:1500,continuous:!0,body:t=>{i.lineTo(h(this,Ft,"f").left+(this.canvas.width-h(this,Ft,"f").left-h(this,Ft,"f").right)*t,this.canvas.height-h(this,Ft,"f").bottom-s.y/h(this,Bt,"f").unit*h(this,Bt,"f").step)}}):i.lineTo(this.canvas.width-h(this,Ft,"f").right,n);break;case ot.Column:n=s.y>this.data.yMax?this.data.yMax:s.y,a=h(this,Vt,"f").height*n/h(this,Bt,"f").max,a<h(this,Bt,"f").minStep&&(a=h(this,Bt,"f").minStep),l=h(this,Rt,"f").step*(c.width?c.width/100:.5)/r,!this.isInit||this.animations.contains(s.id+f,tt.Init)?this.animations.add(s.id+f,tt.Init,{duration:800,continuous:!0,body:t=>{n=s.y>this.data.yMax?this.data.yMax:s.y,e=h(this,Ft,"f").left+x*h(this,Rt,"f").step,a=h(this,Vt,"f").height*n/h(this,Bt,"f").max*t,a<h(this,Bt,"f").minStep&&(a=h(this,Bt,"f").minStep*t),f=this.data.values.filter(t=>t.type==ot.Column).indexOf(c),i.fillRect(e+f*l+(h(this,Rt,"f").step-r*l)/2,this.canvas.height-h(this,Ft,"f").bottom-a,l,a)}}):(h(this,At,"m",Kt).call(this,e+h(this,Rt,"f").step/2)?(v=this.data.values.filter(t=>(t.type==ot.Column||t.type==ot.StackingColumn)&&t.values.filter(t=>t.x==s.x).length>0&&!t.disabled).length-1<=f,m={x:e,y:a,index:p},t.push(new Ci(`${c.label}: ${w().y}`,c.color)),oi(this,$t,e+h(this,Rt,"f").step,"f"),i.fillStyle+="88"):i.fillStyle=c.color,i.fillRect(e+f*l+(h(this,Rt,"f").step-r*l)/2,this.canvas.height-h(this,Ft,"f").bottom-a,l,a));break;case ot.Bar:a=h(this,Ft,"f").top+y*h(this,Bt,"f").step+h(this,Bt,"f").step/2,!this.isInit||this.animations.contains(s.id+d,tt.Init)?this.animations.add(s.id+d,tt.Init,{duration:800,continuous:!0,body:t=>{a=h(this,Ft,"f").top+y*h(this,Bt,"f").step+h(this,Bt,"f").step/2,d=this.data.values.filter(t=>t.type==ot.Bar).indexOf(c),i.fillRect(e,a-h(this,Bt,"f").step/4+d*u,s.x/h(this,Rt,"f").unit*h(this,Rt,"f").step*t,u)}}):(i.fillRect(e,a-h(this,Bt,"f").step/4+d*u,s.x/h(this,Rt,"f").unit*h(this,Rt,"f").step,u),h(this,At,"m",Qt).call(this,a)&&(m={x:e,y:a,index:p},t.push(new Ci(`${c.label}: ${w().x}`,c.color)),oi(this,Nt,a-h(this,Bt,"f").step/2,"f")));break;case ot.StackingColumn:if(a=this.canvas.height-h(this,Ft,"f").bottom-s.y/h(this,Bt,"f").unit*h(this,Bt,"f").step,l=h(this,Rt,"f").step*(c.width?c.width/100:.5),!this.isInit||this.animations.contains(s.id+p,tt.Init))this.animations.add(s.id+p,tt.Init,{duration:800,continuous:!0,body:t=>{f=this.data.values.filter(t=>t.type==ot.StackingColumn&&t.values.filter(t=>t.x==s.x).length>0).indexOf(c),e=h(this,Ft,"f").left+x*h(this,Rt,"f").step,a=this.canvas.height-h(this,Ft,"f").bottom-s.y/h(this,Bt,"f").unit*h(this,Bt,"f").step,0==f&&(g[x]=0);let r=null!=g[x]?g[x]:0;n=this.canvas.height-h(this,Ft,"f").bottom+r,o=(a-this.canvas.height+h(this,Ft,"f").bottom)*t,n>h(this,Ft,"f").top&&(n+o<h(this,Ft,"f").top&&(o-=n+o-h(this,Ft,"f").top),i.fillRect(e+(h(this,Rt,"f").step-l)/2,n,l,o)),g[x]+=(a-this.canvas.height+h(this,Ft,"f").bottom)*t}});else{h(this,At,"m",Kt).call(this,e+h(this,Rt,"f").step/2)?(v=this.data.values.filter(t=>(t.type==ot.Column||t.type==ot.StackingColumn)&&t.values.filter(t=>t.x==s.x).length>0&&!t.disabled).length-1<=f,m={x:e,y:a,index:x},t.push(new Ci(`${c.label}: ${w().y}`,c.color)),oi(this,$t,e+h(this,Rt,"f").step,"f"),i.fillStyle+="88"):i.fillStyle=c.color;let r=null!=g[x]?g[x]:0;n=this.canvas.height-h(this,Ft,"f").bottom+r,o=a-this.canvas.height+h(this,Ft,"f").bottom,n>h(this,Ft,"f").top&&(n+o<h(this,Ft,"f").top&&(o-=n+o-h(this,Ft,"f").top),i.fillRect(e+(h(this,Rt,"f").step-l)/2,n,l,o)),g[x]+=a-this.canvas.height+h(this,Ft,"f").bottom}}}switch(c.type){case ot.Line:i.stroke(),m&&(i.beginPath(),i.arc(m.x,m.y,5,0,2*Math.PI),i.fill());break;case ot.AttentionLine:i.stroke(),ft.TextStyles.regular(i),i.fillText(c.label,h(this,Ft,"f").left+(this.canvas.width-h(this,Ft,"f").left-h(this,Ft,"f").right)/2,this.canvas.height-h(this,Ft,"f").bottom-c.values[0].y/h(this,Bt,"f").unit*h(this,Bt,"f").step+16);break;case ot.Column:case ot.StackingColumn:if(m&&v){let t=null!=g[m.index]?g[m.index]:0;this.canvas.height-h(this,Ft,"f").bottom+t>h(this,Ft,"f").top&&(i.lineWidth=1,i.strokeStyle=s,i.moveTo(h(this,$t,"f")-h(this,Rt,"f").step/2,h(this,Ft,"f").top),i.lineTo(h(this,$t,"f")-h(this,Rt,"f").step/2,this.canvas.height-h(this,Ft,"f").bottom+t),i.stroke())}f++;break;case ot.Bar:m&&(i.lineWidth=1,i.strokeStyle=s,i.moveTo(h(this,Ft,"f").left,h(this,Nt,"f")+h(this,Bt,"f").step/2),i.lineTo(this.canvas.width-h(this,Ft,"f").right,h(this,Nt,"f")+h(this,Bt,"f").step/2),i.stroke()),d++}}i.beginPath(),i.strokeStyle="#000000",i.lineWidth=1,this.data.values.filter(t=>t.type==ot.Bar).length>0?(i.moveTo(h(this,Ft,"f").left,this.canvas.height-h(this,Ft,"f").bottom),i.lineTo(h(this,Ft,"f").left,h(this,Ft,"f").top),i.stroke()):(i.moveTo(h(this,Ft,"f").left,this.canvas.height-h(this,Ft,"f").bottom),i.lineTo(this.canvas.width-h(this,Ft,"f").right,this.canvas.height-h(this,Ft,"f").bottom),i.stroke()),this.tooltip.render(t.length>1,h(this,Yt,"f"),t),oi(this,Xt,h(this,jt,"f").render(h(this,Yt,"f"),h(this,Xt,"f")),"f"),requestAnimationFrame(this.render.bind(this)),this.isInit=!0}refresh(){super.refresh()}resize(){super.resize(),oi(this,_t,void 0,"f"),h(this,At,"m",ti).call(this)}resetMouse(){super.resetMouse(),oi(this,Yt,new MouseEvent("mousemove"),"f"),oi(this,Xt,new MouseEvent("click"),"f")}prepareSettings(){super.prepareSettings();for(let t of this.data.values){t.disabled=!t.values,t.type??=ot.Line;for(let i of t.values)i.id=ui.guid(),this.data.xType==nt.Date&&("string"==typeof i.x&&ui.isISOString(i.x)?i.x=new Date(i.x):console.warn(`${i.x} is not a date in ISO format.`))}}}Rt=new WeakMap,Bt=new WeakMap,Ft=new WeakMap,Ot=new WeakMap,Yt=new WeakMap,Xt=new WeakMap,jt=new WeakMap,$t=new WeakMap,Nt=new WeakMap,Ht=new WeakMap,zt=new WeakMap,qt=new WeakMap,Gt=new WeakMap,_t=new WeakMap,Ut=new WeakMap,Vt=new WeakMap,At=new WeakSet,Jt=function(){oi(this,Ot,this.canvas.getBoundingClientRect(),"f"),h(this,Ot,"f").x+=scrollX,h(this,Ot,"f").y+=scrollY,this.canvas.onmousemove=t=>oi(this,Yt,t,"f"),this.canvas.onclick=t=>oi(this,Xt,t,"f")},Kt=function(t){if(!h(this,Yt,"f"))return!1;let i=h(this,Yt,"f").clientX-h(this,Ot,"f").x+scrollX,s=h(this,Yt,"f").clientY-h(this,Ot,"f").y+scrollY;return t-h(this,Rt,"f").step/2<=i&&i<t+h(this,Rt,"f").step/2&&h(this,Ft,"f").top<=s&&s<=this.canvas.height-h(this,Ft,"f").bottom&&h(this,Ft,"f").left<i},Qt=function(t){if(!h(this,Yt,"f"))return!1;let i=h(this,Yt,"f").clientX-h(this,Ot,"f").x+scrollX,s=h(this,Yt,"f").clientY-h(this,Ot,"f").y+scrollY;return t-h(this,Bt,"f").step/2<=s&&s<t+h(this,Bt,"f").step/2&&h(this,Ft,"f").left<=i&&i<=this.canvas.width-h(this,Ft,"f").right},Zt=function(){const t=ft.Canvas.getContext(this.canvas);if(h(this,_t,"f"))return void t.putImageData(h(this,_t,"f"),0,0);const i="#0000001e",s=this.data.values.filter(t=>t.type==ot.Column).length>0,e=this.data.values.filter(t=>t.type==ot.Bar).length>0;(this.data.xTitle||this.data.yTitle)&&(t.textAlign="center",t.textBaseline="bottom",this.data.xTitle&&t.fillText(this.data.xTitle,h(this,Ft,"f").left+(this.canvas.width-h(this,Ft,"f").left-h(this,Ft,"f").right)/2,this.canvas.height-4),this.data.yTitle&&(t.rotate(-Math.PI/2),t.textBaseline="top",t.fillText(this.data.yTitle,-(h(this,Ft,"f").top+(this.canvas.height-h(this,Ft,"f").top-h(this,Ft,"f").bottom)/2),8),t.resetTransform())),t.textAlign="center",t.textBaseline="top";const a=h(this,Rt,"f").count>20?20:h(this,Rt,"f").count;let n=e?0:1,o=h(this,qt,"f").length/a;for(let a=e?0:1;a<h(this,qt,"f").length+1;a++){const l=h(this,Ft,"f").left+n*o*h(this,Rt,"f").step,f=Math.round(h(this,Ft,"f").left+a*h(this,Rt,"f").step);h(this,Ht,"f").has(f)||h(this,Ht,"f").set(f,this.data.xType==nt.Date?new Date(h(this,qt,"f")[a-1]).toLocaleDateString():isNaN(+h(this,Rt,"f").min)||!isFinite(+h(this,Rt,"f").min)?h(this,qt,"f")[a-1]:(h(this,Rt,"f").min+(a+(s?-1:0))*(h(this,Rt,"f").max-h(this,Rt,"f").min)/(h(this,Rt,"f").count-1)).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}));const r={x:l,y:this.canvas.height-h(this,Ft,"f").bottom,label:this.data.xType==nt.Date?new Date(h(this,qt,"f")[a-1]).toLocaleDateString():isNaN(+h(this,Rt,"f").min)||!isFinite(+h(this,Rt,"f").min)?h(this,qt,"f")[a-1]:(h(this,Rt,"f").min+(a+(s?-1:0))*(h(this,Rt,"f").max-h(this,Rt,"f").min)/(h(this,Rt,"f").count-1)).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})};let d=a>=n*o;if(d){const i=ui.stringWidth(r.label),s=r.x,e=new Uint32Array(t.getImageData(s-i/2,r.y+4,i>0?i:1,24).data.buffer);for(let t=0;t<e.length;t++)if(4278190080&e[t]){d=!1;break}}d&&(t.fillText(r.label,r.x-(e?0:h(this,Rt,"f").step/2),r.y+12),e&&(t.beginPath(),t.moveTo(r.x,r.y),t.lineTo(r.x,h(this,Ft,"f").top),t.lineWidth=1,t.strokeStyle=i,t.stroke()),n++)}t.textAlign="right",t.textBaseline="middle";const l=h(this,Bt,"f").count>10?10:h(this,Bt,"f").count;let f=e?1:0,r=h(this,Gt,"f").length/l;for(let s=e?1:0;s<h(this,Gt,"f").length+1;s++){const a=this.canvas.height-f*r*h(this,Bt,"f").step-h(this,Ft,"f").bottom,n=Math.round(this.canvas.height-s*h(this,Bt,"f").step-h(this,Ft,"f").bottom);if(h(this,zt,"f").get(n)||h(this,zt,"f").set(n,(h(this,Bt,"f").min+(s+(e?-1:0))*(h(this,Bt,"f").max-h(this,Bt,"f").min)/h(this,Bt,"f").count).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})),s>=f*r){const s={x:h(this,Ft,"f").left,y:a,label:h(this,Ut,"f")>=1?Math.round((h(this,Bt,"f").min+(f*r+(e?-1:0))*(h(this,Bt,"f").max-h(this,Bt,"f").min)/h(this,Bt,"f").count)/h(this,Ut,"f"))*h(this,Ut,"f"):Math.round(h(this,Bt,"f").min+(f*r+(e?-1:0))*(h(this,Bt,"f").max-h(this,Bt,"f").min)/h(this,Bt,"f").count/h(this,Ut,"f"))*h(this,Ut,"f")};let n;if(this.data.shortLabels){let t=0;for(;s.label>=1e3;)s.label/=1e3,t++;let i="";switch(t){case 1:i="K";break;case 2:i="M";break;case 3:i="B"}n=s.label.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})+i}else n=s.label.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});t.fillText(n,s.x-12,s.y+(e?h(this,Bt,"f").step/2:0)),this.data.values.filter(t=>t.type==ot.Column||t.type==ot.StackingColumn||t.type==ot.Line).length>0&&(t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(this.canvas.width-h(this,Ft,"f").right,s.y),t.lineWidth=1,t.strokeStyle=i,t.stroke()),f++}}oi(this,_t,t.getImageData(0,0,this.canvas.width,this.canvas.height),"f")},ti=function(){let t=this.data.values.flatMap(t=>t.values.map(t=>t.x)),i=this.data.values.flatMap(t=>t.values.map(t=>t.y));const s=this.data.xType==nt.Date;if(s){let l=new Date(Math.min(...t));function f(t,i){let s=new Date(t);return s.setDate(s.getDate()+i),s}for(;l.getTime()<Math.max(...t);)t.includes(l.getTime())||t.push(new Date(l.getTime())),l=f(l,1);t.sort((t,i)=>t<i?-1:1)}i.sort((t,i)=>i>t?-1:1),oi(this,qt,[...new Set(t.filter(t=>null!=t).map(t=>s?t.toString():t))],"f"),oi(this,Gt,[...new Set(i.filter(t=>null!=t))],"f"),oi(this,Rt,{min:Math.min(...t),max:Math.max(...t),unit:(Math.abs(Math.min(...t))+Math.abs(Math.max(...t)))/(h(this,qt,"f").length-1),step:(this.canvas.width-h(this,Ft,"f").left-h(this,Ft,"f").right)/h(this,qt,"f").length,minStep:0,count:h(this,qt,"f").length},"f");let e=Math.min(...i);e>0&&(e=0),oi(this,Bt,{min:e,max:this.data.yMax??Math.max(...i),unit:(Math.abs(e)+Math.abs(this.data.yMax??Math.max(...i)))/(h(this,Gt,"f").length-1),step:(this.canvas.height-h(this,Ft,"f").top-h(this,Ft,"f").bottom)/h(this,Gt,"f").length,minStep:0,count:h(this,Gt,"f").length},"f");let a,n=this.data.values.filter(t=>t.type==ot.StackingColumn);if(n.length>0){let r=n.map(t=>t.values.flatMap(t=>+t.y));a=h(this,Bt,"f").max;for(let d=0;d<r[0].length;d++){let c=0;for(const u of r)c+=u[d];c>a&&(a=c)}h(this,Bt,"f").max=a>this.data.yMax?this.data.yMax:a,h(this,Bt,"f").unit=(Math.abs(h(this,Bt,"f").min)+Math.abs(h(this,Bt,"f").max))/(h(this,Gt,"f").length-1)}const o=ui.stringWidth(h(this,Bt,"f").max.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}));o>h(this,Ft,"f").left-40&&(h(this,Ft,"f").left+=o-h(this,Ft,"f").left+40,h(this,Rt,"f").step=(this.canvas.width-h(this,Ft,"f").left-h(this,Ft,"f").right)/h(this,qt,"f").length),oi(this,Ut,Math.abs(h(this,Bt,"f").min)+Math.abs(h(this,Bt,"f").max),"f"),.5<=h(this,Ut,"f")&&h(this,Ut,"f")<1?oi(this,Ut,.05,"f"):1<=h(this,Ut,"f")&&h(this,Ut,"f")<10?oi(this,Ut,.1,"f"):10<=h(this,Ut,"f")&&h(this,Ut,"f")<100?oi(this,Ut,2,"f"):100<=h(this,Ut,"f")&&h(this,Ut,"f")<1e3?oi(this,Ut,20,"f"):1e3<=h(this,Ut,"f")&&h(this,Ut,"f")<1e4?oi(this,Ut,50,"f"):1e4<=h(this,Ut,"f")&&h(this,Ut,"f")<1e5?oi(this,Ut,1e3,"f"):1e5<=h(this,Ut,"f")&&h(this,Ut,"f")<1e6?oi(this,Ut,1e4,"f"):1e6<=h(this,Ut,"f")&&h(this,Ut,"f")<1e7?oi(this,Ut,5e4,"f"):oi(this,Ut,1,"f"),1!=h(this,Ut,"f")&&(a=i.length>10?10*(h(this,Bt,"f").max/10+h(this,Ut,"f")-h(this,Bt,"f").max/10%h(this,Ut,"f")):Math.ceil(h(this,Bt,"f").max/h(this,Ut,"f"))*h(this,Ut,"f"),h(this,Bt,"f").max=a>this.data.yMax?this.data.yMax:a,h(this,Bt,"f").unit=(Math.abs(h(this,Bt,"f").min)+Math.abs(h(this,Bt,"f").max))/h(this,Gt,"f").length),oi(this,Vt,{width:this.canvas.width-h(this,Ft,"f").left-h(this,Ft,"f").right,height:this.canvas.height-h(this,Ft,"f").top-h(this,Ft,"f").bottom,x:0,y:0,left:0,bottom:0,right:0,top:0,toJSON(){}},"f"),h(this,Rt,"f").minStep=.002*h(this,Vt,"f").width,h(this,Bt,"f").minStep=.002*h(this,Vt,"f").height};class wi extends a{constructor(t,i){super(t,i),ii.add(this),si.set(this,void 0),ei.set(this,void 0),this.data.values.sort((t,i)=>i.value>t.value?1:-1);const s=i.baseColor??ui.randomColor();let e=Math.round(100/this.data.values.length),a=-50;e<=1&&(e=1);for(let t of this.data.values)t.color=ui.adjustColor(s,a+=e);h(this,ii,"m",hi).call(this)}render(){if(super.render(),0==this.data.values.filter(t=>t.value>0).length)return void h(this,ii,"m",ni).call(this);let t=this.settings.title?50:0,i=this.canvas.width-2*this.data.padding,s=this.canvas.height-2*this.data.padding-t,e=this.data.values.reduce((t,i)=>t+i.value,0),a=i*s,n=this.data.padding,o=this.data.padding+t,l=this.data.padding,f=this.data.padding+t,r=new Si;const d=ft.Canvas.getContext(this.canvas);let c=!0;for(let u=0;u<this.data.values.length;u++){const g=this.data.values[u],v=i-l+this.data.padding,m=s-f+this.data.padding+t;let p=[{color:g.color,label:g.label,s:g.value/e*a,value:g.value,id:g.id,x:n,y:o,w:0,h:0}];if(u+1<=this.data.values.length-1){const t=this.data.values[u+1];p.push({color:t.color,label:t.label,s:t.value/e*a,value:t.value,id:t.id,x:n,y:o,w:0,h:0}),u++}const x=1==p.length,y=u==this.data.values.length-1;if(c)for(let t=1;t<=v+u*u;t++){const i=v-t,s=p[0].s/i;if(s+(x?0:p[1].s/i)>=m){p[0].w=Math.floor(i),p[0].h=Math.floor(s),x||(p[1].w=Math.floor(i),p[1].h=m-p[0].h,p[1].y+=p[0].h);break}}else for(let t=1;t<=m+u*u;t++){const i=m-t,s=p[0].s/i;if(s+(x?0:p[1].s/i)>=v){p[0].h=Math.floor(i),p[0].w=Math.floor(s),x||(p[1].h=Math.floor(i),p[1].w=v-p[0].w,p[1].x+=p[0].w);break}}for(const t of p){y&&(c?(t.w=v,x&&(t.h=m)):(t.h=m,x&&(t.w=v))),d.beginPath(),d.fillStyle=t.color;const i=this.isInit&&!this.animations.contains(t.id,tt.Init),s=u+p.indexOf(t)+(y&&x?1:0),l=260,f=()=>{let t=0;for(let i=0;i<s;i++)t+=l-l*(i/this.data.values.length)/Math.E;return t},g=l-l*s/(this.data.values.length+1);i?h(this,ii,"m",ai).call(this,t)?(r=t,this.animations.add(t.id,tt.MouseOver,{duration:140,body:i=>{i=1-i;const s=t.x+t.w/2,e=t.y+t.h/2,h=.95,a=1-h;d.translate(s-s*(h+i*a),e-e*(h+i*a)),d.scale(h+i*a,h+i*a),this.animations.reload(t.id,tt.MouseLeave)}})):this.animations.add(t.id,tt.MouseLeave,{timer:new Date(2e3,1,1),duration:140,body:i=>{const s=t.x+t.w/2,e=t.y+t.h/2,h=.95,a=1-h;d.translate(s-s*(h+i*a),e-e*(h+i*a)),d.scale(h+i*a,h+i*a),this.animations.reload(t.id,tt.MouseOver)}}):this.animations.add(t.id,tt.Init,{duration:f(),continuous:!0,body:i=>{if(i*f()-f()+g<0)return d.fillStyle+="00";i=(i*f()-f()+g)/g;const s=t.x+t.w/2,e=t.y+t.h/2,h=.7,a=1-h;d.translate(s-s*(h+i*a),e-e*(h+i*a)),d.scale(h+i*a,h+i*a);let n=Math.round(255*i).toString(16);n.length<2&&(n=0+n),d.fillStyle=t.color+n}});const w=4;d.roundRect(n+w,o+w,t.w-w,t.h-w,2*w),d.fill(),t.label&&ui.stringWidth(t.label)<t.w-w&&t.h-w>16&&!this.animations.contains(t.id,tt.Init)&&(d.beginPath(),ft.TextStyles.large(d),d.fillStyle=ui.isColorVisible(t.color,"#ffffff")?"#ffffff":"#000000",d.fillText(t.label,n+t.w/2,o+t.h/2)),d.resetTransform(),c?o+=t.h:n+=t.w,a-=t.w*t.h,e-=t.value}c?(n+=p[0].w,o=f):(o+=p[0].h,n=l),l=n,f=o,c=!c}this.tooltip.render(!!r,h(this,ei,"f"),[new Ci(`${r?.label}: ${r?.value?.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`)],this.data.values.find(t=>t.id==r?.id)),requestAnimationFrame(this.render.bind(this)),this.isInit=!0}refresh(){super.refresh()}resize(){super.resize(),h(this,ii,"m",hi).call(this),this.animations.clear()}resetMouse(){super.resetMouse(),oi(this,ei,new MouseEvent("mousemove"),"f")}prepareSettings(){super.prepareSettings();for(let t of this.data.values)t.disabled=!t.value,t.value??=0}}si=new WeakMap,ei=new WeakMap,ii=new WeakSet,hi=function(){oi(this,si,this.canvas.getBoundingClientRect(),"f"),h(this,si,"f").x+=scrollX,h(this,si,"f").y+=scrollY,this.isInit||(this.canvas.onmousemove=t=>oi(this,ei,t,"f"))},ai=function(t){if(!h(this,ei,"f")||!t)return!1;let i=h(this,ei,"f").clientX-h(this,si,"f").x+scrollX,s=h(this,ei,"f").clientY-h(this,si,"f").y+scrollY;return t.x<=i&&i<=t.x+t.w&&t.y<=s&&s<=t.y+t.h},ni=function(){const t=ft.Canvas.getContext(this.canvas);ft.TextStyles.regular(t),t.fillText("Incorrect values",this.canvas.width/2,this.canvas.height/2)};class Mi{}class bi extends t{constructor(t){super(),Object.assign(this,t)}toggle(t){super.toggle(t)}checkCondition(){return super.checkCondition(),!0}reset(){super.reset()}}class ki extends t{constructor(t){super(),Object.assign(this,t)}toggle(t){super.toggle(t),this.disabled?this.current=this.value*(1-t):this.current=this.value*t}checkCondition(){return super.checkCondition(),0==this.current&&!this.disabled||0!=this.value}reset(){super.reset(),this.current=this.value}}class Ci{constructor(t,i){this.text=t,this.color=i}}class Si{constructor(){}}}})[832]()})();
//# sourceMappingURL=ocharts.js.map